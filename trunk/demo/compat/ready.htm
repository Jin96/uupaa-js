<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="ja">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>uupaa.js - uu.dom.ready, uu.window.ready, uu.canvas.ready uu.module.image.preload test</title>
<!--[if IE]><script id="excanvas.js" type="text/javascript" src="http://pigs.sourceforge.jp/excanvas.js"></script><![endif]-->
<script type="text/javascript" src="../../uupaa.js"></script>
<style>
body {
  background-color: white;
}
canvas {
  position: absolute;
  top: 2em;
  left: 0;
}
</style>
</head>
<body>
<a href="../../README.htm#demo">README.htm</a> &gt; ready.htm

<canvas id="canvas0" width="800" height="600"></canvas>
<table>
<tr>
  <td width="256" height="256"><img src="http://mt3.google.com/mt?n=404&v=w2.74&hl=ja&x=13&y=5&zoom=13&s=" alt="" /></td>
  <td width="256" height="256"><img src="http://mt0.google.com/mt?n=404&v=w2.74&hl=ja&x=14&y=5&zoom=13&s=" alt="" /></td>
</tr>
<tr>
  <td width="256" height="256"><img src="http://mt1.google.com/mt?n=404&v=w2.74&hl=ja&x=13&y=6&zoom=13&s=" alt="" /></td>
  <td width="256" height="256"><img src="http://mt2.google.com/mt?n=404&v=w2.74&hl=ja&x=14&y=6&zoom=13&s=" alt="" /></td>
</tr>
</table>

<div style="position: absolute; top: 2em; left: 0">
<dl>
  <dt>uu.dom.ready(), uu.window.ready(), uu.canvas.ready() - </dt>
  <dd>dom,window,canvasのいずれかが使用可能になると状態を追記します。
      <p id="result1" style="font-weight: bold"></p>
      全て非同期に動作していますが、IEとそれ以外のブラウザでは順番が異なります(excanvasを使用しているため)。<br />
      uu.canvas.already()はIEとそれ以外のブラウザで描画開始のタイミングの整合性を取る上で重要になります。
  </dd>

  <dt>uu.canvas.already() - </dt>
  <dd>canvasが使用可能(uu.canvas.already()がtrueを返す状態)になったら、
      画面中央にモスグリーンの円を描画します。</dd>

  <dt>uu.module.image.preload() -</dt>
  <dd>画像のプリロードが完了で、地図画像をフェードアウト、ロゴをフェードインさせます。<br />
      canvasで画像を使用する際は画像をプリロードしておかないとエラーが発生します。<br />
      uu.module.image.preloadはcanvas用途の他に、ロールオーバー画像のプリロードとしても使用できます。
  </dd>
</dl>
</div>

<script type="text/javascript">
function judge() {
  var rv = "";
  if (uu.canvas.already())  { rv += "c"; }
  if (uu.dom.already())     { rv += "d"; }
  if (uu.window.already())  { rv += "w"; }
  if (rv) {
    uu.id("result1").innerText += "(" + rv + ")";
  }
}
function domReady()         { uu.id("result1").innerText += ", dom.ready"; judge(); }
function winReady()         { uu.id("result1").innerText += ", win.ready"; judge(); }
function cvsReady()         { uu.id("result1").innerText += ", cvs.ready"; judge(); }
function doodle() { // 落書き
  var e = uu.id("canvas0");
  var ctx = e.getContext("2d");
  ctx.beginPath();
  ctx.fillStyle = "rgba(155, 187, 89, 0.4)";
  ctx.arc(300, 300, 200, 0, Math.PI*2, false);
  ctx.fill();
}

// ------------------------
uu.dom.ready([domReady, uu.mute]);
uu.window.ready(winReady);
uu.canvas.ready([cvsReady, doodle]);
uu.module.load("", "ui,effect,image", function() {
  uu.module.image.preload("http://maps.google.co.jp/intl/ja_jp/images/maps_results_logo.gif",
    function(code, url) {
//      uu.tag("img").forEach(function(v) {
      uu.forEach(uu.tag("img"), function(v) {
        uu.effect.fade(v, { speed: "quick", 
          fn: function() {
            v.src = url;
            uu.effect.fadein(v, { begin: 0, end: 0.3 });
          }
        });
      });
    }
  );
});
</script>

</body>
</html>
