<html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"> <style>
	.KEYW {color: #933;}
	.COMM {color: #bbb; font-style: italic;}
	.NUMB {color: #393;}
	.STRN {color: #393;}
	.REGX {color: #339;}
	.linenumber {border-right: 1px dotted #666; color: #666; font-style: normal;}
	</style></head><body><pre><span class='linenumber'>  1</span> <span class="COMM">/** uupaa.js - JavaScript Library for Japanese creator
<span class='linenumber'>  2</span>  *
<span class='linenumber'>  3</span>  * @author Takao Obara
<span class='linenumber'>  4</span>  * @license uupaa.js is licensed under the terms and conditions of the MIT licence.
<span class='linenumber'>  5</span>  * @see http://code.google.com/p/uupaa-js/
<span class='linenumber'>  6</span>  */</span><span class="WHIT">
<span class='linenumber'>  7</span> 
<span class='linenumber'>  8</span> </span><span class="COMM">////////////////////////////////////////////////////////////</span><span class="WHIT">
<span class='linenumber'>  9</span> </span><span class="COMM">/** &lt;b>uupaa.js core definition&lt;/b>
<span class='linenumber'> 10</span>  *
<span class='linenumber'> 11</span>  * @class
<span class='linenumber'> 12</span>  */</span><span class="WHIT">
<span class='linenumber'> 13</span> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">uu</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 14</span> </span><span class="WHIT">  </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">uu._impl.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 15</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 16</span> </span><span class="NAME">uu._impl</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// As you like</span><span class="WHIT">
<span class='linenumber'> 17</span> 
<span class='linenumber'> 18</span> </span><span class="NAME">uu.version</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// [major, release, revision]</span><span class="WHIT">
<span class='linenumber'> 19</span> 
<span class='linenumber'> 20</span> </span><span class="COMM">////////////////////////////////////////////////////////////</span><span class="WHIT">
<span class='linenumber'> 21</span> </span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">uud</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">document</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">uuw</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">window</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// alias</span><span class="WHIT">
<span class='linenumber'> 22</span> 
<span class='linenumber'> 23</span> </span><span class="NAME">uud.head</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">uud.getElementsByTagName</span><span class="PUNC">(</span><span class="STRN">"head"</span><span class="PUNC">)</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// alias - document.head</span><span class="WHIT">
<span class='linenumber'> 24</span> 
<span class='linenumber'> 25</span> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">uud.evaluate</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">uud.getElementById</span><span class="PUNC">(</span><span class="STRN">"javascript-xpath.js"</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="COMM">// need document.evaluate()</span><span class="WHIT">
<span class='linenumber'> 26</span> </span><span class="WHIT">  </span><span class="KEYW">throw</span><span class="WHIT"> </span><span class="NAME">Error</span><span class="PUNC">(</span><span class="STRN">'ERR-02: &lt;script src="{{path}}/javascript-xpath.js"> not exist'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 27</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'> 28</span> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">uud.getElementById</span><span class="PUNC">(</span><span class="STRN">"uupaa.js"</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="COMM">// need &lt;script id="uupaa.js" src="uupaa.js">&lt;/script></span><span class="WHIT">
<span class='linenumber'> 29</span> </span><span class="WHIT">  </span><span class="KEYW">throw</span><span class="WHIT"> </span><span class="NAME">Error</span><span class="PUNC">(</span><span class="STRN">'ERR-02: &lt;script id="uupaa.js" src="{{path}}/uupaa.js"> not exist'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 30</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'> 31</span> 
<span class='linenumber'> 32</span> </span><span class="COMM">////////////////////////////////////////////////////////////</span><span class="WHIT">
<span class='linenumber'> 33</span> </span><span class="COMM">/** &lt;b>uu.mix - ミックス, 継承(mixin, class abstract)&lt;/b>
<span class='linenumber'> 34</span>  *
<span class='linenumber'> 35</span>  * baseにflavorとaromaを混ぜ込みbaseを返します。&lt;br />
<span class='linenumber'> 36</span>  * 既存のindexがあればflavorやaromaの値で上書きします。
<span class='linenumber'> 37</span>  *
<span class='linenumber'> 38</span>  * @param hash/array base    - ベース要素の指定です。
<span class='linenumber'> 39</span>  * @param hash/array flavor  - baseに混ぜ込む要素の指定です。
<span class='linenumber'> 40</span>  * @param hash/array [aroma] - baseに混ぜ込む要素の指定です。デフォルトはundefinedです。
<span class='linenumber'> 41</span>  * @return hash/array - ミックス後のbaseを返します。
<span class='linenumber'> 42</span>  * @see uu.mix.param - パラメタ用のmix
<span class='linenumber'> 43</span>  * @see uu.mix.props - プロパティのみをmix
<span class='linenumber'> 44</span>  * @namespace
<span class='linenumber'> 45</span>  */</span><span class="WHIT">
<span class='linenumber'> 46</span> </span><span class="NAME">uu.mix</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">base</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">flavor</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">aroma</span><span class="WHIT"> </span><span class="COMM">/* = undefined */</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 47</span> </span><span class="WHIT">  </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">p</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">flavor</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 48</span> </span><span class="WHIT">    </span><span class="NAME">base</span><span class="PUNC">[</span><span class="NAME">p</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">flavor</span><span class="PUNC">[</span><span class="NAME">p</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 49</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'> 50</span> </span><span class="WHIT">  </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">aroma</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">uu.mix</span><span class="PUNC">(</span><span class="NAME">base</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">aroma</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">base</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 51</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 52</span> 
<span class='linenumber'> 53</span> </span><span class="COMM">/** &lt;b>uu.mix.param - 引数の補完(parameter completion mixin)&lt;/b>
<span class='linenumber'> 54</span>  *
<span class='linenumber'> 55</span>  * baseにflavorとaromaを混ぜ込みbaseを返します。&lt;br />
<span class='linenumber'> 56</span>  * 既存のindexの値をflavorやaromaの値で上書きしません。
<span class='linenumber'> 57</span>  *
<span class='linenumber'> 58</span>  * &lt;pre class="eg">
<span class='linenumber'> 59</span>  * var base = { param1: 1, param2: "a" };
<span class='linenumber'> 60</span>  * uu.mix.param(base, { param1: "hoge" }); // base = { param1: 1, param2: "a" }
<span class='linenumber'> 61</span>  * &lt;/pre>
<span class='linenumber'> 62</span>  *
<span class='linenumber'> 63</span>  * @param hash/array base    - ベース要素の指定です。
<span class='linenumber'> 64</span>  * @param hash/array flavor  - baseに混ぜ込む要素の指定です。
<span class='linenumber'> 65</span>  * @param hash/array [aroma] - baseに混ぜ込む要素の指定です。デフォルトはundefinedです。
<span class='linenumber'> 66</span>  * @return hash/array - ミックス後のbaseを返します。
<span class='linenumber'> 67</span>  * @see uu.mix - 汎用mixin
<span class='linenumber'> 68</span>  * @see uu.mix.props - プロパティのみをmix
<span class='linenumber'> 69</span>  */</span><span class="WHIT">
<span class='linenumber'> 70</span> </span><span class="NAME">uu.mix.param</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">base</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">flavor</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">aroma</span><span class="WHIT"> </span><span class="COMM">/* = undefined */</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 71</span> </span><span class="WHIT">  </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">p</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">flavor</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 72</span> </span><span class="WHIT">    </span><span class="PUNC">(</span><span class="NAME">p</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">base</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">base</span><span class="PUNC">[</span><span class="NAME">p</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">flavor</span><span class="PUNC">[</span><span class="NAME">p</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 73</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'> 74</span> </span><span class="WHIT">  </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">aroma</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">uu.mix.param</span><span class="PUNC">(</span><span class="NAME">base</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">aroma</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">base</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 75</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 76</span> 
<span class='linenumber'> 77</span> </span><span class="COMM">/** &lt;b>uu.mix.props - プロパティのみ補完(propertys mixin)&lt;/b>
<span class='linenumber'> 78</span>  *
<span class='linenumber'> 79</span>  * baseにflavorとaromaを混ぜ込みbaseを返します。&lt;br />
<span class='linenumber'> 80</span>  * 既存のindexの値をflavorやaromaの値で上書きします。&lt;br />
<span class='linenumber'> 81</span>  *
<span class='linenumber'> 82</span>  * uu.mix.propsはメソッドとlengthプロパティを混ぜません。
<span class='linenumber'> 83</span>  * この特徴は、mixinする必要のないメソッドや、
<span class='linenumber'> 84</span>  * 混乱の元となる"length"プロパティをそぎ落とすフィルターとしても使用できます。
<span class='linenumber'> 85</span>  *
<span class='linenumber'> 86</span>  * @param hash/array base    - ベース要素の指定です。
<span class='linenumber'> 87</span>  * @param hash/array flavor  - baseに混ぜ込む要素の指定です。
<span class='linenumber'> 88</span>  * @param hash/array [aroma] - baseに混ぜ込む要素の指定です。デフォルトはundefinedです。
<span class='linenumber'> 89</span>  * @return hash/array - ミックス後のbaseを返します。
<span class='linenumber'> 90</span>  * @see uu.mix - 汎用mixin
<span class='linenumber'> 91</span>  * @see uu.mix.param - パラメタ用のmix
<span class='linenumber'> 92</span>  */</span><span class="WHIT">
<span class='linenumber'> 93</span> </span><span class="NAME">uu.mix.props</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">base</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">flavor</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">aroma</span><span class="WHIT"> </span><span class="COMM">/* = undefined */</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 94</span> </span><span class="WHIT">  </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">p</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">flavor</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 95</span> </span><span class="WHIT">    </span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">flavor</span><span class="PUNC">[</span><span class="NAME">p</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="STRN">"function"</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">p</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="STRN">"length"</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">base</span><span class="PUNC">[</span><span class="NAME">p</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">flavor</span><span class="PUNC">[</span><span class="NAME">p</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 96</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'> 97</span> </span><span class="WHIT">  </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">aroma</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">uu.mix.prop</span><span class="PUNC">(</span><span class="NAME">base</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">aroma</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">base</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 98</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 99</span> 
<span class='linenumber'>100</span> </span><span class="COMM">////////////////////////////////////////////////////////////</span><span class="WHIT">
<span class='linenumber'>101</span> </span><span class="COMM">/** &lt;b>uu.forEach - 全要素を評価(for each)&lt;/b>
<span class='linenumber'>102</span>  *
<span class='linenumber'>103</span>  * mixの各要素(各文字)に対しfnを実行します。&lt;br />
<span class='linenumber'>104</span>  * Array.forEachはarray専用ですが、uu.forEachは、hash, array, 擬似配列に使用可能です。&lt;br />
<span class='linenumber'>105</span>  *
<span class='linenumber'>106</span>  * 存在しないインデックスやundefinedの要素はスキップします。
<span class='linenumber'>107</span>  * fnには3つの引数(要素の値, 要素のインデックス, 配列自身)が渡されます。
<span class='linenumber'>108</span>  *
<span class='linenumber'>109</span>  * @param hash/array mix  - 要素を指定します。
<span class='linenumber'>110</span>  * @param function   fn   - 各要素を評価する関数を指定します。
<span class='linenumber'>111</span>  * @param this       [me] - fn実行時のthisを指定します。デフォルトはundefinedです。
<span class='linenumber'>112</span>  * @return mix - mixを返します。
<span class='linenumber'>113</span>  * @see Array.forEach - 全要素を評価し配列を返す
<span class='linenumber'>114</span>  * @namespace
<span class='linenumber'>115</span>  */</span><span class="WHIT">
<span class='linenumber'>116</span> </span><span class="NAME">uu.forEach</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">mix</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">fn</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">me</span><span class="WHIT"> </span><span class="COMM">/* = undefined */</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>117</span> </span><span class="WHIT">  </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">mix.forEach</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">mix.forEach</span><span class="PUNC">(</span><span class="NAME">fn</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">me</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="COMM">// call native forEach function</span><span class="WHIT">
<span class='linenumber'>118</span> </span><span class="WHIT">  </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">sz</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>119</span> </span><span class="WHIT">  </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="STRN">"length"</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">mix</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="COMM">// Array or FakeArray(has length property)</span><span class="WHIT">
<span class='linenumber'>120</span> </span><span class="WHIT">    </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">sz</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">mix.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">sz</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">++</span><span class="NAME">i</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>121</span> </span><span class="WHIT">      </span><span class="PUNC">(</span><span class="NAME">i</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">mix</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">fn.call</span><span class="PUNC">(</span><span class="NAME">me</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">mix</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">mix</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>122</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>123</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>124</span> </span><span class="WHIT">    </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">i</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">mix</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>125</span> </span><span class="WHIT">      </span><span class="NAME">mix.hasOwnProperty</span><span class="PUNC">(</span><span class="NAME">i</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">fn.call</span><span class="PUNC">(</span><span class="NAME">me</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">mix</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">mix</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>126</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>127</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>128</span> </span><span class="WHIT">  </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">mix</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>129</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>130</span> 
<span class='linenumber'>131</span> </span><span class="COMM">////////////////////////////////////////////////////////////</span><span class="WHIT">
<span class='linenumber'>132</span> </span><span class="COMM">/** &lt;b>uu.id - document.getElementById wrapper&lt;/b>
<span class='linenumber'>133</span>  *
<span class='linenumber'>134</span>  * IDと一致する要素を検索します。
<span class='linenumber'>135</span>  *
<span class='linenumber'>136</span>  * @param string id        - IDを指定します。
<span class='linenumber'>137</span>  * @param bool   [noCache] - キャッシュを使わずに検索する場合にtrueを指定します。&lt;br />
<span class='linenumber'>138</span>  *                           falseを指定するとキャッシュを使用する可能性があり、
<span class='linenumber'>139</span>  *                           その要素が既に存在しなかったり、IDが別の要素で使いまわされている可能性もあります。&lt;br />
<span class='linenumber'>140</span>  *                           デフォルトはfalseです。
<span class='linenumber'>141</span>  * @return null/element    - 検索成功で要素の参照を返します。失敗でnullを返します。
<span class='linenumber'>142</span>  * @see &lt;a href="http://uupaa-js.googlecode.com/svn/trunk/SELECTOR.htm">セレクタ(Selector)&lt;/a>
<span class='linenumber'>143</span>  * @namespace
<span class='linenumber'>144</span>  */</span><span class="WHIT">
<span class='linenumber'>145</span> </span><span class="NAME">uu.id</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">id</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">noCache</span><span class="WHIT"> </span><span class="COMM">/* = false */</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>146</span> </span><span class="WHIT">  </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">noCache</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">uud.getElementById</span><span class="PUNC">(</span><span class="NAME">id</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT">
<span class='linenumber'>147</span> </span><span class="WHIT">         </span><span class="PUNC">(</span><span class="NAME">uu.id._cache</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">uu.id._cache</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">uud.getElementById</span><span class="PUNC">(</span><span class="NAME">id</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>148</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>149</span> </span><span class="NAME">uu.id._cache</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>150</span> 
<span class='linenumber'>151</span> </span><span class="COMM">////////////////////////////////////////////////////////////</span><span class="WHIT">
<span class='linenumber'>152</span> </span><span class="COMM">/** &lt;b>ブラウザの判別とブラウザが保持する機能の判別(Detect User-Agent/Browser Function/DOM Function)&lt;/b>
<span class='linenumber'>153</span>  *
<span class='linenumber'>154</span>  * ブラウザの判別と、機能の有効/無効情報を返します。&lt;br />
<span class='linenumber'>155</span>  *
<span class='linenumber'>156</span>  * &lt;h4>nameに指定可能な文字列&lt;/h4>
<span class='linenumber'>157</span>  * &lt;dl>
<span class='linenumber'>158</span>  *  &lt;dt>空文字列("")&lt;/dt>&lt;dd>ユーザエージェント文字列を返す&lt;/dd>
<span class='linenumber'>159</span>  *  &lt;dt>"opara"&lt;/dt>&lt;dd>Operaでtrue&lt;/dd>
<span class='linenumber'>160</span>  *  &lt;dt>"ie"&lt;/dt>&lt;dd>Internet Explorerでtrue&lt;/dd>
<span class='linenumber'>161</span>  *  &lt;dt>"gecko"&lt;/dt>&lt;dd>Geckoブラウザ(Firefox等)でtrue&lt;/dd>
<span class='linenumber'>162</span>  *  &lt;dt>"webkit"&lt;/dt>&lt;dd>Webkitブラウザ(Safari等)でtrue&lt;/dd>
<span class='linenumber'>163</span>  *  &lt;dt>"ipod"&lt;/dt>&lt;dd>iPod/iPhone(Safari)でtrue&lt;/dd>
<span class='linenumber'>164</span>  *  &lt;dt>"wii"&lt;/dt>&lt;dd>Wii Internet channelでtrue&lt;/dd>
<span class='linenumber'>165</span>  *  &lt;dt>"std"&lt;/dt>&lt;dd>DTDを指定したスタンダードモードでブラウザが描画している場合にtrue&lt;/dd>
<span class='linenumber'>166</span>  *  &lt;dt>"domrange"&lt;/dt>&lt;dd>DOM Level2 Range Moduleが使用可能でtrue&lt;/dd>
<span class='linenumber'>167</span>  *  &lt;dt>"display:table"&lt;/dt>&lt;dd>Safari3, Firefox2, Opera9, IE8ならtrue, それ以外ならfalse&lt;/dd>
<span class='linenumber'>168</span>  *  &lt;dt>"ver"&lt;/dt>&lt;dd>ブラウザ(描画エンジン)のバージョン番号, 値と意味はブラウザの種類で異なる&lt;/dd>
<span class='linenumber'>169</span>  * &lt;/dl>
<span class='linenumber'>170</span>  *
<span class='linenumber'>171</span>  * @param string name - ブラウザ名, ブラウザの描画エンジン名, 機能名の指定です。&lt;br />
<span class='linenumber'>172</span>  *                      大小文字を区別しません。
<span class='linenumber'>173</span>  * @return bool/string - nameで指定したブラウザで動作しているか、機能が使用可能な場合にtrueを返します。
<span class='linenumber'>174</span>  *                       nameを省略した場合は、ユーザエージェント文字列を返します。
<span class='linenumber'>175</span>  *                       verを指定するとバージョン番号を返します。
<span class='linenumber'>176</span>  * @class
<span class='linenumber'>177</span>  */</span><span class="WHIT">
<span class='linenumber'>178</span> </span><span class="NAME">uu.ua</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">name</span><span class="WHIT"> </span><span class="COMM">/* = "" */</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>179</span> </span><span class="WHIT">  </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">e</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">arguments.callee</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>180</span> </span><span class="WHIT">  </span><span class="NAME">name</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">name</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="STRN">"_"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">toLowerCase</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>181</span> </span><span class="WHIT">  </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">name</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">e</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">e</span><span class="PUNC">[</span><span class="NAME">name</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>182</span> </span><span class="WHIT">  </span><span class="KEYW">switch</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">name</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>183</span> </span><span class="WHIT">  </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">"display:table"</span><span class="PUNC">:</span><span class="WHIT">
<span class='linenumber'>184</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">uu.ua.ie</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">uu.ua.ver</span><span class="WHIT"> </span><span class="PUNC">>=</span><span class="WHIT"> </span><span class="NUMB">8</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>185</span> </span><span class="WHIT">  </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">"ver"</span><span class="PUNC">:</span><span class="WHIT">
<span class='linenumber'>186</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">uu.ua.ver</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>187</span> </span><span class="WHIT">      </span><span class="NAME">uu.ua.ver</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">uu.ua.ie</span><span class="PUNC">)</span><span class="WHIT">     </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">parseFloat</span><span class="PUNC">(</span><span class="NAME">uu.ua._.match</span><span class="PUNC">(</span><span class="REGX">/MSIE ([\d]\.[\d][\w]?)/</span><span class="PUNC">)</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT">
<span class='linenumber'>188</span> </span><span class="WHIT">                </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">uu.ua.webkit</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">parseFloat</span><span class="PUNC">(</span><span class="NAME">uu.ua._.match</span><span class="PUNC">(</span><span class="REGX">/WebKit\/(\d+(?:\.\d+)*)/</span><span class="PUNC">)</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT">
<span class='linenumber'>189</span> </span><span class="WHIT">                </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">uu.ua.gecko</span><span class="PUNC">)</span><span class="WHIT">  </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">parseFloat</span><span class="PUNC">(</span><span class="NAME">uu.ua._.match</span><span class="PUNC">(</span><span class="REGX">/Gecko\/(\d{8})/</span><span class="PUNC">)</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT">
<span class='linenumber'>190</span> </span><span class="WHIT">                </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">uu.ua.opera</span><span class="PUNC">)</span><span class="WHIT">  </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">opera.version</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>191</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>192</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">uu.ua.ver</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>193</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>194</span> </span><span class="WHIT">  </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>195</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>196</span> </span><span class="NAME">uu.ua._</span><span class="WHIT">       </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">navigator.userAgent</span><span class="PUNC">;</span><span class="WHIT">            </span><span class="COMM">// UserAgent cache</span><span class="WHIT">
<span class='linenumber'>197</span> </span><span class="NAME">uu.ua.opera</span><span class="WHIT">   </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="PUNC">!</span><span class="NAME">uuw.opera</span><span class="PUNC">;</span><span class="WHIT">                    </span><span class="COMM">// is Opera</span><span class="WHIT">
<span class='linenumber'>198</span> </span><span class="NAME">uu.ua.ie</span><span class="WHIT">      </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="PUNC">!</span><span class="NAME">uud.uniqueID</span><span class="PUNC">;</span><span class="WHIT">                 </span><span class="COMM">// is Internet Explorer</span><span class="WHIT">
<span class='linenumber'>199</span> </span><span class="NAME">uu.ua.gecko</span><span class="WHIT">   </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">uu.ua._.indexOf</span><span class="PUNC">(</span><span class="STRN">'Gecko/'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">>=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// is Gecko(Firefox)</span><span class="WHIT">
<span class='linenumber'>200</span> </span><span class="NAME">uu.ua.webkit</span><span class="WHIT">  </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">uu.ua._.indexOf</span><span class="PUNC">(</span><span class="STRN">'WebKit'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">>=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// is WebKit(Safari)</span><span class="WHIT">
<span class='linenumber'>201</span> </span><span class="NAME">uu.ua.ipod</span><span class="WHIT">    </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">uu.ua._.indexOf</span><span class="PUNC">(</span><span class="STRN">'iPod'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">>=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">uu.ua._.indexOf</span><span class="PUNC">(</span><span class="STRN">'iPhone'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">>=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// is iPod/iPhone(Safari)</span><span class="WHIT">
<span class='linenumber'>202</span> </span><span class="NAME">uu.ua.wii</span><span class="WHIT">     </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="PUNC">!</span><span class="PUNC">(</span><span class="NAME">uuw.opera</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">uuw.opera.wiiremote</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">             </span><span class="COMM">// is Wii Internet channel</span><span class="WHIT">
<span class='linenumber'>203</span> </span><span class="NAME">uu.ua.std</span><span class="WHIT">     </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">uud.compatMode</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">uud.compatMode</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">'CSS1Compat'</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// is Standard Mode</span><span class="WHIT">
<span class='linenumber'>204</span> </span><span class="NAME">uu.ua.domrange</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">uud.implementation.hasFeature</span><span class="PUNC">(</span><span class="STRN">"Range"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"2.0"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">   </span><span class="COMM">// is DOM Level2 Range Module</span><span class="WHIT">
<span class='linenumber'>205</span> </span><span class="NAME">uu.ua.ver</span><span class="WHIT">     </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">uu.ua</span><span class="PUNC">(</span><span class="STRN">"ver"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>206</span> 
<span class='linenumber'>207</span> </span><span class="COMM">////////////////////////////////////////////////////////////</span><span class="WHIT">
<span class='linenumber'>208</span> </span><span class="COMM">/** &lt;b>Module&lt;/b>
<span class='linenumber'>209</span>  *
<span class='linenumber'>210</span>  * @class
<span class='linenumber'>211</span>  */</span><span class="WHIT">
<span class='linenumber'>212</span> </span><span class="NAME">uu.module</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>213</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>214</span> 
<span class='linenumber'>215</span> </span><span class="COMM">/** &lt;b>uu.module.timeout - タイムアウト時間&lt;/b>
<span class='linenumber'>216</span>  *
<span class='linenumber'>217</span>  * uu.module.loadSync()で使用するタイムアウト時間を指定します。&lt;br />
<span class='linenumber'>218</span>  * 1以上の数値を指定します。単位はmsです。デフォルトは500です。
<span class='linenumber'>219</span>  *
<span class='linenumber'>220</span>  * @type number
<span class='linenumber'>221</span>  * @see uu.module.loadSync
<span class='linenumber'>222</span>  */</span><span class="WHIT">
<span class='linenumber'>223</span> </span><span class="NAME">uu.module.timeout</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">500</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// 500ms(0.5s)</span><span class="WHIT">
<span class='linenumber'>224</span> 
<span class='linenumber'>225</span> </span><span class="COMM">/** &lt;b>uu.module.delay - 遅延時間&lt;/b>
<span class='linenumber'>226</span>  * uu.module.loadSync()で使用する遅延時間の指定です。&lt;br />
<span class='linenumber'>227</span>  * 10以上の数値を指定します。単位はmsです。デフォルトは50です。
<span class='linenumber'>228</span>  *
<span class='linenumber'>229</span>  * @type number
<span class='linenumber'>230</span>  * @see uu.module.loadSync
<span class='linenumber'>231</span>  */</span><span class="WHIT">
<span class='linenumber'>232</span> </span><span class="NAME">uu.module.delay</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">50</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// 50ms</span><span class="WHIT">
<span class='linenumber'>233</span> 
<span class='linenumber'>234</span> </span><span class="COMM">/** &lt;b>uu.module.isLoaded - モジュールをロード済みならtrue&lt;/b>
<span class='linenumber'>235</span>  *
<span class='linenumber'>236</span>  * @param taxing name - モジュール名を指定します。
<span class='linenumber'>237</span>  * @return bool - モジュールロード済みでtrueを返します。&lt;br />
<span class='linenumber'>238</span>  *                複数モジュール指定時は、全モジュールロード済みでtrueを返します。
<span class='linenumber'>239</span>  */</span><span class="WHIT">
<span class='linenumber'>240</span> </span><span class="NAME">uu.module.isLoaded</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">name</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>241</span> </span><span class="WHIT">  </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">uu.notax</span><span class="PUNC">(</span><span class="NAME">name</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">every</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">v</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>242</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">v</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">uu.module</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>243</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>244</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>245</span> 
<span class='linenumber'>246</span> </span><span class="COMM">/** &lt;b>uu.module.load - モジュールの非同期ロード(load module[Async])&lt;/b>
<span class='linenumber'>247</span>  *
<span class='linenumber'>248</span>  * モジュールを順番にロードし、全モジュールのロード完了で、fn() をコールします。&lt;br />
<span class='linenumber'>249</span>  * uu.module.loadSync()との違いは以下になります。&lt;br />
<span class='linenumber'>250</span>  *
<span class='linenumber'>251</span>  * 1. uu.module.loadSync()はシリアル(順番)にロードしますが、uu.module.load()はパラレル(同時)にロードします。&lt;br />
<span class='linenumber'>252</span>  * 2. パラレルにロードするためユーザの待機時間が最小になりますが、ロード順は保障されません。&lt;br />
<span class='linenumber'>253</span>  * 3. タイムアウトしません。
<span class='linenumber'>254</span>  *
<span class='linenumber'>255</span>  * 既にロード済みのモジュールを指定すると、即座にfnを呼び出します。
<span class='linenumber'>256</span>  *
<span class='linenumber'>257</span>  * @param taxing [path] - 検索パスの指定です。絶対URLや相対パスを指定します。&lt;br />
<span class='linenumber'>258</span>  *                        空文字列を指定すると、uu.config.modulePathで指定されたURLを検索パスとして使用します。&lt;br />
<span class='linenumber'>259</span>  *                        デフォルトは空文字列("")です。&lt;br />
<span class='linenumber'>260</span>  * @param taxing module - モジュールの指定です。
<span class='linenumber'>261</span>  * @param function [fn] - ロード完了後にコールバックするメソッドを指定します。デフォルトはundefinedです。
<span class='linenumber'>262</span>  * @throws Error          "uu.module.load({module}) failed"  ロード失敗
<span class='linenumber'>263</span>  * @see uu.config.modulePath モジュール検索パスの指定
<span class='linenumber'>264</span>  * @see uu.module.loadSync - 同期ロード
<span class='linenumber'>265</span>  * @see uu.module.isLoaded - モジュール読込済みでtrueを返す
<span class='linenumber'>266</span>  * @see uu.baseURL - uupaa.jsのカレントパスを返す
<span class='linenumber'>267</span>  */</span><span class="WHIT">
<span class='linenumber'>268</span> </span><span class="NAME">uu.module.load</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">path</span><span class="WHIT"> </span><span class="COMM">/* = "" */</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">module</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">fn</span><span class="WHIT"> </span><span class="COMM">/* = undefined */</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>269</span> </span><span class="WHIT">  </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">src</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">uu.module._buildURL</span><span class="PUNC">(</span><span class="NAME">path</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">uu.config.modulePath</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">module</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>270</span> </span><span class="WHIT">      </span><span class="NAME">mods</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">uu.indexes</span><span class="PUNC">(</span><span class="NAME">src</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">run</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>271</span> </span><span class="WHIT">  </span><span class="NAME">fn</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">fn</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">uu.mute</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>272</span> 
<span class='linenumber'>273</span> </span><span class="WHIT">  </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">uu.module.isLoaded</span><span class="PUNC">(</span><span class="NAME">module</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">fn</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="COMM">// already loaded</span><span class="WHIT">
<span class='linenumber'>274</span> 
<span class='linenumber'>275</span> </span><span class="WHIT">  </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">mods.length</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">fn</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT">
<span class='linenumber'>276</span> </span><span class="WHIT">    </span><span class="NAME">uu.forEach</span><span class="PUNC">(</span><span class="NAME">src</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">v</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>277</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">uu.ua.ie</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>278</span> </span><span class="WHIT">        </span><span class="NAME">uu.module._inject</span><span class="PUNC">(</span><span class="NAME">i</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">v</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>279</span> </span><span class="WHIT">          </span><span class="NAME">onreadystatechange</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>280</span> </span><span class="WHIT">            </span><span class="COMM">// IE6は"complete"のみ、IE8では"loaded"</span><span class="WHIT">
<span class='linenumber'>281</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.readyState</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">"complete"</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">this.readyState</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">"loaded"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>282</span> </span><span class="WHIT">              </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">uu.module.isLoaded</span><span class="PUNC">(</span><span class="NAME">this.uuModule</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="COMM">// file not found.</span><span class="WHIT">
<span class='linenumber'>283</span> </span><span class="WHIT">                </span><span class="NAME">uu.module._reload</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>284</span> </span><span class="WHIT">              </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">uu.module.isLoaded</span><span class="PUNC">(</span><span class="NAME">mods</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>285</span> </span><span class="WHIT">                </span><span class="NAME">run</span><span class="PUNC">++</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">fn</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>286</span> </span><span class="WHIT">              </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>287</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>288</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>289</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>290</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>291</span> </span><span class="WHIT">        </span><span class="NAME">uu.module._inject</span><span class="PUNC">(</span><span class="NAME">i</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">v</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>292</span> </span><span class="WHIT">          </span><span class="NAME">onload</span><span class="PUNC">:</span><span class="WHIT">  </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">uu.module.isLoaded</span><span class="PUNC">(</span><span class="NAME">mods</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">run</span><span class="PUNC">++</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">fn</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>293</span> </span><span class="WHIT">          </span><span class="NAME">onerror</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">uu.module._reload</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>294</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>295</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>296</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>297</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>298</span> 
<span class='linenumber'>299</span> </span><span class="COMM">/** &lt;b>uu.module.loadSync -モジュールの同期ロード(load module[Sync])&lt;/b>
<span class='linenumber'>300</span>  *
<span class='linenumber'>301</span>  * モジュールを順番にロードし、全モジュールのロード完了で、fn() をコールします。&lt;br />
<span class='linenumber'>302</span>  * モジュールの検索パス(path)は複数指定可能です。&lt;br />
<span class='linenumber'>303</span>  * 最初に指定した検索パスからモジュールをロードできない場合は、検索パスがあるかぎり順次試行します。&lt;br />
<span class='linenumber'>304</span>  * 全検索パスを試行してもロードできない場合は例外を発生させます。&lt;br />
<span class='linenumber'>305</span>  *
<span class='linenumber'>306</span>  * 検索パスの指定を省略すると、uu.config.modulePathで指定されたURLを検索パスとして使用します。&lt;br />
<span class='linenumber'>307</span>  *
<span class='linenumber'>308</span>  * &lt;pre class="eg">
<span class='linenumber'>309</span>  * // http://example.com/ 以下から ui,dragモジュールのロードを試み、失敗した場合は、
<span class='linenumber'>310</span>  * // http://example.net/latest/ 以下からモジュールのロードを試みる。
<span class='linenumber'>311</span>  * uu.module.loadSync("http://example.com/,http://example.net/latest/", "ui,drag");
<span class='linenumber'>312</span>  * &lt;/pre>
<span class='linenumber'>313</span>  *
<span class='linenumber'>314</span>  * 複数の検索パスをうまく組み合わせると、本番系が接続しにくい場合に、
<span class='linenumber'>315</span>  * 自動的に予備系のサーバからスクリプトをロードするといった動作の指定が可能になります。&lt;br />
<span class='linenumber'>316</span>  *
<span class='linenumber'>317</span>  * 既にロード済みのモジュールを指定すると、即座にfnを呼び出します。
<span class='linenumber'>318</span>  *
<span class='linenumber'>319</span>  * @param taxing [path] - 検索パスの指定です。絶対URLや相対パスを指定します。&lt;br />
<span class='linenumber'>320</span>  *                        空文字列を指定すると、uu.config.modulePathで指定されたURLを検索パスとして使用します。&lt;br />
<span class='linenumber'>321</span>  *                        デフォルトは空文字列("")です。&lt;br />
<span class='linenumber'>322</span>  * @param taxing module - モジュールの指定です。
<span class='linenumber'>323</span>  * @param function [fn] - ロード完了後にコールバックするメソッドを指定します。デフォルトはundefinedです。
<span class='linenumber'>324</span>  * @throws Error          "uu.module.load({module}) timeout" タイムアウト
<span class='linenumber'>325</span>  * @throws Error          "uu.module.load({module}) failed"  ロード失敗
<span class='linenumber'>326</span>  * @see uu.config.modulePath - モジュール検索パスの指定
<span class='linenumber'>327</span>  * @see uu.module.timeout - タイムアウト時間の指定
<span class='linenumber'>328</span>  * @see uu.module.delay - 遅延時間の指定
<span class='linenumber'>329</span>  * @see uu.module.load - 非同期ロード
<span class='linenumber'>330</span>  * @see uu.module.isLoaded - モジュール読込済みでtrueを返す
<span class='linenumber'>331</span>  * @see uu.baseURL - uupaa.jsのカレントパスを返す
<span class='linenumber'>332</span>  */</span><span class="WHIT">
<span class='linenumber'>333</span> </span><span class="NAME">uu.module.loadSync</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">path</span><span class="WHIT"> </span><span class="COMM">/* = "" */</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">module</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">fn</span><span class="WHIT"> </span><span class="COMM">/* = undefined */</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>334</span> </span><span class="WHIT">  </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">last</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">src</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">uu.module._buildURL</span><span class="PUNC">(</span><span class="NAME">path</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">uu.config.modulePath</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">module</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>335</span> </span><span class="WHIT">      </span><span class="NAME">tick</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">order</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">node</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>336</span> </span><span class="WHIT">  </span><span class="NAME">fn</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">fn</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">uu.mute</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>337</span> 
<span class='linenumber'>338</span> </span><span class="WHIT">  </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">uu.module.isLoaded</span><span class="PUNC">(</span><span class="NAME">module</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">fn</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="COMM">// already loaded</span><span class="WHIT">
<span class='linenumber'>339</span> 
<span class='linenumber'>340</span> </span><span class="WHIT">  </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="PUNC">(</span><span class="NAME">order</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">uu.indexes</span><span class="PUNC">(</span><span class="NAME">src</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">length</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">fn</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT">
<span class='linenumber'>341</span> </span><span class="WHIT">    </span><span class="NAME">last</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">order.shift</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>342</span> </span><span class="WHIT">    </span><span class="NAME">node</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">uu.module._inject</span><span class="PUNC">(</span><span class="NAME">last</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">src</span><span class="PUNC">[</span><span class="NAME">last</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>343</span> </span><span class="WHIT">    </span><span class="NAME">uuw.setTimeout</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>344</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">tick</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">uu.module.delay</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NAME">uu.module.timeout</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>345</span> </span><span class="WHIT">        </span><span class="NAME">node</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">uu.module._reload</span><span class="PUNC">(</span><span class="NAME">node</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>346</span> </span><span class="WHIT">        </span><span class="NAME">tick</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>347</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>348</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">uu.module.isLoaded</span><span class="PUNC">(</span><span class="NAME">last</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>349</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">order.length</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">fn</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="COMM">// complete</span><span class="WHIT">
<span class='linenumber'>350</span> </span><span class="WHIT">        </span><span class="NAME">last</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">order.shift</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>351</span> </span><span class="WHIT">        </span><span class="NAME">node</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">uu.module._inject</span><span class="PUNC">(</span><span class="NAME">last</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">src</span><span class="PUNC">[</span><span class="NAME">last</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>352</span> </span><span class="WHIT">        </span><span class="NAME">tick</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>353</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>354</span> </span><span class="WHIT">      </span><span class="NAME">uuw.setTimeout</span><span class="PUNC">(</span><span class="NAME">arguments.callee</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">uu.module.delay</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>355</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT">
<span class='linenumber'>356</span> </span><span class="WHIT">  </span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>357</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>358</span> </span><span class="COMM">/** &lt;b>uu.module._buildURL - URLのビルド&lt;/b>
<span class='linenumber'>359</span>  *
<span class='linenumber'>360</span>  * @param taxing path
<span class='linenumber'>361</span>  * @param taxing module
<span class='linenumber'>362</span>  * @return hash - { module-name: [url], ...}
<span class='linenumber'>363</span>  */</span><span class="WHIT">
<span class='linenumber'>364</span> </span><span class="NAME">uu.module._buildURL</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">path</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">module</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>365</span> </span><span class="WHIT">  </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">rv</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>366</span> </span><span class="WHIT">  </span><span class="NAME">path</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">uu.notax</span><span class="PUNC">(</span><span class="NAME">path</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>367</span> </span><span class="WHIT">  </span><span class="NAME">uu.notax</span><span class="PUNC">(</span><span class="NAME">module</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">forEach</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">m</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>368</span> </span><span class="WHIT">    </span><span class="NAME">rv</span><span class="PUNC">[</span><span class="NAME">m</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>369</span> </span><span class="WHIT">    </span><span class="NAME">path.forEach</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>370</span> </span><span class="WHIT">      </span><span class="NAME">rv</span><span class="PUNC">[</span><span class="NAME">m</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">push</span><span class="PUNC">(</span><span class="NAME">p</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"uu.module."</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">m</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">".js"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>371</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>372</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>373</span> </span><span class="WHIT">  </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">rv</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>374</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>375</span> 
<span class='linenumber'>376</span> </span><span class="COMM">/** &lt;b>uu.module._reload - script要素の差し替え(リロード)&lt;/b>
<span class='linenumber'>377</span>  */</span><span class="WHIT">
<span class='linenumber'>378</span> </span><span class="NAME">uu.module._reload</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">node</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">async</span><span class="WHIT"> </span><span class="COMM">/* = true */</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>379</span> </span><span class="WHIT">  </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">n</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">uud.head.removeChild</span><span class="PUNC">(</span><span class="NAME">node</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">next</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">e</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>380</span> </span><span class="WHIT">  </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">n.uuList.length</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">throw</span><span class="WHIT"> </span><span class="NAME">Error</span><span class="PUNC">(</span><span class="STRN">"uu.module.load("</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">node.uuModule</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">") failed"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>381</span> </span><span class="WHIT">  </span><span class="NAME">next</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">n.uuList.shift</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>382</span> </span><span class="WHIT">  </span><span class="NAME">e</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">uu.mix</span><span class="PUNC">(</span><span class="NAME">uu.js.create</span><span class="PUNC">(</span><span class="NAME">n.id</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">uuModule</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">n.uuModule</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">uuList</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">n.uuList</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>383</span> </span><span class="WHIT">  </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">uu.isU</span><span class="PUNC">(</span><span class="NAME">async</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">async</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>384</span> </span><span class="WHIT">    </span><span class="NAME">uu.mix</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">uu.ua.ie</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">onreadystatechange</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">n.onreadystatechange</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT">
<span class='linenumber'>385</span> </span><span class="WHIT">                         </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">onload</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">n.onload</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">onerror</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">n.onerror</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>386</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>387</span> </span><span class="WHIT">  </span><span class="NAME">e.src</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">next</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>388</span> </span><span class="WHIT">  </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">uud.head.appendChild</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// src設定後にドキュメントツリーに追加しないとIEでは動作しない</span><span class="WHIT">
<span class='linenumber'>389</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>390</span> 
<span class='linenumber'>391</span> </span><span class="COMM">/** &lt;b>uu.module._inject - script要素の差し込み&lt;/b>
<span class='linenumber'>392</span>  *
<span class='linenumber'>393</span>  * 
<span class='linenumber'>394</span>  */</span><span class="WHIT">
<span class='linenumber'>395</span> </span><span class="NAME">uu.module._inject</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">name</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">list</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">param</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>396</span> </span><span class="WHIT">  </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">src</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">list.shift</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>397</span> </span><span class="WHIT">      </span><span class="NAME">e</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">uu.mix</span><span class="PUNC">(</span><span class="NAME">uu.js.create</span><span class="PUNC">(</span><span class="STRN">"uu.module."</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">name</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">".js"</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">uuModule</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">name</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">uuList</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">list</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>398</span> </span><span class="WHIT">  </span><span class="NAME">uu.mix</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">param</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>399</span> </span><span class="WHIT">  </span><span class="COMM">// IE6/7/8は、script要素にsrcを設定してからappendChild()を行わないとスクリプトがロードされない</span><span class="WHIT">
<span class='linenumber'>400</span> </span><span class="WHIT">  </span><span class="COMM">// これは (new Image()).src のケースとは挙動が異なる。</span><span class="WHIT">
<span class='linenumber'>401</span> </span><span class="WHIT">  </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">uu.ua.ie</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>402</span> </span><span class="WHIT">    </span><span class="NAME">e.src</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">src</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>403</span> </span><span class="WHIT">    </span><span class="NAME">uud.head.appendChild</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>404</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>405</span> </span><span class="WHIT">    </span><span class="NAME">uud.head.appendChild</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>406</span> </span><span class="WHIT">    </span><span class="NAME">e.src</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">src</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>407</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>408</span> </span><span class="WHIT">  </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">e</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>409</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>410</span> 
<span class='linenumber'>411</span> </span><span class="COMM">////////////////////////////////////////////////////////////</span><span class="WHIT">
<span class='linenumber'>412</span> </span><span class="COMM">/** &lt;b>URL&lt;/b>
<span class='linenumber'>413</span>  *
<span class='linenumber'>414</span>  * @class
<span class='linenumber'>415</span>  */</span><span class="WHIT">
<span class='linenumber'>416</span> </span><span class="NAME">uu.url</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>417</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>418</span> </span><span class="COMM">/** &lt;b>uu.url.abs - 相対パスを絶対パスに変換&lt;/b>
<span class='linenumber'>419</span>  *
<span class='linenumber'>420</span>  * 相対パス(相対URL)を絶対パス(絶対URL)に変換した新しい文字列を返します。
<span class='linenumber'>421</span>  *
<span class='linenumber'>422</span>  * &lt;pre class="eg">uu.url.abs("./image.jpg"); // "http://www.example.com/image.jpg"&lt;/pre>
<span class='linenumber'>423</span>  *
<span class='linenumber'>424</span>  * @param string str - 相対パス文字列を指定します。
<span class='linenumber'>425</span>  * @return string - 変換後の文字列を返します。
<span class='linenumber'>426</span>  * @see &lt;a href="#fileName">uu.url.fileName&lt;/a> - パス文字列からファイル名を取得
<span class='linenumber'>427</span>  * @see &lt;a href="#path">uu.url.path&lt;/a> - パス文字列からパスを取得
<span class='linenumber'>428</span>  */</span><span class="WHIT">
<span class='linenumber'>429</span> </span><span class="NAME">uu.url.abs</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">str</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>430</span> </span><span class="WHIT">  </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">impl</span><span class="PUNC">(</span><span class="NAME">s</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>431</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">e</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">uud.createElement</span><span class="PUNC">(</span><span class="STRN">"div"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>432</span> </span><span class="WHIT">    </span><span class="NAME">e.innerHTML</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'&lt;a href="'</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">s</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">'" />'</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>433</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">e.firstChild.href</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>434</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>435</span> </span><span class="WHIT">  </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="REGX">/^(file|https|http)\:\/\//</span><span class="PUNC">.</span><span class="NAME">test</span><span class="PUNC">(</span><span class="NAME">str</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">str</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">impl</span><span class="PUNC">(</span><span class="NAME">str</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>436</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>437</span> </span><span class="COMM">/** &lt;b>uu.url.fileName - パス文字列からファイル名を取得&lt;/b>
<span class='linenumber'>438</span>  *
<span class='linenumber'>439</span>  * &lt;pre class="eg">uu.url.fileName("./path/file.ext"); // "file.ext"&lt;/pre>
<span class='linenumber'>440</span>  *
<span class='linenumber'>441</span>  * @param string str - パス文字列を指定します。
<span class='linenumber'>442</span>  * @return string - パス文字列に含まれているファイル名部分を返します。&lt;br />
<span class='linenumber'>443</span>  *                  ファイル名が見つからなければ空文字列を返します。
<span class='linenumber'>444</span>  * @see &lt;a href="#abs">uu.url.abs&lt;/a> - 相対パスを絶対パスに変換
<span class='linenumber'>445</span>  * @see &lt;a href="#path">uu.url.path&lt;/a> - パス文字列からパスを取得
<span class='linenumber'>446</span>  */</span><span class="WHIT">
<span class='linenumber'>447</span> </span><span class="NAME">uu.url.fileName</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">str</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>448</span> </span><span class="WHIT">  </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">rv</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">str.split</span><span class="PUNC">(</span><span class="STRN">"/"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>449</span> </span><span class="WHIT">  </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">rv</span><span class="PUNC">[</span><span class="NAME">rv.length</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>450</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>451</span> </span><span class="COMM">/** &lt;b>uu.url.path - パス文字列からパスを取得&lt;/b>
<span class='linenumber'>452</span>  *
<span class='linenumber'>453</span>  * &lt;pre class="eg">uu.url.path("./path/file.ext"); // "./path"&lt;/pre>
<span class='linenumber'>454</span>  * 
<span class='linenumber'>455</span>  * @param string str - パス文字列を指定します。
<span class='linenumber'>456</span>  * @return string - パス文字列に含まれているパス部分を返します。&lt;br />
<span class='linenumber'>457</span>  *                  パス部分が見つからなければ空文字列を返します。
<span class='linenumber'>458</span>  * @see &lt;a href="#abs">uu.url.abs&lt;/a> - 相対パスを絶対パスに変換
<span class='linenumber'>459</span>  * @see &lt;a href="#fileName">uu.url.fileName&lt;/a> - パス文字列からファイル名を取得
<span class='linenumber'>460</span>  */</span><span class="WHIT">
<span class='linenumber'>461</span> </span><span class="NAME">uu.url.path</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">str</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>462</span> </span><span class="WHIT">  </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">sl</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">str.lastIndexOf</span><span class="PUNC">(</span><span class="STRN">"/"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>463</span> </span><span class="WHIT">  </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">sl</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="STRN">""</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">str.slice</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">sl</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>464</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>465</span> </span><span class="COMM">/** &lt;b>uu.url.query - クエリ文字列をhashで取得&lt;/b>
<span class='linenumber'>466</span>  *
<span class='linenumber'>467</span>  * URLのクエリ文字列(key1=value1&key2=value2, ...)をパースし、
<span class='linenumber'>468</span>  * hash({ key1: "value1", key2: "value2" })を返します。&lt;br />&lt;br />
<span class='linenumber'>469</span>  *
<span class='linenumber'>470</span>  * encodeURIComponent()でエンコードされている文字列を適切にデコードします。
<span class='linenumber'>471</span>  *
<span class='linenumber'>472</span>  * &lt;pre class="eg">
<span class='linenumber'>473</span>     var url = uu.url.query.add("", "key", "a:?="); // "?key=a%3A%3F%3D"
<span class='linenumber'>474</span>     var rv  = uu.url.query(url, true);
<span class='linenumber'>475</span>  * &lt;/pre>
<span class='linenumber'>476</span>  *
<span class='linenumber'>477</span>  * @param string qstr - クエリ文字列を指定します。
<span class='linenumber'>478</span>  * @return hash - hashを返します。
<span class='linenumber'>479</span>  * @namespace
<span class='linenumber'>480</span>  */</span><span class="WHIT">
<span class='linenumber'>481</span> </span><span class="NAME">uu.url.query</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">qstr</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>482</span> </span><span class="WHIT">  </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">rv</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">F</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">uuw.decodeURIComponent</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>483</span> </span><span class="WHIT">  </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">decode</span><span class="PUNC">(</span><span class="NAME">match</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">key</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">value</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">rv</span><span class="PUNC">[</span><span class="NAME">F</span><span class="PUNC">(</span><span class="NAME">key</span><span class="PUNC">)</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">F</span><span class="PUNC">(</span><span class="NAME">value</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>484</span> </span><span class="WHIT">  </span><span class="NAME">qstr.replace</span><span class="PUNC">(</span><span class="REGX">/^.*\?/</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">replace</span><span class="PUNC">(</span><span class="REGX">/(?:([^\=]+)\=([^\&]+))/g</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">decode</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// "?"の左側を切り落とし "key=value"で切り分ける</span><span class="WHIT">
<span class='linenumber'>485</span> </span><span class="WHIT">  </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">rv</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>486</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>487</span> </span><span class="COMM">/** &lt;b>uu.url.query.add - クエリ文字列を追加&lt;/b>
<span class='linenumber'>488</span>  *
<span class='linenumber'>489</span>  * URL文字列の末尾にクエリ文字列("?key1=value1&key2=value2, ...)を追加します。&lt;br />&lt;br />
<span class='linenumber'>490</span>  *
<span class='linenumber'>491</span>  * key,valueをencodeURIComponent()で適切にエンコードします。
<span class='linenumber'>492</span>  *
<span class='linenumber'>493</span>  * &lt;pre class="eg">
<span class='linenumber'>494</span>    // "http://www.example.com/?key1=value1&key2=value2"
<span class='linenumber'>495</span>    uu.url.query.add("http://www.example.com/", { key1: "value1", key2: "value2" });
<span class='linenumber'>496</span>    
<span class='linenumber'>497</span>    // "http://www.example.com/?key3=value3"
<span class='linenumber'>498</span>    uu.url.query.add("http://www.example.com/", "key3", "value3");
<span class='linenumber'>499</span>  * &lt;/pre>
<span class='linenumber'>500</span>  *
<span class='linenumber'>501</span>  * @param string url - URLを指定します。
<span class='linenumber'>502</span>  * @param string/hash key - keyを指定します。hash{ key1: value1, key2: value2, ... }も指定可能です。
<span class='linenumber'>503</span>  * @param string [value] - valueを指定します。keyにhashを指定した場合はこの引数は無視されます。
<span class='linenumber'>504</span>  * @return string - クエリ文字列を追加したURL文字列を返します。
<span class='linenumber'>505</span>  */</span><span class="WHIT">
<span class='linenumber'>506</span> </span><span class="NAME">uu.url.query.add</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">url</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">key</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">value</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>507</span> </span><span class="WHIT">  </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">rv</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">F</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">uuw.encodeURIComponent</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>508</span> </span><span class="WHIT">  </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">pair</span><span class="PUNC">(</span><span class="NAME">value</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">key</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">rv.push</span><span class="PUNC">(</span><span class="NAME">F</span><span class="PUNC">(</span><span class="NAME">key</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"="</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">F</span><span class="PUNC">(</span><span class="NAME">value</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>509</span> </span><span class="WHIT">  </span><span class="PUNC">(</span><span class="NAME">uu.isS</span><span class="PUNC">(</span><span class="NAME">key</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">pair</span><span class="PUNC">(</span><span class="NAME">value</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">key</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">uu.forEach</span><span class="PUNC">(</span><span class="NAME">key</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">pair</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>510</span> </span><span class="WHIT">  </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">url</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">url.lastIndexOf</span><span class="PUNC">(</span><span class="STRN">"?"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="STRN">"?"</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">"&"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">rv.join</span><span class="PUNC">(</span><span class="STRN">"&"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>511</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>512</span> 
<span class='linenumber'>513</span> </span><span class="COMM">////////////////////////////////////////////////////////////</span><span class="WHIT">
<span class='linenumber'>514</span> </span><span class="COMM">/** &lt;b>Script&lt;/b>
<span class='linenumber'>515</span>  *
<span class='linenumber'>516</span>  * @class
<span class='linenumber'>517</span>  */</span><span class="WHIT">
<span class='linenumber'>518</span> </span><span class="NAME">uu.js</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>519</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>520</span> 
<span class='linenumber'>521</span> </span><span class="COMM">/** &lt;b>uu.js.create - script要素の生成&lt;/b>
<span class='linenumber'>522</span>  *
<span class='linenumber'>523</span>  * @return element - 生成したscript要素を返します。
<span class='linenumber'>524</span>  */</span><span class="WHIT">
<span class='linenumber'>525</span> </span><span class="NAME">uu.js.create</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">id</span><span class="WHIT"> </span><span class="COMM">/* = "" */</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>526</span> </span><span class="WHIT">  </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">uu.mix</span><span class="PUNC">(</span><span class="NAME">document.createElement</span><span class="PUNC">(</span><span class="STRN">"script"</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>527</span> </span><span class="WHIT">    </span><span class="NAME">type</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">"text/javascript"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">charset</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">"utf-8"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">id</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">id</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="STRN">""</span><span class="WHIT">
<span class='linenumber'>528</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>529</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>530</span> 
<span class='linenumber'>531</span> </span><span class="COMM">/** &lt;b>uu.js.exec - JavaScript文字列をグローバルネームスペースで評価&lt;/b>
<span class='linenumber'>532</span>  *
<span class='linenumber'>533</span>  * @return element - head要素から削除したscript要素を返します。
<span class='linenumber'>534</span>  */</span><span class="WHIT">
<span class='linenumber'>535</span> </span><span class="NAME">uu.js.exec</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">code</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>536</span> </span><span class="WHIT">  </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">uud.head.removeChild</span><span class="PUNC">(</span><span class="NAME">uud.head.appendChild</span><span class="PUNC">(</span><span class="NAME">uu.mix</span><span class="PUNC">(</span><span class="NAME">uu.js.create</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">text</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">code</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>537</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>538</span> 
<span class='linenumber'>539</span> </span><span class="COMM">////////////////////////////////////////////////////////////</span><span class="WHIT">
<span class='linenumber'>540</span> </span><span class="COMM">/** &lt;b>uu.attr - 属性を持ち値が一致する要素を列挙(document.getElementsByAttribute wrapper)&lt;/b>
<span class='linenumber'>541</span>  *
<span class='linenumber'>542</span>  * 属性(アトリビュート)を持ち、値が一致する要素を列挙します。&lt;br />
<span class='linenumber'>543</span>  * valueと完全に一致する値を持つ要素を列挙します。
<span class='linenumber'>544</span>  *
<span class='linenumber'>545</span>  * @param string  attr      - 属性名を指定します。
<span class='linenumber'>546</span>  * @param string  [value]   - 検索する属性値を指定します。アスタリスク("*")を指定すると値による絞込みをしません。&lt;br />
<span class='linenumber'>547</span>  *                            デフォルトは"*"です。
<span class='linenumber'>548</span>  * @param element [context] - 検索開始位置(コンテキスト)を指定します。デフォルトはdocumentです。
<span class='linenumber'>549</span>  * @param string  [tag]     - getElementsByAttribute()が実装されていないブラウザで、
<span class='linenumber'>550</span>  *                            tagに指定したタグのみを検索対象とします。
<span class='linenumber'>551</span>  *                            検索対象を限定することで速度を稼ぎます。
<span class='linenumber'>552</span>  * @return NodeList/array - 検索成功でNodeListまたは要素の配列 [element, ...] を返します。失敗で空のNodeListか配列を返します。&lt;br />
<span class='linenumber'>553</span>  *                          NodeListまたは配列を返すため、uu.attr().forEach() ではなく、
<span class='linenumber'>554</span>  *                          uu.forEach(uu.attr())を使用してください。
<span class='linenumber'>555</span>  * @see &lt;a href="http://uupaa-js.googlecode.com/svn/trunk/SELECTOR.htm">セレクタ(Selector)&lt;/a>
<span class='linenumber'>556</span>  * @class
<span class='linenumber'>557</span>  */</span><span class="WHIT">
<span class='linenumber'>558</span> </span><span class="NAME">uu.attr</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">attr</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">value</span><span class="WHIT"> </span><span class="COMM">/* = "*" */</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">context</span><span class="WHIT"> </span><span class="COMM">/* = document */</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">tag</span><span class="WHIT"> </span><span class="COMM">/* = undefined */</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>559</span> </span><span class="WHIT">  </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">context</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">uud</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">getElementsByAttribute</span><span class="PUNC">(</span><span class="NAME">attr</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">value</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="STRN">"*"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>560</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>561</span> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">uud.getElementsByAttribute</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>562</span> </span><span class="WHIT">  </span><span class="NAME">uu.attr</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">attr</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">value</span><span class="WHIT"> </span><span class="COMM">/* = "" */</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">context</span><span class="WHIT"> </span><span class="COMM">/* = document */</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">tag</span><span class="WHIT"> </span><span class="COMM">/* = undefined */</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>563</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">x</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">n</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">v</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">v</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">"*"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="STRN">"@"</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">n</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="STRN">"@"</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">v</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"=\""</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">n</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"\""</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>564</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">uu.xpath.snap</span><span class="PUNC">(</span><span class="STRN">'.//'</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">tag</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="STRN">'*'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">'['</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">x</span><span class="PUNC">(</span><span class="NAME">attr</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">value</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="STRN">"*"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">']'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">context</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">uud</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>565</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>566</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>567</span> 
<span class='linenumber'>568</span> </span><span class="COMM">/** &lt;b>uu.attr.get - 属性の取得(document.getAttribute warpper)&lt;/b>
<span class='linenumber'>569</span>  *
<span class='linenumber'>570</span>  * 属性(アトリビュート)を取得します。&lt;br />
<span class='linenumber'>571</span>  * setAttributeで設定された独自の属性があればそちらを取得しますが、
<span class='linenumber'>572</span>  * Elementノードに同名の属性値があればそちらを優先します。&lt;br />
<span class='linenumber'>573</span>  * 存在しない属性名を指定した場合は空文字列("")を返します。
<span class='linenumber'>574</span>  *
<span class='linenumber'>575</span>  * @param element elm  - 属性を取得する要素を指定します。
<span class='linenumber'>576</span>  * @param taxing  attr - 属性名の指定です。
<span class='linenumber'>577</span>  * @return hash/string - attrに複数の属性名を指定すると hash({ attr: value })を返します。&lt;br />
<span class='linenumber'>578</span>  *                       attrに属性名を1つだけ指定すると 属性値 を文字列で返します。
<span class='linenumber'>579</span>  *                       存在しない属性名を指定すると、その要素の戻り値は空文字列("")になります。
<span class='linenumber'>580</span>  * @see uu.attr - 属性の列挙
<span class='linenumber'>581</span>  * @see uu.attr.set - 属性の設定
<span class='linenumber'>582</span>  */</span><span class="WHIT">
<span class='linenumber'>583</span> </span><span class="NAME">uu.attr.get</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">elm</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">attr</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>584</span> </span><span class="WHIT">  </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">uu.isC</span><span class="PUNC">(</span><span class="NAME">attr</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">elm.getAttribute</span><span class="PUNC">(</span><span class="NAME">attr</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>585</span> </span><span class="WHIT">  </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">rv</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>586</span> </span><span class="WHIT">  </span><span class="NAME">uu.notax</span><span class="PUNC">(</span><span class="NAME">attr</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">forEach</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">v</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>587</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">v</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">elm</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>588</span> </span><span class="WHIT">      </span><span class="NAME">rv</span><span class="PUNC">[</span><span class="NAME">v</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">elm</span><span class="PUNC">[</span><span class="NAME">v</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>589</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">elm.hasAttribute</span><span class="PUNC">(</span><span class="NAME">v</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>590</span> </span><span class="WHIT">      </span><span class="NAME">rv</span><span class="PUNC">[</span><span class="NAME">v</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">elm.getAttribute</span><span class="PUNC">(</span><span class="NAME">v</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>591</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>592</span> </span><span class="WHIT">      </span><span class="NAME">rv</span><span class="PUNC">[</span><span class="NAME">v</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>593</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>594</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>595</span> </span><span class="WHIT">  </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">rv</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>596</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>597</span> 
<span class='linenumber'>598</span> </span><span class="COMM">/** &lt;b>uu.attr.set - 属性の設定(document.setAttribute warpper)&lt;/b>
<span class='linenumber'>599</span>  *
<span class='linenumber'>600</span>  * 属性(アトリビュート)の設定
<span class='linenumber'>601</span>  *
<span class='linenumber'>602</span>  * @param element elm  - 属性を設定する要素を指定します。
<span class='linenumber'>603</span>  * @param hash    hash - { attr: value, ...} を指定します。
<span class='linenumber'>604</span>  * @return element - elmを返します。
<span class='linenumber'>605</span>  * @see uu.attr - 属性の列挙
<span class='linenumber'>606</span>  * @see uu.attr.get - 属性の取得
<span class='linenumber'>607</span>  */</span><span class="WHIT">
<span class='linenumber'>608</span> </span><span class="NAME">uu.attr.set</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">elm</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">hash</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>609</span> </span><span class="WHIT">  </span><span class="NAME">uu.forEach</span><span class="PUNC">(</span><span class="NAME">hash</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">v</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>610</span> </span><span class="WHIT">    </span><span class="NAME">elm</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">v</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>611</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>612</span> </span><span class="WHIT">  </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">elm</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>613</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>614</span> 
<span class='linenumber'>615</span> </span><span class="COMM">////////////////////////////////////////////////////////////</span><span class="WHIT">
<span class='linenumber'>616</span> </span><span class="COMM">/** &lt;b>uu.klass - CSSのクラス名と一致する要素を列挙(document.getElementsByClassName wrapper)&lt;/b>
<span class='linenumber'>617</span>  *
<span class='linenumber'>618</span>  * CSSのクラス名と一致する要素を列挙します。
<span class='linenumber'>619</span>  *
<span class='linenumber'>620</span>  * @param string  className - クラス名を指定します。
<span class='linenumber'>621</span>  * @param element [context] - 検索開始位置(コンテキスト)を指定します。デフォルトはdocumentです(全要素の検索)。
<span class='linenumber'>622</span>  * @param string  [tag]     - 指定したtagのみ検索対象とする場合に指定します。&lt;br />
<span class='linenumber'>623</span>  *                            この引数は、getElementsByClassName()が実装されていないブラウザ(Firefox2,IE6/7/8,Opera9.2x)用です。
<span class='linenumber'>624</span>  * @return NodeList/array   - 検索成功でNodeListまたは要素の配列 [element, ...] を返します。失敗で空のNodeListか配列を返します。&lt;br />
<span class='linenumber'>625</span>  *                            NodeListまたは配列を返すため、uu.klass().forEach() ではなく、
<span class='linenumber'>626</span>  *                            uu.forEach(uu.klass())を使用してください。
<span class='linenumber'>627</span>  * @see &lt;a href="http://uupaa-js.googlecode.com/svn/trunk/SELECTOR.htm">セレクタ(Selector)&lt;/a>
<span class='linenumber'>628</span>  * @class
<span class='linenumber'>629</span>  */</span><span class="WHIT">
<span class='linenumber'>630</span> </span><span class="NAME">uu.klass</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">className</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">context</span><span class="WHIT"> </span><span class="COMM">/* = document */</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">tag</span><span class="WHIT"> </span><span class="COMM">/* = undefined */</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="COMM">// for Firefox3, Safari3, Opera9.5</span><span class="WHIT">
<span class='linenumber'>631</span> </span><span class="WHIT">  </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">context</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">uud</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">getElementsByClassName</span><span class="PUNC">(</span><span class="NAME">className</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>632</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>633</span> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">uud.getElementsByClassName</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="COMM">// for Firefox2, IE6/7/8, Opera9.2x</span><span class="WHIT">
<span class='linenumber'>634</span> </span><span class="WHIT">  </span><span class="NAME">uu.klass</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">className</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">context</span><span class="WHIT"> </span><span class="COMM">/* = document */</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">tag</span><span class="WHIT"> </span><span class="COMM">/* = undefined */</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>635</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">x</span><span class="PUNC">(</span><span class="NAME">cn</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="STRN">'contains(concat(" ",@class," ")," '</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">cn</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">' ")'</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>636</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">c</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">className</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">rule</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">c.indexOf</span><span class="PUNC">(</span><span class="STRN">' '</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">>=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">c.match</span><span class="PUNC">(</span><span class="REGX">/\w+/g</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">map</span><span class="PUNC">(</span><span class="NAME">x</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">join</span><span class="PUNC">(</span><span class="STRN">" and "</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">x</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>637</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">uu.xpath.snap</span><span class="PUNC">(</span><span class="STRN">'.//'</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">tag</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="STRN">'*'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">'['</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">rule</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">']'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">context</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">uud</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>638</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>639</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>640</span> 
<span class='linenumber'>641</span> </span><span class="COMM">/** &lt;b>uu.css - CSS3のセレクタと一致する要素を列挙&lt;/b>
<span class='linenumber'>642</span>  *
<span class='linenumber'>643</span>  * CSS3のセレクタと一致する要素を列挙します。&lt;br />
<span class='linenumber'>644</span>  * この関数は内部でCSS3セレクタをXPathに変換します。&lt;br />&lt;br />
<span class='linenumber'>645</span>  * uu.config.verboseがtrueで、生成したXPathにエラーがある場合は例外をスローします。
<span class='linenumber'>646</span>  *
<span class='linenumber'>647</span>  * &lt;pre class="eg">
<span class='linenumber'>648</span>  *  &lt;div class="header">div.header&lt;/div>
<span class='linenumber'>649</span>  *  &lt;a href="http://www.example.com/" title="CSS3 selector to XPath">CSS3 selector to XPath&lt;/a>
<span class='linenumber'>650</span>  *
<span class='linenumber'>651</span>  *  uu.css('div.header, a[title*="CSS3"]').forEach(function(v) {
<span class='linenumber'>652</span>  *    v.style.backgroundColor = "gold";
<span class='linenumber'>653</span>  *  });
<span class='linenumber'>654</span>  * &lt;/pre>
<span class='linenumber'>655</span>  *
<span class='linenumber'>656</span>  * @param string css3selector - CSS3セレクタを指定します。
<span class='linenumber'>657</span>  * @return array              - 検索成功で要素の配列 [element, ...] を返します。失敗で空の配列を返します。
<span class='linenumber'>658</span>  * @throws TypeError "uu.css(...)" 使用できないセレクタを指定したか、不正なXPathに変換された
<span class='linenumber'>659</span>  * @see &lt;a href="http://uupaa-js.googlecode.com/svn/trunk/SELECTOR.htm">使用可能なセレクタ(Selector)&lt;/a>
<span class='linenumber'>660</span>  * @class
<span class='linenumber'>661</span>  */</span><span class="WHIT">
<span class='linenumber'>662</span> </span><span class="NAME">uu.css</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">css3selector</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>663</span> </span><span class="WHIT">  </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">rv</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">xpath</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">elm</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>664</span> </span><span class="WHIT">  </span><span class="KEYW">try</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>665</span> </span><span class="WHIT">    </span><span class="NAME">xpath</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">uu.css.toXPath</span><span class="PUNC">(</span><span class="NAME">css3selector</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>666</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">xpath</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>667</span> </span><span class="WHIT">      </span><span class="NAME">elm</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">document.evaluate</span><span class="PUNC">(</span><span class="NAME">xpath</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">document</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">7</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>668</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">elm</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="STRN">"snapshotLength"</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">elm</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>669</span> </span><span class="WHIT">        </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">elm.snapshotLength</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">++</span><span class="NAME">i</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>670</span> </span><span class="WHIT">          </span><span class="NAME">rv.push</span><span class="PUNC">(</span><span class="NAME">elm.snapshotItem</span><span class="PUNC">(</span><span class="NAME">i</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>671</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>672</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>673</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>674</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">catch</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>675</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">uu.config.verbose</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>676</span> </span><span class="WHIT">      </span><span class="KEYW">throw</span><span class="WHIT"> </span><span class="NAME">TypeError</span><span class="PUNC">(</span><span class="STRN">"uu.css("</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">css3selector</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">") -> "</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">xpath</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>677</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>678</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>679</span> </span><span class="WHIT">  </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">rv</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>680</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>681</span> 
<span class='linenumber'>682</span> </span><span class="COMM">/** &lt;b>uu.css.addClass - classNameを追加&lt;/b>
<span class='linenumber'>683</span>  *
<span class='linenumber'>684</span>  * 要素のclassNameにクラスを追加します。
<span class='linenumber'>685</span>  *
<span class='linenumber'>686</span>  * &lt;pre class="eg">
<span class='linenumber'>687</span>  * uu.forEach(uu.klass("alpha"), function(v) {
<span class='linenumber'>688</span>  *   uu.css.addClass(v, "beta,hoge,huga,piyo"); // まとめて追加
<span class='linenumber'>689</span>  * });
<span class='linenumber'>690</span>  * &lt;/pre>
<span class='linenumber'>691</span>  *
<span class='linenumber'>692</span>  * @param element elm - 要素を指定します。
<span class='linenumber'>693</span>  * @param taxing  tax - クラス名を指定します。
<span class='linenumber'>694</span>  * @see &lt;a href="#hasClass">uu.css.hasClass&lt;/a> - classNameがあればtrue
<span class='linenumber'>695</span>  * @see &lt;a href="#removeClass">uu.css.removeClass&lt;/a> - classNameを削除
<span class='linenumber'>696</span>  */</span><span class="WHIT">
<span class='linenumber'>697</span> </span><span class="NAME">uu.css.addClass</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">elm</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">tax</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>698</span> </span><span class="WHIT">  </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">rv</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>699</span> </span><span class="WHIT">  </span><span class="NAME">uu.notax</span><span class="PUNC">(</span><span class="NAME">tax</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">forEach</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">v</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">rv.push</span><span class="PUNC">(</span><span class="STRN">" "</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">v</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>700</span> </span><span class="WHIT">  </span><span class="NAME">elm.className</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">uu.rtrim</span><span class="PUNC">(</span><span class="NAME">elm.className</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">rv.join</span><span class="PUNC">(</span><span class="STRN">""</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>701</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>702</span> 
<span class='linenumber'>703</span> </span><span class="COMM">/** &lt;b>uu.css.hasClass - classNameがあればtrue&lt;/b>
<span class='linenumber'>704</span>  *
<span class='linenumber'>705</span>  * 要素のclassNameにnameが含まれていればtrueを返します。
<span class='linenumber'>706</span>  *
<span class='linenumber'>707</span>  * @param element elm  - 要素を指定します。
<span class='linenumber'>708</span>  * @param string  name - クラス名を指定します。
<span class='linenumber'>709</span>  * @return bool        - classNameにnameが含まれていればtrueを返します。
<span class='linenumber'>710</span>  * @see &lt;a href="#addClass">uu.css.addClass&lt;/a> - classNameを追加
<span class='linenumber'>711</span>  * @see &lt;a href="#removeClass">uu.css.removeClass&lt;/a> - classNameを削除
<span class='linenumber'>712</span>  */</span><span class="WHIT">
<span class='linenumber'>713</span> </span><span class="NAME">uu.css.hasClass</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">elm</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">name</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>714</span> </span><span class="WHIT">  </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">elm.className</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">" "</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">indexOf</span><span class="PUNC">(</span><span class="NAME">name</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">" "</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>715</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>716</span> 
<span class='linenumber'>717</span> </span><span class="COMM">/** &lt;b>uu.css.removeClass - classNameを削除&lt;/b>
<span class='linenumber'>718</span>  *
<span class='linenumber'>719</span>  * 要素のclassNameから、nameを削除します。
<span class='linenumber'>720</span>  *
<span class='linenumber'>721</span>  * &lt;pre class="eg">
<span class='linenumber'>722</span>  * uu.forEach(uu.klass("alpha"), function(v) {
<span class='linenumber'>723</span>  *   uu.css.removeClass(v, "beta"); // 削除は１つずつ
<span class='linenumber'>724</span>  * });
<span class='linenumber'>725</span>  * &lt;/pre>
<span class='linenumber'>726</span>  *
<span class='linenumber'>727</span>  * @param element elm - 要素を指定します。
<span class='linenumber'>728</span>  * @param string  name - クラス名を指定します。
<span class='linenumber'>729</span>  * @see &lt;a href="#addClass">uu.css.addClass&lt;/a> - classNameを追加
<span class='linenumber'>730</span>  * @see &lt;a href="#hasClass">uu.css.hasClass&lt;/a> - classNameがあればtrue
<span class='linenumber'>731</span>  */</span><span class="WHIT">
<span class='linenumber'>732</span> </span><span class="NAME">uu.css.removeClass</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">elm</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">name</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>733</span> </span><span class="WHIT">  </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">e</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">elm.className</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">" "</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">re</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">RegExp</span><span class="PUNC">(</span><span class="NAME">name</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">" "</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>734</span> </span><span class="WHIT">  </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">re.test</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>735</span> </span><span class="WHIT">    </span><span class="NAME">elm.className</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">e.replace</span><span class="PUNC">(</span><span class="NAME">re</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>736</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>737</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>738</span> 
<span class='linenumber'>739</span> </span><span class="COMM">/** &lt;b>uu.css.cssProp - css-propをcssPropに変換&lt;/b>
<span class='linenumber'>740</span>  *
<span class='linenumber'>741</span>  * css-prop("z-index")を、cssProp("zIndex")に変換した新しい文字列を返します。&lt;br />
<span class='linenumber'>742</span>  * JavaScriptの予約語の変換も行います。例: "float" → "cssFloat"
<span class='linenumber'>743</span>  *
<span class='linenumber'>744</span>  * &lt;pre class="eg">
<span class='linenumber'>745</span>  * uu.css.cssProp("float"); // "cssFloat"
<span class='linenumber'>746</span>  * uu.css.cssProp("font-weight"); // "fontWeight"
<span class='linenumber'>747</span>  * &lt;/pre>
<span class='linenumber'>748</span>  *
<span class='linenumber'>749</span>  * @param string css - css-propを指定します。
<span class='linenumber'>750</span>  * @return string - 変換後の文字列を返します。
<span class='linenumber'>751</span>  * @see &lt;a href="#camelize">String.camelize&lt;/a> - キャメライズ
<span class='linenumber'>752</span>  */</span><span class="WHIT">
<span class='linenumber'>753</span> </span><span class="NAME">uu.css.cssProp</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>754</span> </span><span class="WHIT">  </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">camelize</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>755</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.replace</span><span class="PUNC">(</span><span class="REGX">/-([a-z])/g</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">_</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">words</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>756</span> </span><span class="WHIT">      </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">words.toUpperCase</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>757</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>758</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>759</span> </span><span class="WHIT">  </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">sp</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="STRN">"float"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">uu.ua.ie</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="STRN">"styleFloat"</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">"cssFloat"</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>760</span> </span><span class="WHIT">  </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">camelize</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">sp</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">sp</span><span class="PUNC">[</span><span class="KEYW">this</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>761</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>762</span> 
<span class='linenumber'>763</span> </span><span class="COMM">/** &lt;b>uu.css.get - スタイルの取得(document.defaultView.getComputedStyle wrapper)&lt;/b>
<span class='linenumber'>764</span>  *
<span class='linenumber'>765</span>  * 要素に適用されている計算済みのスタイルを取得します。&lt;br />
<span class='linenumber'>766</span>  * この関数はpseudo elementをサポートしません。
<span class='linenumber'>767</span>  *
<span class='linenumber'>768</span>  * @param element       elm       - スタイルを取得する要素を指定します。
<span class='linenumber'>769</span>  * @param taxing        [cssProp] - cssPropまたはcss-propを指定します。省略できます。
<span class='linenumber'>770</span>  * @param bool          [cure]    - cssPropにcss-prop形式("font-weight")の名前を指定した場合はtrueにします。
<span class='linenumber'>771</span>  *                                  デフォルトはfalseです。
<span class='linenumber'>772</span>  * @return hash/string            - cssPropに複数の要素を指定している場合は hash { cssProp: 計算済みのスタイル, ... }を返します。
<span class='linenumber'>773</span>  *                                  cssPropが単一の要素なら、計算済みのスタイルを文字列で返します。
<span class='linenumber'>774</span>  *                                  cssPropで指定したスタイルプロパティが存在しない場合は、その要素の値は空文字列("")になります。
<span class='linenumber'>775</span>  *                                  cssPropを省略した場合は、スタイルのスナップショット(CSS2Propertiesオブジェクト)を返します。
<span class='linenumber'>776</span>  * @see uu.css.set - スタイルの設定
<span class='linenumber'>777</span>  * @namespace
<span class='linenumber'>778</span>  */</span><span class="WHIT">
<span class='linenumber'>779</span> </span><span class="NAME">uu.css.get</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">elm</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">cssProp</span><span class="WHIT"> </span><span class="COMM">/* = undefined */</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">cure</span><span class="WHIT"> </span><span class="COMM">/* = false */</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>780</span> </span><span class="WHIT">  </span><span class="NAME">cure</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">cure</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>781</span> </span><span class="WHIT">  </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">hash</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">rv</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">uu.ua.ie</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">elm.currentStyle</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">uud.defaultView.getComputedStyle</span><span class="PUNC">(</span><span class="NAME">elm</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>782</span> </span><span class="WHIT">  </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">prop</span><span class="PUNC">(</span><span class="NAME">v</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">                        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">v</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">rv</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">rv</span><span class="PUNC">[</span><span class="NAME">v</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>783</span> </span><span class="WHIT">  </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">Prop</span><span class="PUNC">(</span><span class="NAME">v</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">v</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">uu.css.cssProp</span><span class="PUNC">(</span><span class="NAME">v</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">v</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">rv</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">rv</span><span class="PUNC">[</span><span class="NAME">v</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>784</span> </span><span class="WHIT">  </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">cssProp</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">rv</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>785</span> </span><span class="WHIT">  </span><span class="NAME">cssProp</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">uu.notax</span><span class="PUNC">(</span><span class="NAME">cssProp</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>786</span> </span><span class="WHIT">  </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">cssProp.length</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>787</span> </span><span class="WHIT">  </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">cssProp.length</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">cure</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">Prop</span><span class="PUNC">(</span><span class="NAME">cssProp</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">prop</span><span class="PUNC">(</span><span class="NAME">cssProp</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>788</span> </span><span class="WHIT">  </span><span class="NAME">hash</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>789</span> </span><span class="WHIT">  </span><span class="NAME">cssProp.forEach</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">v</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">hash</span><span class="PUNC">[</span><span class="NAME">v</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">cure</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">Prop</span><span class="PUNC">(</span><span class="NAME">v</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">prop</span><span class="PUNC">(</span><span class="NAME">v</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>790</span> </span><span class="WHIT">  </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">hash</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>791</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>792</span> 
<span class='linenumber'>793</span> </span><span class="COMM">/** &lt;b>uu.css.set - スタイルの設定(set style)&lt;/b>
<span class='linenumber'>794</span>  *
<span class='linenumber'>795</span>  * スタイルを設定します。&lt;br />
<span class='linenumber'>796</span>  * 一部のプロパティでは、特別な値や指定方法が有効です。
<span class='linenumber'>797</span>  * &lt;dl>
<span class='linenumber'>798</span>  *  &lt;dt>top, left, width, height&lt;/dt>&lt;dd>値を数値で指定すると末尾に"px"を補完します。&lt;/dd>
<span class='linenumber'>799</span>  *  &lt;dt>display&lt;/dt>&lt;dd>"hide"を指定すると要素を隠します。"show"を指定すると要素を表示します。&lt;/dd>
<span class='linenumber'>800</span>  * &lt;/dl>
<span class='linenumber'>801</span>  *
<span class='linenumber'>802</span>  * @param element       elm       - スタイルを設定する要素を指定します。
<span class='linenumber'>803</span>  * @param hash          hash      - { cssProp: value, ...} または { "css-prop": value, ... } を指定します。
<span class='linenumber'>804</span>  *                                  keyにCSS名("z-index")を指定することも可能で、その場合はcureにtrueを指定します。
<span class='linenumber'>805</span>  * @param bool          [cure]    - hashにcss-prop形式("font-weight")の名前を指定した場合はtrueにします。
<span class='linenumber'>806</span>  *                                  デフォルトはfalseです。
<span class='linenumber'>807</span>  * @return element                - elmを返します。
<span class='linenumber'>808</span>  * @see uu.css.get - スタイルの取得
<span class='linenumber'>809</span>  * @namespace
<span class='linenumber'>810</span>  */</span><span class="WHIT">
<span class='linenumber'>811</span> </span><span class="NAME">uu.css.set</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">elm</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">hash</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">cure</span><span class="WHIT"> </span><span class="COMM">/* = false */</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>812</span> </span><span class="WHIT">  </span><span class="NAME">cure</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">cure</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>813</span> </span><span class="WHIT">  </span><span class="NAME">uu.css.set._chain.forEach</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">v</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="COMM">// 特別な値や設定を持つものを先に処理しループを軽くする</span><span class="WHIT">
<span class='linenumber'>814</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">v</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">hash</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>815</span> </span><span class="WHIT">      </span><span class="NAME">uu.css.set</span><span class="PUNC">[</span><span class="NAME">v</span><span class="PUNC">]</span><span class="PUNC">(</span><span class="NAME">elm</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">hash</span><span class="PUNC">[</span><span class="NAME">v</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>816</span> </span><span class="WHIT">      </span><span class="KEYW">delete</span><span class="WHIT"> </span><span class="NAME">hash</span><span class="PUNC">[</span><span class="NAME">v</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>817</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>818</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>819</span> </span><span class="WHIT">  </span><span class="NAME">uu.forEach</span><span class="PUNC">(</span><span class="NAME">hash</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">v</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>820</span> </span><span class="WHIT">    </span><span class="KEYW">try</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>821</span> </span><span class="WHIT">      </span><span class="NAME">elm.style</span><span class="PUNC">[</span><span class="NAME">cure</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">uu.css.cssProp</span><span class="PUNC">(</span><span class="NAME">i</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">v</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>822</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">catch</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>823</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>824</span> </span><span class="WHIT">  </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">elm</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>825</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>826</span> </span><span class="NAME">uu.css.set._chain</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="STRN">"opacity"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"top"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"left"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"width"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"height"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"display"</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>827</span> 
<span class='linenumber'>828</span> </span><span class="COMM">/** &lt;b>uu.css.get.opacity - 不透明度の取得&lt;/b>
<span class='linenumber'>829</span>  * @param element elm - スタイルを取得する要素を指定します。
<span class='linenumber'>830</span>  * @return number - 不透明度を数値で返します。
<span class='linenumber'>831</span>  */</span><span class="WHIT">
<span class='linenumber'>832</span> </span><span class="NAME">uu.css.get.opacity</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">elm</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>833</span> </span><span class="WHIT">  </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">parseFloat</span><span class="PUNC">(</span><span class="NAME">uud.defaultView.getComputedStyle</span><span class="PUNC">(</span><span class="NAME">elm</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">opacity</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>834</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>835</span> </span><span class="COMM">/** &lt;b>uu.css.set.opacity - 不透明度の設定&lt;/b>
<span class='linenumber'>836</span>  * @param element elm           - スタイルを設定する要素を指定します。
<span class='linenumber'>837</span>  * @param number/string opacity - 不透明度を数値または数値の文字列表現で指定します。
<span class='linenumber'>838</span>  *                                指定可能な値は0.0から1.0の値です。
<span class='linenumber'>839</span>  * @return element - elmを返します。
<span class='linenumber'>840</span>  */</span><span class="WHIT">
<span class='linenumber'>841</span> </span><span class="NAME">uu.css.set.opacity</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">elm</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">opacity</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>842</span> </span><span class="WHIT">  </span><span class="NAME">elm.style.opacity</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">parseFloat</span><span class="PUNC">(</span><span class="NAME">opacity</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// .toFixed(6);</span><span class="WHIT">
<span class='linenumber'>843</span> </span><span class="WHIT">  </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">elm</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>844</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>845</span> </span><span class="COMM">/** &lt;b>uu.css.get.top - 上からのオフセットを取得&lt;/b>
<span class='linenumber'>846</span>  * @param element elm - オフセットを取得する要素を指定します。
<span class='linenumber'>847</span>  * @return number     - オフセットをpx単位の数値で返します。
<span class='linenumber'>848</span>  */</span><span class="WHIT">
<span class='linenumber'>849</span> </span><span class="NAME">uu.css.get.top</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">elm</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>850</span> </span><span class="WHIT">  </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">parseFloat</span><span class="PUNC">(</span><span class="NAME">uud.defaultView.getComputedStyle</span><span class="PUNC">(</span><span class="NAME">elm</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">top</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>851</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>852</span> </span><span class="COMM">/** &lt;b>uu.css.get.top - 上からのオフセットを設定&lt;/b>
<span class='linenumber'>853</span>  * @param element elm         - オフセットを設定する要素を指定します。
<span class='linenumber'>854</span>  * @param number/string value - オフセット値を指定します。負の値も指定可能です。
<span class='linenumber'>855</span>  *                              数値で指定すると、末尾に"px"を補完します。
<span class='linenumber'>856</span>  * @return element            - elmを返します。
<span class='linenumber'>857</span>  */</span><span class="WHIT">
<span class='linenumber'>858</span> </span><span class="NAME">uu.css.set.top</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">elm</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">value</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>859</span> </span><span class="WHIT">  </span><span class="NAME">elm.style.top</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">value</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">"number"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">parseInt</span><span class="PUNC">(</span><span class="NAME">value</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"px"</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">value</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>860</span> </span><span class="WHIT">  </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">elm</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>861</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>862</span> </span><span class="COMM">/** &lt;b>uu.css.get.left - 左からのオフセットを取得&lt;/b>
<span class='linenumber'>863</span>  * @param element elm - オフセットを取得する要素を指定します。
<span class='linenumber'>864</span>  * @return number     - オフセットをpx単位の数値で返します。
<span class='linenumber'>865</span>  */</span><span class="WHIT">
<span class='linenumber'>866</span> </span><span class="NAME">uu.css.get.left</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">elm</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>867</span> </span><span class="WHIT">  </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">parseFloat</span><span class="PUNC">(</span><span class="NAME">uud.defaultView.getComputedStyle</span><span class="PUNC">(</span><span class="NAME">elm</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">left</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>868</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>869</span> </span><span class="COMM">/** &lt;b>uu.css.get.left - 左からのオフセットを設定&lt;/b>
<span class='linenumber'>870</span>  * @param element elm         - オフセットを設定する要素を指定します。
<span class='linenumber'>871</span>  * @param number/string value - オフセット値を指定します。負の値も指定可能です。
<span class='linenumber'>872</span>  *                              数値で指定すると、末尾に"px"を補完します。
<span class='linenumber'>873</span>  * @return element            - elmを返します。
<span class='linenumber'>874</span>  */</span><span class="WHIT">
<span class='linenumber'>875</span> </span><span class="NAME">uu.css.set.left</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">elm</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">value</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>876</span> </span><span class="WHIT">  </span><span class="NAME">elm.style.left</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">value</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">"number"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">parseInt</span><span class="PUNC">(</span><span class="NAME">value</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"px"</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">value</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>877</span> </span><span class="WHIT">  </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">elm</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>878</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>879</span> </span><span class="COMM">/** &lt;b>uu.css.get.width - 幅の取得&lt;/b>
<span class='linenumber'>880</span>  * @param element elm - 幅を取得する要素を指定します。
<span class='linenumber'>881</span>  * @return number     - 幅をpx単位の数値で返します。
<span class='linenumber'>882</span>  */</span><span class="WHIT">
<span class='linenumber'>883</span> </span><span class="NAME">uu.css.get.width</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">elm</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>884</span> </span><span class="WHIT">  </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">parseFloat</span><span class="PUNC">(</span><span class="NAME">uud.defaultView.getComputedStyle</span><span class="PUNC">(</span><span class="NAME">elm</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">width</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>885</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>886</span> </span><span class="COMM">/** &lt;b>uu.css.set.width - 幅の設定&lt;/b>
<span class='linenumber'>887</span>  * @param element       elm   - 幅を設定する要素を指定します。
<span class='linenumber'>888</span>  * @param number/string value - 幅を指定します。負の値は指定できません。
<span class='linenumber'>889</span>  *                              数値で指定すると、末尾に"px"を補完します。
<span class='linenumber'>890</span>  * @return element            - elmを返します。
<span class='linenumber'>891</span>  */</span><span class="WHIT">
<span class='linenumber'>892</span> </span><span class="NAME">uu.css.set.width</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">elm</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">value</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>893</span> </span><span class="WHIT">  </span><span class="KEYW">try</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>894</span> </span><span class="WHIT">    </span><span class="NAME">elm.style.width</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">value</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">"number"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">parseInt</span><span class="PUNC">(</span><span class="NAME">value</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"px"</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">value</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>895</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">catch</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>896</span> </span><span class="WHIT">    </span><span class="NAME">elm.style.width</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"0px"</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>897</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>898</span> </span><span class="WHIT">  </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">elm</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>899</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>900</span> </span><span class="COMM">/** &lt;b>uu.css.get.height - 高さの取得&lt;/b>
<span class='linenumber'>901</span>  * @param element elm - 高さを取得する要素を指定します。
<span class='linenumber'>902</span>  * @return number     - 高さをpx単位の数値で返します。
<span class='linenumber'>903</span>  */</span><span class="WHIT">
<span class='linenumber'>904</span> </span><span class="NAME">uu.css.get.height</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">elm</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>905</span> </span><span class="WHIT">  </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">parseFloat</span><span class="PUNC">(</span><span class="NAME">uud.defaultView.getComputedStyle</span><span class="PUNC">(</span><span class="NAME">elm</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">height</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>906</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>907</span> </span><span class="COMM">/** &lt;b>uu.css.set.height - 高さの設定&lt;/b>
<span class='linenumber'>908</span>  * @param element       elm   - 高さを設定する要素を指定します。
<span class='linenumber'>909</span>  * @param number/string value - 高さを指定します。負の値は指定できません。
<span class='linenumber'>910</span>  *                              数値で指定すると、末尾に"px"を補完します。
<span class='linenumber'>911</span>  * @return element            - elmを返します。
<span class='linenumber'>912</span>  */</span><span class="WHIT">
<span class='linenumber'>913</span> </span><span class="NAME">uu.css.set.height</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">elm</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">value</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>914</span> </span><span class="WHIT">  </span><span class="KEYW">try</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>915</span> </span><span class="WHIT">    </span><span class="NAME">elm.style.height</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">value</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">"number"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">parseInt</span><span class="PUNC">(</span><span class="NAME">value</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"px"</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">value</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>916</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">catch</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>917</span> </span><span class="WHIT">    </span><span class="NAME">elm.style.height</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"0px"</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>918</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>919</span> </span><span class="WHIT">  </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">elm</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>920</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>921</span> </span><span class="COMM">/** &lt;b>uu.css.set.display - 表示方法の設定&lt;/b>
<span class='linenumber'>922</span>  *
<span class='linenumber'>923</span>  * 要素の表示/非表示を設定します。&lt;br />
<span class='linenumber'>924</span>  * このメソッドを使用することで、table要素やインライン要素とdiv要素を同じ方法で操作することができます。
<span class='linenumber'>925</span>  *
<span class='linenumber'>926</span>  * @param element elm   - 表示方法を設定する要素を指定します。
<span class='linenumber'>927</span>  * @param string  disp  - style.displayに指定可能な値か、"show" または "hide"を指定します。
<span class='linenumber'>928</span>  * @return element      - elmを返します。
<span class='linenumber'>929</span>  */</span><span class="WHIT">
<span class='linenumber'>930</span> </span><span class="NAME">uu.css.set.display</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">elm</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">disp</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="COMM">// for IE, Firefox, Opera, Safari</span><span class="WHIT">
<span class='linenumber'>931</span> </span><span class="WHIT">  </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">rv</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">disp</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">"hide"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="STRN">"none"</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">disp</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">me</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">tag</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>932</span> </span><span class="WHIT">  </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">disp</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">"show"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>933</span> </span><span class="WHIT">    </span><span class="NAME">me</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">arguments.callee</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">tag</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">elm.tagName.toLowerCase</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>934</span> </span><span class="WHIT">    </span><span class="NAME">rv</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">me._skip.indexOf</span><span class="PUNC">(</span><span class="NAME">tag</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">","</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="STRN">""</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT">
<span class='linenumber'>935</span> </span><span class="WHIT">         </span><span class="PUNC">(</span><span class="NAME">me._block.indexOf</span><span class="PUNC">(</span><span class="NAME">tag</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">","</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="STRN">"block"</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT">
<span class='linenumber'>936</span> </span><span class="WHIT">         </span><span class="PUNC">(</span><span class="NAME">tag</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">me._unique</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">me._unique</span><span class="PUNC">[</span><span class="NAME">tag</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">"inline"</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>937</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>938</span> </span><span class="WHIT">  </span><span class="NAME">elm.style.display</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">rv</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>939</span> </span><span class="WHIT">  </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">elm</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>940</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>941</span> </span><span class="COMM">// XHTML1.x Elements only</span><span class="WHIT">
<span class='linenumber'>942</span> </span><span class="NAME">uu.css.set.display._skip</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// display: が指定できない属性の一覧</span><span class="WHIT">
<span class='linenumber'>943</span> </span><span class="NAME">uu.css.set.display._block</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"p,div,dl,ul,ol,form,address,blockquote,h1,h2,h3,h4,h5,h6,fieldset,hr,pre,"</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>944</span> </span><span class="NAME">uu.css.set.display._unique</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">table</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">"table"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">caption</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">"table-caption"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">tr</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">"table-row"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">td</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">"table-cell"</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>945</span> </span><span class="WHIT">                               </span><span class="NAME">th</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">"table-cell"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">tbody</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">"table-row-group"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">thead</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">"table-header-group"</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>946</span> </span><span class="WHIT">                               </span><span class="NAME">tfoot</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">"table-footer-group"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">col</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">"table-column"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">colgroup</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">"table-column-group"</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>947</span> </span><span class="COMM">// display: tableが機能しないブラウザ(IE6,7)用の処理</span><span class="WHIT">
<span class='linenumber'>948</span> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">uu.ua</span><span class="PUNC">(</span><span class="STRN">"display:table"</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>949</span> </span><span class="WHIT">  </span><span class="NAME">uu.css.set.display._skip</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"table,caption,tr,td,th,tbody,thead,tfoot,col,colgroup,"</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>950</span> </span><span class="WHIT">  </span><span class="NAME">uu.css.set.display._unique</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>951</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>952</span> 
<span class='linenumber'>953</span> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">uu.ua.ie</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>954</span> </span><span class="WHIT">  </span><span class="NAME">uu.css.get.opacity</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">elm</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>955</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">elm.filters.alpha</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">parseFloat</span><span class="PUNC">(</span><span class="NAME">elm.style.opacity</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">1.0</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>956</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>957</span> </span><span class="WHIT">  </span><span class="NAME">uu.css.set.opacity</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">elm</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">opacity</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>958</span> </span><span class="WHIT">    </span><span class="NAME">elm.style.opacity</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">parseFloat</span><span class="PUNC">(</span><span class="NAME">opacity</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// .toFixed(6); // uu.css.get()で値を取得できるように</span><span class="WHIT">
<span class='linenumber'>959</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">elm.filters.alpha</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">elm.filters.alpha.opacity</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">parseFloat</span><span class="PUNC">(</span><span class="NAME">opacity</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NUMB">100</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>960</span> </span><span class="WHIT">                      </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">elm.style.filter</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">" alpha(opacity="</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">parseFloat</span><span class="PUNC">(</span><span class="NAME">opacity</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NUMB">100</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">")"</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>961</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>962</span> </span><span class="WHIT">  </span><span class="NAME">uu.css.get.top</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">elm</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>963</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">parseFloat</span><span class="PUNC">(</span><span class="NAME">elm.currentStyle.top</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>964</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>965</span> </span><span class="WHIT">  </span><span class="NAME">uu.css.get.left</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">elm</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>966</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">parseFloat</span><span class="PUNC">(</span><span class="NAME">elm.currentStyle.left</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>967</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>968</span> </span><span class="WHIT">  </span><span class="NAME">uu.css.get.width</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">elm</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>969</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">rv</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">elm.currentStyle.width</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>970</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">rv</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">"auto"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">elm.clientWidth</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">parseFloat</span><span class="PUNC">(</span><span class="NAME">rv</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// IEは計算せずに"auto"を返してくる</span><span class="WHIT">
<span class='linenumber'>971</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>972</span> </span><span class="WHIT">  </span><span class="NAME">uu.css.get.height</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">elm</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>973</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">rv</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">elm.currentStyle.height</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>974</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">rv</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">"auto"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">elm.clientHeight</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">parseFloat</span><span class="PUNC">(</span><span class="NAME">rv</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// IEは計算せずに"auto"を返してくる</span><span class="WHIT">
<span class='linenumber'>975</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>976</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>977</span> 
<span class='linenumber'>978</span> </span><span class="COMM">/** &lt;b>uu.css.toXPath - CSS3セレクタをXPathに変換&lt;/b>
<span class='linenumber'>979</span>  *
<span class='linenumber'>980</span>  * CSS3のセレクタ(一部除く)をXPathに変換します。&lt;br />
<span class='linenumber'>981</span>  * 対応状況は用語集を確認してください。&lt;br />&lt;br />
<span class='linenumber'>982</span>  *
<span class='linenumber'>983</span>  * CSS3の擬似クラス(:enabled, :disabled, :checked)に対応していない理由。&lt;br />
<span class='linenumber'>984</span>  *
<span class='linenumber'>985</span>  * &lt;input id="element" type="checkbox" checked="checked" /&gt;はHTMLパース時に、&lt;br />
<span class='linenumber'>986</span>  * 1. JavaScriptのプロパティとしての element.checked がtrueに設定される。&lt;br />
<span class='linenumber'>987</span>  * 2. element.setAttribute("checked", "checked"); 相当の処理が行われる。&lt;br />
<span class='linenumber'>988</span>  *
<span class='linenumber'>989</span>  * チェックボックスをクリックすると、&lt;br />
<span class='linenumber'>990</span>  * 1. JavaScriptのプロパティとしての element.checked がtrueかfalseに設定される。&lt;br />
<span class='linenumber'>991</span>  * 2. element.setAttribute("checked", 現在の値); 相当の処理は行われない。&lt;br />
<span class='linenumber'>992</span>  *
<span class='linenumber'>993</span>  * XPathの@(attribute::)はsetAttribute()で設定された値に反応するため、画面の見た目と、XPathで選択される要素が異なってしまう。
<span class='linenumber'>994</span>  *
<span class='linenumber'>995</span>  * @param string css3selectors - CSS3のセレクタを指定します。
<span class='linenumber'>996</span>  * @return string - 成功でXPathのロケーションパスを返します。
<span class='linenumber'>997</span>  *                  変換失敗で空文字列("")を返します。
<span class='linenumber'>998</span>  * @see http://www.w3.org/TR/css3-selectors/
<span class='linenumber'>999</span>  */</span><span class="WHIT">
<span class='linenumber'>1000</span> </span><span class="NAME">uu.css.toXPath</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">css3selectors</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>1001</span> </span><span class="WHIT">  </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">css3selectors.split</span><span class="PUNC">(</span><span class="STRN">","</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">map</span><span class="PUNC">(</span><span class="NAME">uu.css.toXPath._impl</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">join</span><span class="PUNC">(</span><span class="STRN">" | "</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1002</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>1003</span> </span><span class="NAME">uu.css.toXPath._impl</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">sel</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>1004</span> </span><span class="WHIT">  </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">rv</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="STRN">"//"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"*"</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">exp</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">uu.css.toXPath._impl._regexp</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">index</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">last</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">m</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">m2</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1005</span> 
<span class='linenumber'>1006</span> </span><span class="WHIT">  </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">reset</span><span class="PUNC">(</span><span class="NAME">E</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">rv.length</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">rv.push</span><span class="PUNC">(</span><span class="NAME">E</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">index</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>1007</span> </span><span class="WHIT">  </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">nth</span><span class="PUNC">(</span><span class="NAME">str</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">isNaN</span><span class="PUNC">(</span><span class="NAME">str</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="COMM">/*(*/</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="STRN">")="</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">parseInt</span><span class="PUNC">(</span><span class="NAME">str</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"-1"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT">
<span class='linenumber'>1008</span> </span><span class="WHIT">                             </span><span class="PUNC">(</span><span class="NAME">str</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">"even"</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">str</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">"2n"</span><span class="PUNC">)</span><span class="WHIT">   </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="COMM">/*(*/</span><span class="WHIT"> </span><span class="STRN">")mod 2=1"</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT">
<span class='linenumber'>1009</span> </span><span class="WHIT">                             </span><span class="PUNC">(</span><span class="NAME">str</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">"odd"</span><span class="WHIT">  </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">str</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">"2n+1"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="COMM">/*(*/</span><span class="WHIT"> </span><span class="STRN">")mod 2=0"</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT">
<span class='linenumber'>1010</span> </span><span class="WHIT">                             </span><span class="PUNC">(</span><span class="NAME">exp</span><span class="PUNC">[</span><span class="STRN">"xn+y"</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">test</span><span class="PUNC">(</span><span class="NAME">str</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">str.replace</span><span class="PUNC">(</span><span class="NAME">exp</span><span class="PUNC">[</span><span class="STRN">"xn+y"</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="COMM">/*(*/</span><span class="WHIT"> </span><span class="STRN">"+ $2)mod $1=1"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT">    </span><span class="COMM">// 4n + 1</span><span class="WHIT">
<span class='linenumber'>1011</span> </span><span class="WHIT">                             </span><span class="PUNC">(</span><span class="NAME">exp.xn.test</span><span class="PUNC">(</span><span class="NAME">str</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT">      </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">str.replace</span><span class="PUNC">(</span><span class="NAME">exp.xn</span><span class="PUNC">,</span><span class="WHIT">      </span><span class="COMM">/*(*/</span><span class="WHIT"> </span><span class="STRN">")mod $1=1"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="COMM">/*(*/</span><span class="WHIT"> </span><span class="STRN">")"</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="COMM">// 3n</span><span class="WHIT">
<span class='linenumber'>1012</span> </span><span class="WHIT">  </span><span class="KEYW">while</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">sel.length</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">sel</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="NAME">last</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>1013</span> </span><span class="WHIT">    </span><span class="NAME">last</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">sel</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">uu.trim</span><span class="PUNC">(</span><span class="NAME">sel</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1014</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">sel.length</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>1015</span> 
<span class='linenumber'>1016</span> </span><span class="WHIT">    </span><span class="COMM">// Element phase: E.className, E#id</span><span class="WHIT">
<span class='linenumber'>1017</span> </span><span class="WHIT">    </span><span class="NAME">m</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">sel.match</span><span class="PUNC">(</span><span class="NAME">exp.ELM</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1018</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">m</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>1019</span> </span><span class="WHIT">      </span><span class="KEYW">switch</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">m</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>1020</span> </span><span class="WHIT">      </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">"."</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">rv.push</span><span class="PUNC">(</span><span class="STRN">'[contains(concat(" ",@class," ")," '</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">m</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">' ")]'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1021</span> </span><span class="WHIT">      </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">"#"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">rv.push</span><span class="PUNC">(</span><span class="STRN">'[@id="'</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">m</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">'"]'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1022</span> </span><span class="WHIT">      </span><span class="KEYW">default</span><span class="PUNC">:</span><span class="WHIT">  </span><span class="NAME">rv</span><span class="PUNC">[</span><span class="NAME">index</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">m</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1023</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>1024</span> </span><span class="WHIT">      </span><span class="NAME">sel</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">sel.substring</span><span class="PUNC">(</span><span class="NAME">m</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">length</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1025</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>1026</span> </span><span class="WHIT">    </span><span class="COMM">// Attr phase: E[A], E[A=V], E[A~=V], E[A$=V], E[A*=V], E[A|=V]</span><span class="WHIT">
<span class='linenumber'>1027</span> </span><span class="WHIT">    </span><span class="NAME">m</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">sel.match</span><span class="PUNC">(</span><span class="NAME">exp.ATTR1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1028</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">m</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>1029</span> </span><span class="WHIT">      </span><span class="PUNC">(</span><span class="NAME">m</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">uu.css.toXPath._impl._attr</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">rv.push</span><span class="PUNC">(</span><span class="NAME">uu.sprintf</span><span class="PUNC">(</span><span class="NAME">uu.css.toXPath._impl._attr</span><span class="PUNC">[</span><span class="NAME">m</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">m</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">m</span><span class="PUNC">[</span><span class="NUMB">4</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1030</span> </span><span class="WHIT">      </span><span class="NAME">sel</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">sel.substring</span><span class="PUNC">(</span><span class="NAME">m</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">length</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1031</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>1032</span> </span><span class="WHIT">      </span><span class="NAME">m</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">sel.match</span><span class="PUNC">(</span><span class="NAME">exp.ATTR2</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1033</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">m</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>1034</span> </span><span class="WHIT">        </span><span class="NAME">rv.push</span><span class="PUNC">(</span><span class="STRN">"[@"</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">m</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"]"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1035</span> </span><span class="WHIT">        </span><span class="NAME">sel</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">sel.substring</span><span class="PUNC">(</span><span class="NAME">m</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">length</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1036</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>1037</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>1038</span> </span><span class="WHIT">    </span><span class="COMM">// Attr phase: E:not(selector) - sorry. not impl.</span><span class="WHIT">
<span class='linenumber'>1039</span> 
<span class='linenumber'>1040</span> </span><span class="WHIT">    </span><span class="COMM">// Pseudo-classes and Pseudo-elements phase:</span><span class="WHIT">
<span class='linenumber'>1041</span> </span><span class="WHIT">    </span><span class="NAME">m</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">sel.match</span><span class="PUNC">(</span><span class="NAME">exp.PSEUDO</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1042</span> </span><span class="WHIT">    </span><span class="KEYW">while</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">m</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>1043</span> </span><span class="WHIT">      </span><span class="KEYW">switch</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">m</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>1044</span> </span><span class="WHIT">      </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">"root"</span><span class="PUNC">:</span><span class="WHIT">          </span><span class="NAME">rv.push</span><span class="PUNC">(</span><span class="STRN">"*[not(parent::*)]"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1045</span> </span><span class="WHIT">      </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">"first-child"</span><span class="PUNC">:</span><span class="WHIT">   </span><span class="NAME">rv.push</span><span class="PUNC">(</span><span class="STRN">"[not(preceding-sibling::*)]"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1046</span> </span><span class="WHIT">      </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">"last-child"</span><span class="PUNC">:</span><span class="WHIT">    </span><span class="NAME">rv.push</span><span class="PUNC">(</span><span class="STRN">"[not(following-sibling::*)]"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1047</span> </span><span class="WHIT">      </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">"only-child"</span><span class="PUNC">:</span><span class="WHIT">    </span><span class="NAME">rv.push</span><span class="PUNC">(</span><span class="STRN">"[count(parent::*/child::*)=1]"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1048</span> </span><span class="COMM">/* 非対応 - これらはuu.pseudo.xxxメソッドとして実装する
<span class='linenumber'>1049</span>       case "animated":      break;
<span class='linenumber'>1050</span>       case "checked":       rv.push('[@checked and (@checked="true" or @checked="checked")]'); break;
<span class='linenumber'>1051</span>       case "selected":      break;
<span class='linenumber'>1052</span>       case "hidden":        rv.push('input[@type="hidden"]'); break; // style.display="none" や style.visibility="hidden" には非対応
<span class='linenumber'>1053</span>       case "visible":       break;
<span class='linenumber'>1054</span>  */</span><span class="WHIT">
<span class='linenumber'>1055</span> </span><span class="WHIT">      </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">"enabled"</span><span class="PUNC">:</span><span class="WHIT">       </span><span class="NAME">rv.push</span><span class="PUNC">(</span><span class="STRN">'[not(@disabled)]'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1056</span> </span><span class="WHIT">      </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">"disabled"</span><span class="PUNC">:</span><span class="WHIT">      </span><span class="NAME">rv.push</span><span class="PUNC">(</span><span class="STRN">'[@disabled="disabled"]'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1057</span> </span><span class="WHIT">      </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">"nth-child"</span><span class="PUNC">:</span><span class="WHIT">       </span><span class="NAME">rv.push</span><span class="PUNC">(</span><span class="NAME">uu.sprintf</span><span class="PUNC">(</span><span class="STRN">"[(count(preceding-sibling::*)%1$s]"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">nth</span><span class="PUNC">(</span><span class="NAME">m</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// )</span><span class="WHIT">
<span class='linenumber'>1058</span> </span><span class="WHIT">      </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">"nth-last-child"</span><span class="PUNC">:</span><span class="WHIT">  </span><span class="NAME">rv.push</span><span class="PUNC">(</span><span class="NAME">uu.sprintf</span><span class="PUNC">(</span><span class="STRN">"[(count(following-sibling::*)%1$s]"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">nth</span><span class="PUNC">(</span><span class="NAME">m</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// )</span><span class="WHIT">
<span class='linenumber'>1059</span> </span><span class="WHIT">      </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">"nth-of-type"</span><span class="PUNC">:</span><span class="WHIT">     </span><span class="NAME">rv.push</span><span class="PUNC">(</span><span class="NAME">uu.sprintf</span><span class="PUNC">(</span><span class="STRN">"[(count(preceding-sibling::%2$s)%1$s]"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">nth</span><span class="PUNC">(</span><span class="NAME">m</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">rv</span><span class="PUNC">[</span><span class="NAME">index</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// )</span><span class="WHIT">
<span class='linenumber'>1060</span> </span><span class="WHIT">      </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">"nth-last-of-type"</span><span class="PUNC">:</span><span class="NAME">rv.push</span><span class="PUNC">(</span><span class="NAME">uu.sprintf</span><span class="PUNC">(</span><span class="STRN">"[(count(following-sibling::%2$s)%1$s]"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">nth</span><span class="PUNC">(</span><span class="NAME">m</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">rv</span><span class="PUNC">[</span><span class="NAME">index</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// )</span><span class="WHIT">
<span class='linenumber'>1061</span> </span><span class="WHIT">      </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">"first-of-type"</span><span class="PUNC">:</span><span class="WHIT">   </span><span class="NAME">rv.push</span><span class="PUNC">(</span><span class="NAME">uu.sprintf</span><span class="PUNC">(</span><span class="STRN">"[(not(preceding-sibling::%2$s)%1$s]"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">nth</span><span class="PUNC">(</span><span class="NAME">m</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">rv</span><span class="PUNC">[</span><span class="NAME">index</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// )</span><span class="WHIT">
<span class='linenumber'>1062</span> </span><span class="WHIT">      </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">"last-of-type"</span><span class="PUNC">:</span><span class="WHIT">    </span><span class="NAME">rv.push</span><span class="PUNC">(</span><span class="NAME">uu.sprintf</span><span class="PUNC">(</span><span class="STRN">"[(not(following-sibling::%2$s)%1$s]"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">nth</span><span class="PUNC">(</span><span class="NAME">m</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">rv</span><span class="PUNC">[</span><span class="NAME">index</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// )</span><span class="WHIT">
<span class='linenumber'>1063</span> </span><span class="WHIT">      </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">"only-of-type"</span><span class="PUNC">:</span><span class="WHIT">    </span><span class="NAME">rv.push</span><span class="PUNC">(</span><span class="NAME">uu.sprintf</span><span class="PUNC">(</span><span class="STRN">"[count(parent::*/child::%s)=1]"</span><span class="PUNC">,</span><span class="NAME">rv</span><span class="PUNC">[</span><span class="NAME">index</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1064</span> </span><span class="WHIT">      </span><span class="COMM">// ---</span><span class="WHIT">
<span class='linenumber'>1065</span> </span><span class="WHIT">      </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">"first"</span><span class="PUNC">:</span><span class="WHIT">         </span><span class="NAME">rv.push</span><span class="PUNC">(</span><span class="STRN">"[1]"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1066</span> </span><span class="WHIT">      </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">"last"</span><span class="PUNC">:</span><span class="WHIT">          </span><span class="NAME">rv.push</span><span class="PUNC">(</span><span class="STRN">"[last()]"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1067</span> </span><span class="WHIT">      </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">"even"</span><span class="PUNC">:</span><span class="WHIT">          </span><span class="NAME">rv.push</span><span class="PUNC">(</span><span class="STRN">"[(count(preceding-sibling::*))mod 2=0]"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1068</span> </span><span class="WHIT">      </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">"odd"</span><span class="PUNC">:</span><span class="WHIT">           </span><span class="NAME">rv.push</span><span class="PUNC">(</span><span class="STRN">"[(count(preceding-sibling::*))mod 2=1]"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1069</span> </span><span class="WHIT">      </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">"eq"</span><span class="PUNC">:</span><span class="WHIT">            </span><span class="NAME">reset</span><span class="PUNC">(</span><span class="NAME">uu.sprintf</span><span class="PUNC">(</span><span class="STRN">"/descendant::%s[%d]"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">rv</span><span class="PUNC">[</span><span class="NAME">index</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">parseInt</span><span class="PUNC">(</span><span class="NAME">m</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1070</span> </span><span class="WHIT">      </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">"gt"</span><span class="PUNC">:</span><span class="WHIT">            </span><span class="NAME">reset</span><span class="PUNC">(</span><span class="NAME">uu.sprintf</span><span class="PUNC">(</span><span class="STRN">"/descendant::%s[position() > %d]"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">rv</span><span class="PUNC">[</span><span class="NAME">index</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">parseInt</span><span class="PUNC">(</span><span class="NAME">m</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1071</span> </span><span class="WHIT">      </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">"lt"</span><span class="PUNC">:</span><span class="WHIT">            </span><span class="NAME">reset</span><span class="PUNC">(</span><span class="NAME">uu.sprintf</span><span class="PUNC">(</span><span class="STRN">"/descendant::%s[position() &lt; %d]"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">rv</span><span class="PUNC">[</span><span class="NAME">index</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">parseInt</span><span class="PUNC">(</span><span class="NAME">m</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1072</span> </span><span class="WHIT">      </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">"header"</span><span class="PUNC">:</span><span class="WHIT">        </span><span class="NAME">reset</span><span class="PUNC">(</span><span class="NAME">uu.sprintf</span><span class="PUNC">(</span><span class="STRN">"//*[self::h1 or self::h2 or self::h3 or self::h4 or self::h5 or self::h6]"</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1073</span> </span><span class="WHIT">      </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">"contains"</span><span class="PUNC">:</span><span class="WHIT">      </span><span class="NAME">rv.push</span><span class="PUNC">(</span><span class="NAME">uu.sprintf</span><span class="PUNC">(</span><span class="STRN">"[contains(string(), %s)]"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">m</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1074</span> </span><span class="WHIT">      </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">"empty"</span><span class="PUNC">:</span><span class="WHIT">         </span><span class="NAME">rv.push</span><span class="PUNC">(</span><span class="STRN">"[not(*) and not(text())]"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1075</span> </span><span class="WHIT">      </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">"parent"</span><span class="PUNC">:</span><span class="WHIT">        </span><span class="NAME">rv.push</span><span class="PUNC">(</span><span class="STRN">"[text()]"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1076</span> </span><span class="WHIT">      </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">"input"</span><span class="PUNC">:</span><span class="WHIT">         </span><span class="NAME">rv.push</span><span class="PUNC">(</span><span class="STRN">"*[self::input or self::textarea or self::select or self::button]"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1077</span> </span><span class="WHIT">      </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">"text"</span><span class="PUNC">:</span><span class="WHIT">          </span><span class="NAME">rv.push</span><span class="PUNC">(</span><span class="STRN">'input[@type="text"]'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1078</span> </span><span class="WHIT">      </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">"password"</span><span class="PUNC">:</span><span class="WHIT">      </span><span class="NAME">rv.push</span><span class="PUNC">(</span><span class="STRN">'input[@type="password"]'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1079</span> </span><span class="WHIT">      </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">"radio"</span><span class="PUNC">:</span><span class="WHIT">         </span><span class="NAME">rv.push</span><span class="PUNC">(</span><span class="STRN">'input[@type="radio"]'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1080</span> </span><span class="WHIT">      </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">"checkbox"</span><span class="PUNC">:</span><span class="WHIT">      </span><span class="NAME">rv.push</span><span class="PUNC">(</span><span class="STRN">'input[@type="checkbox"]'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1081</span> </span><span class="WHIT">      </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">"submit"</span><span class="PUNC">:</span><span class="WHIT">        </span><span class="NAME">rv.push</span><span class="PUNC">(</span><span class="STRN">'input[@type="submit"]'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1082</span> </span><span class="WHIT">      </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">"image"</span><span class="PUNC">:</span><span class="WHIT">         </span><span class="NAME">rv.push</span><span class="PUNC">(</span><span class="STRN">'input[@type="image"]'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1083</span> </span><span class="WHIT">      </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">"reset"</span><span class="PUNC">:</span><span class="WHIT">         </span><span class="NAME">rv.push</span><span class="PUNC">(</span><span class="STRN">'input[@type="reset"]'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1084</span> </span><span class="WHIT">      </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">"button"</span><span class="PUNC">:</span><span class="WHIT">        </span><span class="NAME">rv.push</span><span class="PUNC">(</span><span class="STRN">'*[self::input[@type="button"] or self::button]'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1085</span> </span><span class="WHIT">      </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">"file"</span><span class="PUNC">:</span><span class="WHIT">          </span><span class="NAME">rv.push</span><span class="PUNC">(</span><span class="STRN">'input[@type="file"]'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1086</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>1087</span> </span><span class="WHIT">      </span><span class="NAME">sel</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">sel.substring</span><span class="PUNC">(</span><span class="NAME">m</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">length</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1088</span> </span><span class="WHIT">      </span><span class="NAME">m</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">sel.match</span><span class="PUNC">(</span><span class="NAME">exp.PSEUDO</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// 書き方が冗長なのはstrictにするため</span><span class="WHIT">
<span class='linenumber'>1089</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>1090</span> </span><span class="WHIT">    </span><span class="COMM">// Combinator phase: E F, E > F, E + F, E ~ F</span><span class="WHIT">
<span class='linenumber'>1091</span> </span><span class="WHIT">    </span><span class="NAME">m</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">sel.match</span><span class="PUNC">(</span><span class="NAME">exp.COMBO1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1092</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">m</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>1093</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">m</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">"+"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="COMM">// E + F のケースでは、Fを先読みする必要がある</span><span class="WHIT">
<span class='linenumber'>1094</span> </span><span class="WHIT">        </span><span class="NAME">sel</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">sel.substring</span><span class="PUNC">(</span><span class="NAME">m</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">length</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1095</span> </span><span class="WHIT">        </span><span class="NAME">m2</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">sel.match</span><span class="PUNC">(</span><span class="NAME">exp.COMBO2</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1096</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">m2</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>1097</span> </span><span class="WHIT">          </span><span class="NAME">rv.push</span><span class="PUNC">(</span><span class="STRN">'/following-sibling::*[1][self::'</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">m2</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="STRN">']'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// とりあえ's</span><span class="WHIT">
<span class='linenumber'>1098</span> </span><span class="WHIT">          </span><span class="NAME">sel</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">sel.substring</span><span class="PUNC">(</span><span class="NAME">m2</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">length</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1099</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>1100</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>1101</span> </span><span class="WHIT">        </span><span class="KEYW">switch</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">m</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>1102</span> </span><span class="WHIT">        </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">">"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">rv.push</span><span class="PUNC">(</span><span class="STRN">"/"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1103</span> </span><span class="WHIT">        </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">"~"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">rv.push</span><span class="PUNC">(</span><span class="STRN">"/following-sibling::"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1104</span> </span><span class="WHIT">        </span><span class="KEYW">default</span><span class="PUNC">:</span><span class="WHIT">  </span><span class="NAME">rv.push</span><span class="PUNC">(</span><span class="STRN">"//"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1105</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>1106</span> </span><span class="WHIT">        </span><span class="NAME">index</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">rv.length</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1107</span> </span><span class="WHIT">        </span><span class="NAME">rv.push</span><span class="PUNC">(</span><span class="STRN">"*"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1108</span> </span><span class="WHIT">        </span><span class="NAME">sel</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">sel.substring</span><span class="PUNC">(</span><span class="NAME">m</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">length</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1109</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>1110</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>1111</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>1112</span> </span><span class="WHIT">  </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">rv.join</span><span class="PUNC">(</span><span class="STRN">""</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1113</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>1114</span> </span><span class="NAME">uu.css.toXPath._impl._regexp</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>1115</span> </span><span class="WHIT">  </span><span class="NAME">ELM</span><span class="PUNC">:</span><span class="WHIT">                </span><span class="REGX">/^([\.\#]?)([a-z0-9\*\_\-]*)/i</span><span class="PUNC">,</span><span class="WHIT">     </span><span class="COMM">// E</span><span class="WHIT">
<span class='linenumber'>1116</span> </span><span class="WHIT">  </span><span class="NAME">ATTR1</span><span class="PUNC">:</span><span class="WHIT">              </span><span class="REGX">/^\[\s*([^\~\^\$\*\|\=\s]+)\s*([\~\^\$\*\|]?=)\s*(['"])([^"']*)\3\s*\]/</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="COMM">// E[A=V]</span><span class="WHIT">
<span class='linenumber'>1117</span> </span><span class="WHIT">  </span><span class="NAME">ATTR2</span><span class="PUNC">:</span><span class="WHIT">              </span><span class="REGX">/^\[\s*([^\]]*)\s*\]/</span><span class="PUNC">,</span><span class="WHIT">              </span><span class="COMM">// E[A]</span><span class="WHIT">
<span class='linenumber'>1118</span> </span><span class="WHIT">  </span><span class="NAME">COMBO1</span><span class="PUNC">:</span><span class="WHIT">             </span><span class="REGX">/^(?:\s*([\>\+\~\s]))/</span><span class="PUNC">,</span><span class="WHIT">             </span><span class="COMM">// E F, E > F, E + F, E ~ F</span><span class="WHIT">
<span class='linenumber'>1119</span> </span><span class="WHIT">  </span><span class="NAME">COMBO2</span><span class="PUNC">:</span><span class="WHIT">             </span><span class="REGX">/^\s*([a-z0-9\*\_\-]+)/i</span><span class="PUNC">,</span><span class="WHIT">           </span><span class="COMM">// E + F の F用</span><span class="WHIT">
<span class='linenumber'>1120</span> </span><span class="WHIT">  </span><span class="NAME">PSEUDO</span><span class="PUNC">:</span><span class="WHIT">             </span><span class="REGX">/^\:([\w-]+)(?:\((.*)\))?/i</span><span class="PUNC">,</span><span class="WHIT">        </span><span class="COMM">// :nth-child(n)</span><span class="WHIT">
<span class='linenumber'>1121</span> </span><span class="WHIT">  </span><span class="STRN">"2n+1"</span><span class="PUNC">:</span><span class="WHIT">             </span><span class="REGX">/2n\+1/</span><span class="PUNC">,</span><span class="WHIT">                            </span><span class="COMM">// :nth-child(2n+1)</span><span class="WHIT">
<span class='linenumber'>1122</span> </span><span class="WHIT">  </span><span class="STRN">"xn+y"</span><span class="PUNC">:</span><span class="WHIT">             </span><span class="REGX">/([\d]+)n\+([\d]+)/</span><span class="PUNC">,</span><span class="WHIT">                </span><span class="COMM">// :nth-child(xn+y)</span><span class="WHIT">
<span class='linenumber'>1123</span> </span><span class="WHIT">  </span><span class="NAME">xn</span><span class="PUNC">:</span><span class="WHIT">                 </span><span class="REGX">/([\d]+)n/</span><span class="WHIT">                          </span><span class="COMM">// :nth-child(xn)</span><span class="WHIT">
<span class='linenumber'>1124</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1125</span> </span><span class="NAME">uu.css.toXPath._impl._attr</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>1126</span> </span><span class="WHIT">  </span><span class="STRN">"="</span><span class="PUNC">:</span><span class="WHIT">                </span><span class="STRN">'[@%1$s="%2$s"]'</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>1127</span> </span><span class="WHIT">  </span><span class="STRN">"~="</span><span class="PUNC">:</span><span class="WHIT">               </span><span class="STRN">'[contains(concat(" ",@%1$s," ")," %2$s ")]'</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>1128</span> </span><span class="WHIT">  </span><span class="STRN">"^="</span><span class="PUNC">:</span><span class="WHIT">               </span><span class="STRN">'[starts-with(@%1$s,"%2$s")]'</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>1129</span> </span><span class="WHIT">  </span><span class="STRN">"$="</span><span class="PUNC">:</span><span class="WHIT">               </span><span class="STRN">'[substring(@%1$s,string-length(@%1$s)-string-length("%2$s")+1)="%2$s"]'</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>1130</span> </span><span class="WHIT">  </span><span class="STRN">"*="</span><span class="PUNC">:</span><span class="WHIT">               </span><span class="STRN">'[contains(@%1$s,"%2$s")]'</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>1131</span> </span><span class="WHIT">  </span><span class="STRN">"|="</span><span class="PUNC">:</span><span class="WHIT">               </span><span class="STRN">'[@%1$s="%2$s" or starts-with(@%1$s,"%2$s-")]'</span><span class="WHIT">
<span class='linenumber'>1132</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1133</span> 
<span class='linenumber'>1134</span> </span><span class="COMM">////////////////////////////////////////////////////////////</span><span class="WHIT">
<span class='linenumber'>1135</span> </span><span class="COMM">/** &lt;b>uu.tag - タグ名と一致する要素を列挙(document.getElementsByTagName wrapper)&lt;/b>
<span class='linenumber'>1136</span>  *
<span class='linenumber'>1137</span>  * タグ名と一致する要素を列挙します。
<span class='linenumber'>1138</span>  *
<span class='linenumber'>1139</span>  * &lt;pre class="eg">
<span class='linenumber'>1140</span>  *  uu.tag("div"); // div要素を列挙
<span class='linenumber'>1141</span>  *  uu.tag("script", document.head); // head要素以下のscript要素を列挙
<span class='linenumber'>1142</span>  *  uu.tag("*"); // 全ての要素を列挙
<span class='linenumber'>1143</span>  * &lt;/pre>
<span class='linenumber'>1144</span>  *
<span class='linenumber'>1145</span>  * @param string  tagName   - タグ名を指定します。
<span class='linenumber'>1146</span>  *                            "*"(ワイルドカード)を指定すると、全てのタグを検索します。
<span class='linenumber'>1147</span>  * @param element [context] - 検索開始位置(コンテキスト)を指定します。デフォルトはdocumentです。
<span class='linenumber'>1148</span>  * @return NodeList/array     検索成功でNodeListまたは要素の配列 [element, ...] を返します。失敗で空のNodeListか配列を返します。&lt;br />
<span class='linenumber'>1149</span>  *                            NodeListまたは配列を返すため、uu.tag().forEach() ではなく、
<span class='linenumber'>1150</span>  *                            uu.forEach(uu.tag())を使用してください。
<span class='linenumber'>1151</span>  * @see &lt;a href="http://uupaa-js.googlecode.com/svn/trunk/SELECTOR.htm">セレクタ(Selector)&lt;/a>
<span class='linenumber'>1152</span>  * @class
<span class='linenumber'>1153</span>  */</span><span class="WHIT">
<span class='linenumber'>1154</span> </span><span class="NAME">uu.tag</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">tagName</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">context</span><span class="WHIT"> </span><span class="COMM">/* = document */</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>1155</span> </span><span class="WHIT">  </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">context</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">uud</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">getElementsByTagName</span><span class="PUNC">(</span><span class="NAME">tagName</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1156</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1157</span> 
<span class='linenumber'>1158</span> </span><span class="COMM">////////////////////////////////////////////////////////////</span><span class="WHIT">
<span class='linenumber'>1159</span> </span><span class="COMM">/** &lt;b>uu.xpath - XPathで検索(document.evaluate wrapper)&lt;/b>
<span class='linenumber'>1160</span>  *
<span class='linenumber'>1161</span>  * XPath式で要素を検索します。
<span class='linenumber'>1162</span>  *
<span class='linenumber'>1163</span>  * @param string  expr      - XPathの評価式(ロケーションパス)を指定します。
<span class='linenumber'>1164</span>  * @param element [context] - 検索開始位置(コンテキスト)を指定します。デフォルトはdocumentです。
<span class='linenumber'>1165</span>  *                            コンテキストを指定した場合は、exprに"//"ではなく"./"で始まる文字列を指定します。
<span class='linenumber'>1166</span>  * @return mix              - 評価結果を返します。評価に失敗するとnullを返します。
<span class='linenumber'>1167</span>  * @see &lt;a href="http://uupaa-js.googlecode.com/svn/trunk/SELECTOR.htm">セレクタ(Selector)&lt;/a>
<span class='linenumber'>1168</span>  * @class
<span class='linenumber'>1169</span>  */</span><span class="WHIT">
<span class='linenumber'>1170</span> </span><span class="NAME">uu.xpath</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">expr</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">context</span><span class="WHIT"> </span><span class="COMM">/* = document */</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>1171</span> </span><span class="WHIT">  </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">rv</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">r</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">uud.evaluate</span><span class="PUNC">(</span><span class="NAME">expr</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">context</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">uud</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// ANY_TYPE = 0</span><span class="WHIT">
<span class='linenumber'>1172</span> </span><span class="WHIT">  </span><span class="KEYW">switch</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">r.resultType</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>1173</span> </span><span class="WHIT">  </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">rv</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">r.numberValue</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">  </span><span class="COMM">// NUMBER_TYPE = 1</span><span class="WHIT">
<span class='linenumber'>1174</span> </span><span class="WHIT">  </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">rv</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">r.stringValue</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">  </span><span class="COMM">// STRING_TYPE = 2</span><span class="WHIT">
<span class='linenumber'>1175</span> </span><span class="WHIT">  </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="NUMB">3</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">rv</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">r.booleanValue</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// BOOLEAN_TYPE = 3</span><span class="WHIT">
<span class='linenumber'>1176</span> </span><span class="WHIT">  </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="NUMB">4</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">r.iterateNext</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1177</span> </span><span class="WHIT">          </span><span class="KEYW">while</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">i</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">rv.push</span><span class="PUNC">(</span><span class="NAME">i</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">r.iterateNext</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="COMM">// コードが冗長なのはstrictにするため</span><span class="WHIT">
<span class='linenumber'>1178</span> </span><span class="WHIT">          </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// UNORDERED_NODE_ITERATOR_TYPE = 4</span><span class="WHIT">
<span class='linenumber'>1179</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>1180</span> </span><span class="WHIT">  </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">rv</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1181</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1182</span> 
<span class='linenumber'>1183</span> </span><span class="COMM">/** &lt;b>uu.xpath.snap - XPathの検索結果をスナップ(XPath snapshot)&lt;/b>
<span class='linenumber'>1184</span>  *
<span class='linenumber'>1185</span>  * XPathの検索結果のスナップショットを取得します。&lt;br />
<span class='linenumber'>1186</span>  * setAttributeで設定された独自の属性があればそちらを取得しますが、
<span class='linenumber'>1187</span>  * Elementノードに同名の属性値があればそちらを優先します。&lt;br />
<span class='linenumber'>1188</span>  * 存在しない属性名を指定した場合は空文字列("")を返します。
<span class='linenumber'>1189</span>  *
<span class='linenumber'>1190</span>  * &lt;dl>
<span class='linenumber'>1191</span>  *  &lt;dt>div要素を列挙。uu.tags("div")と等価&lt;/dt>
<span class='linenumber'>1192</span>  *    &lt;dd>uu.xpath.snap('//div');&lt;/dd>
<span class='linenumber'>1193</span>  *  &lt;dt>div class="piyo"要素を列挙&lt;/dt>
<span class='linenumber'>1194</span>  *    &lt;dd>uu.xpath.snap('//div[@class="piyo"]');&lt;/dd>
<span class='linenumber'>1195</span>  *  &lt;dt>全要素からclass="piyo"を持つ要素を列挙, class="piyo hoge"もヒット, uu.tag("piyo")と等価&lt;/dt>
<span class='linenumber'>1196</span>  *    &lt;dd>uu.xpath.snap('//*[contains(@class,"piyo")]');&lt;/dd>
<span class='linenumber'>1197</span>  *  &lt;dt>全要素からid属性を持つものを列挙&lt;/dt>
<span class='linenumber'>1198</span>  *    &lt;dd>uu.xpath.snap('//*[@id!=""]', id);&lt;/dd>
<span class='linenumber'>1199</span>  *  &lt;dt>title="hoge"でclass="piyo"な要素を列挙&lt;/dt>
<span class='linenumber'>1200</span>  *    &lt;dd>uu.xpath.snap('//*[@title="hoge" and @class="piyo"]');&lt;/dd>
<span class='linenumber'>1201</span>  *  &lt;dt>コンテキスト以下のdiv要素で、class="draggable"を持つ子孫ノードを列挙&lt;/dt>
<span class='linenumber'>1202</span>  *    &lt;dd>uu.xpath.snap('./div[@class="draggable"]', "id", コンテキスト);&lt;br />
<span class='linenumber'>1203</span>  *        uu.xpath.snap('//div[@class="draggable"]'); とするとコンテキストを無視して、
<span class='linenumber'>1204</span>  *        全divを検索するため意図しない結果になるので注意が必要です。&lt;/dd>
<span class='linenumber'>1205</span>  * &lt;/dl>
<span class='linenumber'>1206</span>  *
<span class='linenumber'>1207</span>  * @param string  expr      - XPathの評価式(ロケーションパス)を指定します。
<span class='linenumber'>1208</span>  * @param string  [attr]    - 取得する属性を指定します。デフォルトは空文字列です。
<span class='linenumber'>1209</span>  * @param element [context] - 検索開始位置(コンテキスト)を指定します。デフォルトはdocumentです。
<span class='linenumber'>1210</span>  *                            コンテキストを指定した場合は、exprに"//"ではなく"./"で始まる文字列を指定します。
<span class='linenumber'>1211</span>  * @param bool    [sort]    - ソートする場合にtrue,ソートしない場合にfalseを指定します。省略可能でデフォルトはtrueです。&lt;br />
<span class='linenumber'>1212</span>  * @return array            - attrを指定した場合は、列挙した要素の属性値だけからなる配列 [値, 値, ...]を返します。&lt;br />
<span class='linenumber'>1213</span>  *                            attrを指定しない場合は、要素の参照の配列を返します。&lt;br />
<span class='linenumber'>1214</span>  *                            返される値は、ある時点のスナップショットです(ライブではない)
<span class='linenumber'>1215</span>  * @see &lt;a href="http://uupaa-js.googlecode.com/svn/trunk/SELECTOR.htm">セレクタ(Selector)&lt;/a>
<span class='linenumber'>1216</span>  */</span><span class="WHIT">
<span class='linenumber'>1217</span> </span><span class="NAME">uu.xpath.snap</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">expr</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">attr</span><span class="WHIT"> </span><span class="COMM">/* = "" */</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">context</span><span class="WHIT"> </span><span class="COMM">/* = document */</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">sort</span><span class="WHIT"> </span><span class="COMM">/* = true */</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>1218</span> </span><span class="WHIT">  </span><span class="NAME">attr</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">attr</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1219</span> </span><span class="WHIT">  </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">rv</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">e</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">n</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">uud.evaluate</span><span class="PUNC">(</span><span class="NAME">expr</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">context</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">uud</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">sort</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NUMB">7</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">6</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1220</span> </span><span class="WHIT">  </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">attr.length</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>1221</span> </span><span class="WHIT">    </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">n.snapshotLength</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">++</span><span class="NAME">i</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>1222</span> </span><span class="WHIT">      </span><span class="NAME">e</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">n.snapshotItem</span><span class="PUNC">(</span><span class="NAME">i</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1223</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">attr</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">e</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>1224</span> </span><span class="WHIT">        </span><span class="NAME">rv.push</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">[</span><span class="NAME">attr</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1225</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">e.hasAttribute</span><span class="PUNC">(</span><span class="NAME">attr</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>1226</span> </span><span class="WHIT">        </span><span class="NAME">rv.push</span><span class="PUNC">(</span><span class="NAME">e.getAttribute</span><span class="PUNC">(</span><span class="NAME">attr</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1227</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>1228</span> </span><span class="WHIT">        </span><span class="NAME">rv.push</span><span class="PUNC">(</span><span class="STRN">""</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1229</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>1230</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>1231</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>1232</span> </span><span class="WHIT">    </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">n.snapshotLength</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">++</span><span class="NAME">i</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>1233</span> </span><span class="WHIT">      </span><span class="NAME">rv.push</span><span class="PUNC">(</span><span class="NAME">n.snapshotItem</span><span class="PUNC">(</span><span class="NAME">i</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1234</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>1235</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>1236</span> </span><span class="WHIT">  </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">rv</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1237</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1238</span> 
<span class='linenumber'>1239</span> </span><span class="COMM">////////////////////////////////////////////////////////////</span><span class="WHIT">
<span class='linenumber'>1240</span> </span><span class="COMM">/** &lt;b>Event&lt;/b>
<span class='linenumber'>1241</span>  *
<span class='linenumber'>1242</span>  * @class
<span class='linenumber'>1243</span>  */</span><span class="WHIT">
<span class='linenumber'>1244</span> </span><span class="NAME">uu.event</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>1245</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1246</span> 
<span class='linenumber'>1247</span> </span><span class="COMM">/** &lt;b>uu.event.handler - uu.event.set()用の引数を生成&lt;/b>
<span class='linenumber'>1248</span>  *
<span class='linenumber'>1249</span>  * @param this    me    thisを指定します。
<span class='linenumber'>1250</span>  * @return object       uu.event.set()用のオブジェクトを返します。
<span class='linenumber'>1251</span>  * @see uu.event.set - イベントハンドラの設定 
<span class='linenumber'>1252</span>  * @see uu.event.unset - イベントハンドラの解除
<span class='linenumber'>1253</span>  * @see JavaScript第5版 420p
<span class='linenumber'>1254</span>  */</span><span class="WHIT">
<span class='linenumber'>1255</span> </span><span class="NAME">uu.event.handler</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">me</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">me</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1256</span> 
<span class='linenumber'>1257</span> </span><span class="COMM">/** &lt;b>uu.event.set - イベントハンドラの設定(addEventListener wrapper)&lt;/b>
<span class='linenumber'>1258</span>  *
<span class='linenumber'>1259</span>  * イベントハンドラを設定します。&lt;br />
<span class='linenumber'>1260</span>  * イベントハンドラを解除するには、uu.event.set()と同じ引数をuu.event.unset()で指定します。&lt;br />
<span class='linenumber'>1261</span>  *
<span class='linenumber'>1262</span>  * 一時的なオブジェクト(匿名のfunction()等)をfnに指定すると、
<span class='linenumber'>1263</span>  * uu.event.unset()でイベントを解除できなくなりますので注意してください。
<span class='linenumber'>1264</span>  *
<span class='linenumber'>1265</span>  * @param element     elm       - イベントを設定する要素を指定します。
<span class='linenumber'>1266</span>  * @param taxing      type      - イベントタイプを指定します。
<span class='linenumber'>1267</span>  * @param function    fn        - uu.event.handler()の戻り値か関数を指定します。
<span class='linenumber'>1268</span>  * @param bool        [capture] - イベントをキャプチャーする場合はtrueを指定します。
<span class='linenumber'>1269</span>  *                                                  通常のイベントハンドラを登録する場合はfalseを指定します。
<span class='linenumber'>1270</span>  * @see uu.event.handler - uu.event.set()用の引数を生成
<span class='linenumber'>1271</span>  * @see uu.event.unset - イベントハンドラの解除
<span class='linenumber'>1272</span>  */</span><span class="WHIT">
<span class='linenumber'>1273</span> </span><span class="NAME">uu.event.set</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">elm</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">type</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">fn</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">capture</span><span class="WHIT"> </span><span class="COMM">/* = false */</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>1274</span> </span><span class="WHIT">  </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">uu.isU</span><span class="PUNC">(</span><span class="NAME">fn</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">throw</span><span class="WHIT"> </span><span class="NAME">TypeError</span><span class="PUNC">(</span><span class="STRN">"uu.event.set(fn)"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>1275</span> </span><span class="WHIT">  </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">impl</span><span class="PUNC">(</span><span class="NAME">name</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">elm.addEventListener</span><span class="PUNC">(</span><span class="NAME">uu.event.type.toDOM</span><span class="PUNC">(</span><span class="NAME">name</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">fn</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">capture</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>1276</span> </span><span class="WHIT">  </span><span class="NAME">uu.notax</span><span class="PUNC">(</span><span class="NAME">type</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">forEach</span><span class="PUNC">(</span><span class="NAME">impl</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1277</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1278</span> 
<span class='linenumber'>1279</span> </span><span class="COMM">/** &lt;b>uu.event.unset - イベントハンドラの解除(removeEventListener wrapper)&lt;/b>
<span class='linenumber'>1280</span>  *
<span class='linenumber'>1281</span>  * イベントハンドラを解除します。&lt;br />
<span class='linenumber'>1282</span>  * イベントハンドラを解除するには、uu.event.set()と同じ引数を指定します。
<span class='linenumber'>1283</span>  *
<span class='linenumber'>1284</span>  * @param element     elm       - イベントを解除する要素を指定します。
<span class='linenumber'>1285</span>  * @param taxing      type      - イベントタイプを指定します。
<span class='linenumber'>1286</span>  * @param object      fn        - uu.handleEvent()の戻り値か関数を指定します。
<span class='linenumber'>1287</span>  * @param bool        [capture] - キャプチャーを解除する場合はtrueを指定します。
<span class='linenumber'>1288</span>  *                                通常のイベントハンドラを解除する場合はfalseを指定します。
<span class='linenumber'>1289</span>  * @see uu.event.handler - uu.event.set()用の引数を生成
<span class='linenumber'>1290</span>  * @see uu.event.set - イベントハンドラの設定
<span class='linenumber'>1291</span>  */</span><span class="WHIT">
<span class='linenumber'>1292</span> </span><span class="NAME">uu.event.unset</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">elm</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">type</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">fn</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">capture</span><span class="WHIT"> </span><span class="COMM">/* = false */</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>1293</span> </span><span class="WHIT">  </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">uu.isU</span><span class="PUNC">(</span><span class="NAME">fn</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">throw</span><span class="WHIT"> </span><span class="NAME">TypeError</span><span class="PUNC">(</span><span class="STRN">"uu.event.set(fn)"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>1294</span> </span><span class="WHIT">  </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">impl</span><span class="PUNC">(</span><span class="NAME">name</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">elm.removeEventListener</span><span class="PUNC">(</span><span class="NAME">uu.event.type.toDOM</span><span class="PUNC">(</span><span class="NAME">name</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">fn</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">capture</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>1295</span> </span><span class="WHIT">  </span><span class="NAME">uu.notax</span><span class="PUNC">(</span><span class="NAME">type</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">forEach</span><span class="PUNC">(</span><span class="NAME">impl</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1296</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1297</span> 
<span class='linenumber'>1298</span> </span><span class="COMM">/** &lt;b>uu.event.stop - イベントの停止(stopPropagation and preventDefault wrapper)&lt;/b>
<span class='linenumber'>1299</span>  *
<span class='linenumber'>1300</span>  * イベントのバブルアップ(伝播)と、可能ならデフォルトの動作を抑止します。
<span class='linenumber'>1301</span>  *
<span class='linenumber'>1302</span>  * @param event evt       - イベントオブジェクトを指定します。
<span class='linenumber'>1303</span>  * @param bool  [cancel]  - ブラウザが実装しているデフォルトの動作をキャンセルする場合にtrueを指定します。
<span class='linenumber'>1304</span>  *                          キャンセルできない場合は無視されます。
<span class='linenumber'>1305</span>  */</span><span class="WHIT">
<span class='linenumber'>1306</span> </span><span class="NAME">uu.event.stop</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">cancel</span><span class="WHIT"> </span><span class="COMM">/* = true */</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>1307</span> </span><span class="WHIT">  </span><span class="NAME">evt.stopPropagation</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1308</span> </span><span class="COMM">//uu.defArg(cancel, true) && evt.preventDefault();</span><span class="WHIT">
<span class='linenumber'>1309</span> </span><span class="WHIT">  </span><span class="PUNC">(</span><span class="NAME">uu.isU</span><span class="PUNC">(</span><span class="NAME">cancel</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">cancel</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">evt.preventDefault</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1310</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1311</span> 
<span class='linenumber'>1312</span> </span><span class="COMM">/** &lt;b>uu.event.target - イベント発生元のノードを取得&lt;/b>
<span class='linenumber'>1313</span>  *
<span class='linenumber'>1314</span>  * イベント発生元を特定する情報を返します。
<span class='linenumber'>1315</span>  *
<span class='linenumber'>1316</span>  *  &lt;dl>
<span class='linenumber'>1317</span>  *    &lt;dt>real&lt;/dt>&lt;dd>イベント発生源のノード&lt;/dd>
<span class='linenumber'>1318</span>  *    &lt;dt>curt&lt;/dt>&lt;dd>現在処理中のノード(キャプチャリング/バブリング中)のカレントノード(Firefox, Safari, Opera)&lt;/dd>
<span class='linenumber'>1319</span>  *    &lt;dt>rel&lt;/dt>&lt;dd>realの対ノード&lt;br />
<span class='linenumber'>1320</span>  *        realでmouseover発生時に、relにmouseoutした要素が格納される、&lt;br />
<span class='linenumber'>1321</span>  *        realでmouseout発生時は、relにmouseoverした要素が格納される。&lt;/dd>
<span class='linenumber'>1322</span>  *  &lt;/dl>
<span class='linenumber'>1323</span>  *
<span class='linenumber'>1324</span>  * @param event evt       - イベントオブジェクトを指定します。
<span class='linenumber'>1325</span>  * @return hash           - hash({ real, curt, rel }) を返します。
<span class='linenumber'>1326</span>  */</span><span class="WHIT">
<span class='linenumber'>1327</span> </span><span class="NAME">uu.event.target</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="COMM">// for Firefox, Safari, Opera</span><span class="WHIT">
<span class='linenumber'>1328</span> </span><span class="WHIT">  </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">real</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">evt.target</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">curt</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">evt.currentTarget</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">rel</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">evt.relatedTarget</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1329</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1330</span> 
<span class='linenumber'>1331</span> </span><span class="COMM">/** &lt;b>uu.event.type - イベント名をDOM Level 0イベントタイプに変換&lt;/b>
<span class='linenumber'>1332</span>  *
<span class='linenumber'>1333</span>  * @private
<span class='linenumber'>1334</span>  * @param string  type  - イベントタイプを指定します。
<span class='linenumber'>1335</span>  * @return string       - 変換後のイベントタイプを返します。
<span class='linenumber'>1336</span>  */</span><span class="WHIT">
<span class='linenumber'>1337</span> </span><span class="NAME">uu.event.type</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">type</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>1338</span> </span><span class="WHIT">  </span><span class="KEYW">switch</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">type</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>1339</span> </span><span class="WHIT">  </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">"onlosecapture"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">type</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"mouseup"</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1340</span> </span><span class="WHIT">  </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">"DOMMouseScroll"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">type</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"mousewheel"</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1341</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>1342</span> </span><span class="WHIT">  </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">type</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1343</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1344</span> </span><span class="COMM">/** &lt;b>uu.event.type.toDOM - 非DOMイベント名をDOMイベントタイプに変換&lt;/b>
<span class='linenumber'>1345</span>  *
<span class='linenumber'>1346</span>  * @private
<span class='linenumber'>1347</span>  * @param string  type  - イベントタイプを指定します。
<span class='linenumber'>1348</span>  * @return string       - 変換後のイベントタイプを返します。
<span class='linenumber'>1349</span>  */</span><span class="WHIT">
<span class='linenumber'>1350</span> </span><span class="NAME">uu.event.type.toDOM</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">type</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">type</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1351</span> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">uu.ua.gecko</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="COMM">// for Firefox</span><span class="WHIT">
<span class='linenumber'>1352</span> </span><span class="WHIT">  </span><span class="NAME">uu.event.type.toDOM</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">type</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>1353</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">type</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">"mousewheel"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="STRN">"DOMMouseScroll"</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">type</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1354</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1355</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>1356</span> 
<span class='linenumber'>1357</span> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">uu.ua.ie</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="COMM">// for IE</span><span class="WHIT">
<span class='linenumber'>1358</span> </span><span class="WHIT">  </span><span class="COMM">// 第一引数で渡されるthis(me)を保持し、this.handleEvent.call(this, event) を実現するクロージャ</span><span class="WHIT">
<span class='linenumber'>1359</span> </span><span class="WHIT">  </span><span class="NAME">uu.event.handler</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">me</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>1360</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">me.handleEvent</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1361</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1362</span> </span><span class="WHIT">  </span><span class="NAME">uu.event.set</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">elm</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">type</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">fn</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">capture</span><span class="WHIT"> </span><span class="COMM">/* = false */</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>1363</span> </span><span class="WHIT">    </span><span class="NAME">type</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">uu.notax</span><span class="PUNC">(</span><span class="NAME">type</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1364</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">capture</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="STRN">"setCapture"</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">elm</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>1365</span> </span><span class="WHIT">      </span><span class="NAME">elm.setCapture</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">                 </span><span class="COMM">// キャプチャ開始</span><span class="WHIT">
<span class='linenumber'>1366</span> </span><span class="WHIT">      </span><span class="NAME">type.unshift</span><span class="PUNC">(</span><span class="STRN">"onlosecapture"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">    </span><span class="COMM">// キャプチャロスト時にコールされるイベントハンドラを先頭に挿入</span><span class="WHIT">
<span class='linenumber'>1367</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>1368</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">impl</span><span class="PUNC">(</span><span class="NAME">name</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">elm.attachEvent</span><span class="PUNC">(</span><span class="STRN">"on"</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">name</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">fn</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>1369</span> </span><span class="WHIT">    </span><span class="NAME">type.forEach</span><span class="PUNC">(</span><span class="NAME">impl</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1370</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1371</span> </span><span class="WHIT">  </span><span class="NAME">uu.event.unset</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">elm</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">type</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">fn</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">capture</span><span class="WHIT"> </span><span class="COMM">/* = false */</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>1372</span> </span><span class="WHIT">    </span><span class="NAME">type</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">uu.notax</span><span class="PUNC">(</span><span class="NAME">type</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1373</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">capture</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="STRN">"releaseCapture"</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">elm</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>1374</span> </span><span class="WHIT">      </span><span class="NAME">type.unshift</span><span class="PUNC">(</span><span class="STRN">"onlosecapture"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">    </span><span class="COMM">// uu.event.set()で自動挿入したイベントハンドラをここでも</span><span class="WHIT">
<span class='linenumber'>1375</span> </span><span class="WHIT">      </span><span class="NAME">elm.releaseCapture</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">             </span><span class="COMM">// キャプチャ終了</span><span class="WHIT">
<span class='linenumber'>1376</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>1377</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">impl</span><span class="PUNC">(</span><span class="NAME">name</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">elm.detachEvent</span><span class="PUNC">(</span><span class="STRN">"on"</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">name</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">fn</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>1378</span> </span><span class="WHIT">    </span><span class="NAME">type.forEach</span><span class="PUNC">(</span><span class="NAME">impl</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1379</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1380</span> </span><span class="WHIT">  </span><span class="NAME">uu.event.stop</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">cancelDefault</span><span class="WHIT"> </span><span class="COMM">/* = true */</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>1381</span> </span><span class="WHIT">    </span><span class="NAME">evt.cancelBubble</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1382</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">uu.isU</span><span class="PUNC">(</span><span class="NAME">cancelDefault</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">cancelDefault</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">evt.returnValue</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>1383</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1384</span> </span><span class="WHIT">  </span><span class="NAME">uu.event.target</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>1385</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">s</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">evt.srcElement</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">f</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">evt.fromElement</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1386</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">real</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">s</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">curt</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">s</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">rel</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">s</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">f</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">evt.toElement</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">f</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1387</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1388</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>1389</span> 
<span class='linenumber'>1390</span> </span><span class="COMM">////////////////////////////////////////////////////////////</span><span class="WHIT">
<span class='linenumber'>1391</span> </span><span class="COMM">/** &lt;b>DOM&lt;/b>
<span class='linenumber'>1392</span>  *
<span class='linenumber'>1393</span>  * @class
<span class='linenumber'>1394</span>  */</span><span class="WHIT">
<span class='linenumber'>1395</span> </span><span class="NAME">uu.dom</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>1396</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1397</span> 
<span class='linenumber'>1398</span> </span><span class="COMM">/** &lt;b>uu.dom.already - DOM使用可能でtrue&lt;/b>
<span class='linenumber'>1399</span>  *
<span class='linenumber'>1400</span>  * @return bool - DOMが使用可能な状態ならtrueを返します。
<span class='linenumber'>1401</span>  */</span><span class="WHIT">
<span class='linenumber'>1402</span> </span><span class="NAME">uu.dom.already</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>1403</span> </span><span class="WHIT">  </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="PUNC">!</span><span class="NAME">uu.dom.ready._run</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1404</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1405</span> 
<span class='linenumber'>1406</span> </span><span class="COMM">/** &lt;b>uu.dom.ready - document.DOMContentLoadedイベントハンドラ(document.DOMContentLoaded event handler)&lt;/b>
<span class='linenumber'>1407</span>  *
<span class='linenumber'>1408</span>  * DOMが使用可能になると呼ばれる関数を登録します。&lt;br />
<span class='linenumber'>1409</span>  * document.DOMContentLoadedをサポートしていないブラウザ(IE, Safari)では同様の機能をエミュレートします。&lt;br />
<span class='linenumber'>1410</span>  *
<span class='linenumber'>1411</span>  * 既にDOMが使用可能になっている状態(uu.dom.already()==true)で呼ばれた場合は、
<span class='linenumber'>1412</span>  * 即座に関数を実行します。
<span class='linenumber'>1413</span>  *
<span class='linenumber'>1414</span>  * @param function/array fn - コールバック関数を指定します。関数の配列も指定可能です。
<span class='linenumber'>1415</span>  * @see uu.dom.already - dom使用可能でtrue
<span class='linenumber'>1416</span>  * @see uu.canvas.ready - canvasが使用可能になると呼ばれる関数を登録
<span class='linenumber'>1417</span>  * @see uu.canvas.already - canvas使用可能でtrue
<span class='linenumber'>1418</span>  * @see uu.window.ready - windowが使用可能になると呼ばれる関数を登録
<span class='linenumber'>1419</span>  * @see uu.window.already - window使用可能でtrue
<span class='linenumber'>1420</span>  * @see uu.window.unready - windowが使用不能になると呼ばれる関数を登録
<span class='linenumber'>1421</span>  * @see uu.window.unalready - window使用不能でtrue
<span class='linenumber'>1422</span>  */</span><span class="WHIT">
<span class='linenumber'>1423</span> </span><span class="NAME">uu.dom.ready</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">fn</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>1424</span> </span><span class="WHIT">  </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">e</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">arguments.callee</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1425</span> </span><span class="WHIT">  </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">e._run</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>1426</span> </span><span class="WHIT">    </span><span class="PUNC">(</span><span class="NAME">uu.isA</span><span class="PUNC">(</span><span class="NAME">fn</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">fn</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">fn</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">forEach</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">v</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">v</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1427</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>1428</span> </span><span class="WHIT">    </span><span class="NAME">e._stock</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">e._stock.concat</span><span class="PUNC">(</span><span class="NAME">fn</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1429</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">uu.ua.gecko</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">uu.ua.opera</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>1430</span> </span><span class="WHIT">      </span><span class="NAME">uud.addEventListener</span><span class="PUNC">(</span><span class="STRN">"DOMContentLoaded"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">uu.dom.ready._impl</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1431</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">uu.ua.ie</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">uud.readyState</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>1432</span> </span><span class="WHIT">      </span><span class="NAME">uud.write</span><span class="PUNC">(</span><span class="STRN">'&lt;script type="text/javascript" defer="defer" src="//:" onreadystatechange="(this.readyState==\'loaded\'||this.readyState==\'complete\')&&uu&&uu.dom.ready._impl()">&lt;/script>'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1433</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">uu.ua.webkit</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">uud.readyState</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>1434</span> </span><span class="WHIT">      </span><span class="NAME">uuw.setTimeout</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>1435</span> </span><span class="WHIT">        </span><span class="PUNC">(</span><span class="REGX">/loaded|complete/</span><span class="PUNC">.</span><span class="NAME">test</span><span class="PUNC">(</span><span class="NAME">uud.readyState</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">uu.dom.ready._impl</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">uuw.setTimeout</span><span class="PUNC">(</span><span class="NAME">arguments.callee</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1436</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1437</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>1438</span> </span><span class="WHIT">      </span><span class="NAME">uu.window.ready</span><span class="PUNC">(</span><span class="NAME">uu.dom.ready._impl</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// レガシーブラウザならwindow.onloadで代用(for legacy browser)</span><span class="WHIT">
<span class='linenumber'>1439</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>1440</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>1441</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1442</span> </span><span class="NAME">uu.dom.ready._run</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// uu.dom.ready()実行回数</span><span class="WHIT">
<span class='linenumber'>1443</span> </span><span class="NAME">uu.dom.ready._stock</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// uu.dom.ready()用イベントコンテナ</span><span class="WHIT">
<span class='linenumber'>1444</span> </span><span class="NAME">uu.dom.ready._impl</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="COMM">// uu.dom.ready()の実処理部</span><span class="WHIT">
<span class='linenumber'>1445</span> </span><span class="WHIT">  </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">e</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">uu.dom.ready</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1446</span> </span><span class="WHIT">  </span><span class="PUNC">!</span><span class="NAME">e._run</span><span class="PUNC">++</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">e._stock.forEach</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">v</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">v</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">e._stock</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// gc</span><span class="WHIT">
<span class='linenumber'>1447</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1448</span> 
<span class='linenumber'>1449</span> </span><span class="COMM">////////////////////////////////////////////////////////////</span><span class="WHIT">
<span class='linenumber'>1450</span> </span><span class="COMM">/** &lt;b>Window&lt;/b>
<span class='linenumber'>1451</span>  *
<span class='linenumber'>1452</span>  * @class
<span class='linenumber'>1453</span>  */</span><span class="WHIT">
<span class='linenumber'>1454</span> </span><span class="NAME">uu.window</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>1455</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1456</span> 
<span class='linenumber'>1457</span> </span><span class="COMM">/** &lt;b>uu.window.already - windowロード済みでtrue&lt;/b>
<span class='linenumber'>1458</span>  *
<span class='linenumber'>1459</span>  * @return bool - windowロード済みでtrueを返します。
<span class='linenumber'>1460</span>  */</span><span class="WHIT">
<span class='linenumber'>1461</span> </span><span class="NAME">uu.window.already</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>1462</span> </span><span class="WHIT">  </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="PUNC">!</span><span class="NAME">uu.window.ready._run</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1463</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1464</span> 
<span class='linenumber'>1465</span> </span><span class="COMM">/** &lt;b>uu.window.unalready - windowアンロード済みでtrue&lt;/b>
<span class='linenumber'>1466</span>  *
<span class='linenumber'>1467</span>  * @return bool - windowアンロード済みでtrueを返します。
<span class='linenumber'>1468</span>  */</span><span class="WHIT">
<span class='linenumber'>1469</span> </span><span class="NAME">uu.window.unalready</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>1470</span> </span><span class="WHIT">  </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="PUNC">!</span><span class="NAME">uu.window.unready._run</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1471</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1472</span> 
<span class='linenumber'>1473</span> </span><span class="COMM">/** &lt;b>uu.window.ready - window.onloadイベントハンドラ(window.onload event handler)&lt;/b>
<span class='linenumber'>1474</span>  *
<span class='linenumber'>1475</span>  * windowが使用可能になると呼ばれる関数を登録します。&lt;br />
<span class='linenumber'>1476</span>  *
<span class='linenumber'>1477</span>  * 既にwindowが使用可能になっている状態(uu.window.already()==true)で呼ばれた場合は、
<span class='linenumber'>1478</span>  * 即座に関数を実行します。
<span class='linenumber'>1479</span>  *
<span class='linenumber'>1480</span>  * @param function/array  fn - コールバック関数を指定します。関数の配列も指定可能です。
<span class='linenumber'>1481</span>  * @see uu.dom.ready - domが使用可能になると呼ばれる関数を登録
<span class='linenumber'>1482</span>  * @see uu.dom.already - dom使用可能でtrue
<span class='linenumber'>1483</span>  * @see uu.canvas.ready - canvasが使用可能になると呼ばれる関数を登録
<span class='linenumber'>1484</span>  * @see uu.canvas.already - canvas使用可能でtrue
<span class='linenumber'>1485</span>  * @see uu.window.already - window使用可能でtrue
<span class='linenumber'>1486</span>  * @see uu.window.unready - windowが使用不能になると呼ばれる関数を登録
<span class='linenumber'>1487</span>  * @see uu.window.unalready - window使用不能でtrue
<span class='linenumber'>1488</span>  */</span><span class="WHIT">
<span class='linenumber'>1489</span> </span><span class="NAME">uu.window.ready</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">fn</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>1490</span> </span><span class="WHIT">  </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">e</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">arguments.callee</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1491</span> </span><span class="WHIT">  </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">e._run</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">uu.isA</span><span class="PUNC">(</span><span class="NAME">fn</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">fn</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">fn</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">forEach</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">v</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">v</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>1492</span> </span><span class="WHIT">         </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">e._stock</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">e._stock.concat</span><span class="PUNC">(</span><span class="NAME">fn</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1493</span> </span><span class="WHIT">                </span><span class="PUNC">!</span><span class="NAME">e._run</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">uu.event.set</span><span class="PUNC">(</span><span class="NAME">uuw</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"load"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">e._impl</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="COMM">// stock</span><span class="WHIT">
<span class='linenumber'>1494</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1495</span> </span><span class="NAME">uu.window.ready._run</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// uu.window.ready()実行回数</span><span class="WHIT">
<span class='linenumber'>1496</span> </span><span class="NAME">uu.window.ready._stock</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// uu.window.ready()用イベントコンテナ</span><span class="WHIT">
<span class='linenumber'>1497</span> </span><span class="NAME">uu.window.ready._impl</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="COMM">// uu.window.ready()の実処理部</span><span class="WHIT">
<span class='linenumber'>1498</span> </span><span class="WHIT">  </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">e</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">uu.window.ready</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1499</span> </span><span class="WHIT">  </span><span class="PUNC">!</span><span class="NAME">e._run</span><span class="PUNC">++</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">e._stock.forEach</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">v</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">v</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">e._stock</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// gc</span><span class="WHIT">
<span class='linenumber'>1500</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1501</span> 
<span class='linenumber'>1502</span> </span><span class="COMM">/** &lt;b>uu.window.unready - window.onunloadイベントハンドラ(window.onunload event handler)&lt;/b>
<span class='linenumber'>1503</span>  *
<span class='linenumber'>1504</span>  * windowが使用不能になると呼ばれる関数を登録します。&lt;br />
<span class='linenumber'>1505</span>  * uu.window.ready()と違い、即座に実行する機能はありません。
<span class='linenumber'>1506</span>  *
<span class='linenumber'>1507</span>  * @param function/array  fn   - コールバック関数を指定します。関数の配列も指定可能です。
<span class='linenumber'>1508</span>  * @param this            [me] - fn実行時のthisを指定します。デフォルトはundefinedです。
<span class='linenumber'>1509</span>  * @see uu.dom.ready - domが使用可能になると呼ばれる関数を登録
<span class='linenumber'>1510</span>  * @see uu.dom.already - dom使用可能でtrue
<span class='linenumber'>1511</span>  * @see uu.canvas.ready - canvasが使用可能になると呼ばれる関数を登録
<span class='linenumber'>1512</span>  * @see uu.canvas.already - canvas使用可能でtrue
<span class='linenumber'>1513</span>  * @see uu.window.ready - windowが使用可能になると呼ばれる関数を登録
<span class='linenumber'>1514</span>  * @see uu.window.already - window使用可能でtrue
<span class='linenumber'>1515</span>  * @see uu.window.unready - windowが使用不能になると呼ばれる関数を登録
<span class='linenumber'>1516</span>  * @see uu.window.unalready - window使用不能でtrue
<span class='linenumber'>1517</span>  */</span><span class="WHIT">
<span class='linenumber'>1518</span> </span><span class="NAME">uu.window.unready</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">fn</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">me</span><span class="WHIT"> </span><span class="COMM">/* = undefined */</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>1519</span> </span><span class="WHIT">  </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">e</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">arguments.callee</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1520</span> </span><span class="WHIT">  </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">uu.isA</span><span class="PUNC">(</span><span class="NAME">fn</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">e._stock.forEach</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">v</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">e._stock.push</span><span class="PUNC">(</span><span class="PUNC">[</span><span class="NAME">v</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">me</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>1521</span> </span><span class="WHIT">             </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">e._stock.push</span><span class="PUNC">(</span><span class="PUNC">[</span><span class="NAME">fn</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">me</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>1522</span> </span><span class="WHIT">  </span><span class="PUNC">!</span><span class="NAME">e._run</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">uu.event.set</span><span class="PUNC">(</span><span class="NAME">uuw</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"unload"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">e._impl</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// stock</span><span class="WHIT">
<span class='linenumber'>1523</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1524</span> </span><span class="NAME">uu.window.unready._run</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// uu.window.unready()実行回数</span><span class="WHIT">
<span class='linenumber'>1525</span> </span><span class="NAME">uu.window.unready._stock</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// uu.window.unready()用イベントコンテナ</span><span class="WHIT">
<span class='linenumber'>1526</span> </span><span class="NAME">uu.window.unready._impl</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="COMM">// uu.window.unready()の実処理部</span><span class="WHIT">
<span class='linenumber'>1527</span> </span><span class="WHIT">  </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">e</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">uu.window.unready</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1528</span> </span><span class="WHIT">  </span><span class="PUNC">!</span><span class="NAME">e._run</span><span class="PUNC">++</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">e._stock.forEach</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">v</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">uu.isF</span><span class="PUNC">(</span><span class="NAME">v</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">v</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">call</span><span class="PUNC">(</span><span class="NAME">v</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>1529</span> </span><span class="WHIT">                </span><span class="NAME">e._stock</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// gc</span><span class="WHIT">
<span class='linenumber'>1530</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1531</span> 
<span class='linenumber'>1532</span> </span><span class="COMM">////////////////////////////////////////////////////////////</span><span class="WHIT">
<span class='linenumber'>1533</span> </span><span class="COMM">/** &lt;b>canvas&lt;/b>
<span class='linenumber'>1534</span>  *
<span class='linenumber'>1535</span>  * @class
<span class='linenumber'>1536</span>  */</span><span class="WHIT">
<span class='linenumber'>1537</span> </span><span class="NAME">uu.canvas</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>1538</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1539</span> 
<span class='linenumber'>1540</span> </span><span class="COMM">/** &lt;b>uu.canvas.already - canvas使用可能でtrue&lt;/b>
<span class='linenumber'>1541</span>  *
<span class='linenumber'>1542</span>  * @return bool - canvasが使用可能でtrueを返します。
<span class='linenumber'>1543</span>  */</span><span class="WHIT">
<span class='linenumber'>1544</span> </span><span class="NAME">uu.canvas.already</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>1545</span> </span><span class="WHIT">  </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="PUNC">!</span><span class="NAME">uu.canvas.ready._run</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1546</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1547</span> 
<span class='linenumber'>1548</span> </span><span class="COMM">/** &lt;b>uu.canvas.ready - canvas.readyイベントハンドラ(canvas.ready event handler)&lt;/b>
<span class='linenumber'>1549</span>  *
<span class='linenumber'>1550</span>  * canvasが使用可能になると呼ばれる関数を登録します。
<span class='linenumber'>1551</span>  *
<span class='linenumber'>1552</span>  * @param function/function array fn - コールバック関数を指定します。関数の配列も指定可能です。
<span class='linenumber'>1553</span>  * @see uu.dom.ready - domが使用可能になると呼ばれる関数を登録
<span class='linenumber'>1554</span>  * @see uu.dom.already - dom使用可能でtrue
<span class='linenumber'>1555</span>  * @see uu.canvas.already - canvas使用可能でtrue
<span class='linenumber'>1556</span>  * @see uu.window.ready - windowが使用可能になると呼ばれる関数を登録
<span class='linenumber'>1557</span>  * @see uu.window.already - window使用可能でtrue
<span class='linenumber'>1558</span>  * @see uu.window.unready - windowが使用不能になると呼ばれる関数を登録
<span class='linenumber'>1559</span>  * @see uu.window.unalready - window使用不能でtrue
<span class='linenumber'>1560</span>  */</span><span class="WHIT">
<span class='linenumber'>1561</span> </span><span class="NAME">uu.canvas.ready</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">fn</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>1562</span> </span><span class="WHIT">  </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">uu.ua.ie</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="COMM">// environment check</span><span class="WHIT">
<span class='linenumber'>1563</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">uud.getElementById</span><span class="PUNC">(</span><span class="STRN">"excanvas.js"</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="COMM">// need &lt;script id="excanvas.js" src="excanvas.js">&lt;/script></span><span class="WHIT">
<span class='linenumber'>1564</span> </span><span class="WHIT">      </span><span class="KEYW">throw</span><span class="WHIT"> </span><span class="NAME">Error</span><span class="PUNC">(</span><span class="STRN">'ERR-02: &lt;script id="excanvas.js" src="{{path}}/excanvas.js"> not exist'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1565</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>1566</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>1567</span> </span><span class="WHIT">  </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">judge</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>1568</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">uu.toArray</span><span class="PUNC">(</span><span class="NAME">uu.tag</span><span class="PUNC">(</span><span class="STRN">"canvas"</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">every</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">v</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">uu.isF</span><span class="PUNC">(</span><span class="NAME">v.getContext</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1569</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>1570</span> </span><span class="WHIT">  </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">e</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">arguments.callee</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1571</span> </span><span class="WHIT">  </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">e._run</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>1572</span> </span><span class="WHIT">    </span><span class="PUNC">(</span><span class="NAME">uu.isA</span><span class="PUNC">(</span><span class="NAME">fn</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">fn</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">fn</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">forEach</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">v</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">v</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1573</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>1574</span> </span><span class="WHIT">    </span><span class="NAME">e._stock</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">e._stock.concat</span><span class="PUNC">(</span><span class="NAME">fn</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1575</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">uu.ua.gecko</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">uu.ua.webkit</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>1576</span> </span><span class="WHIT">      </span><span class="NAME">e._impl</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1577</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">uu.ua.opera</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="COMM">// Opera9.5xからcanvasの初期化タイミングが不安定になったため</span><span class="WHIT">
<span class='linenumber'>1578</span> </span><span class="WHIT">      </span><span class="NAME">uuw.setTimeout</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>1579</span> </span><span class="WHIT">        </span><span class="NAME">judge</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">e._impl</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">uuw.setTimeout</span><span class="PUNC">(</span><span class="NAME">arguments.callee</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">100</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// 100ms</span><span class="WHIT">
<span class='linenumber'>1580</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1581</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">uu.ua.ie</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>1582</span> </span><span class="WHIT">      </span><span class="NAME">uu.window.ready</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>1583</span> </span><span class="WHIT">        </span><span class="NAME">uuw.setTimeout</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>1584</span> </span><span class="WHIT">          </span><span class="NAME">judge</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">e._impl</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">uuw.setTimeout</span><span class="PUNC">(</span><span class="NAME">arguments.callee</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">100</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// 100ms</span><span class="WHIT">
<span class='linenumber'>1585</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1586</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1587</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>1588</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>1589</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1590</span> </span><span class="NAME">uu.canvas.ready._run</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// uu.canvas.ready()実行回数</span><span class="WHIT">
<span class='linenumber'>1591</span> </span><span class="NAME">uu.canvas.ready._stock</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// uu.canvas.ready()用イベントコンテナ</span><span class="WHIT">
<span class='linenumber'>1592</span> </span><span class="NAME">uu.canvas.ready._impl</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="COMM">// uu.canvas.ready()の実処理部</span><span class="WHIT">
<span class='linenumber'>1593</span> </span><span class="WHIT">  </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">e</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">uu.canvas.ready</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1594</span> </span><span class="WHIT">  </span><span class="PUNC">!</span><span class="NAME">e._run</span><span class="PUNC">++</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">e._stock.forEach</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">v</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">v</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">e._stock</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// gc</span><span class="WHIT">
<span class='linenumber'>1595</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1596</span> 
<span class='linenumber'>1597</span> </span><span class="COMM">////////////////////////////////////////////////////////////</span><span class="WHIT">
<span class='linenumber'>1598</span> </span><span class="COMM">/** &lt;b>Ajax&lt;/b>
<span class='linenumber'>1599</span>  *
<span class='linenumber'>1600</span>  * @class
<span class='linenumber'>1601</span>  */</span><span class="WHIT">
<span class='linenumber'>1602</span> </span><span class="NAME">uu.ajax</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>1603</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1604</span> 
<span class='linenumber'>1605</span> </span><span class="COMM">/** &lt;b>uu.ajax.already - Ajax使用可能でtrue&lt;/b>
<span class='linenumber'>1606</span>  *
<span class='linenumber'>1607</span>  * @return bool Ajax使用可能でtrueを返します。
<span class='linenumber'>1608</span>  */</span><span class="WHIT">
<span class='linenumber'>1609</span> </span><span class="NAME">uu.ajax.already</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>1610</span> </span><span class="WHIT">  </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">uuw.XMLHttpRequest</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">uuw.ActiveXObject</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1611</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1612</span> 
<span class='linenumber'>1613</span> </span><span class="COMM">/** &lt;b>uu.ajax.load - 非同期ロード[Ajax async request]&lt;/b>
<span class='linenumber'>1614</span>  *
<span class='linenumber'>1615</span>  * Ajaxで非同期にデータを取得します。
<span class='linenumber'>1616</span>  *
<span class='linenumber'>1617</span>  *  &lt;table>
<span class='linenumber'>1618</span>  *  &lt;tr>&lt;th>step番号&lt;/th>&lt;th>内容&lt;/th>&lt;/tr>
<span class='linenumber'>1619</span>  *  &lt;tr>&lt;td>0&lt;/td>&lt;td>BEGIN: 処理開始     &lt;/td>&lt;/tr>
<span class='linenumber'>1620</span>  *  &lt;tr>&lt;td>1&lt;/td>&lt;td>SEND: リクエスト開始&lt;/td>&lt;/tr>
<span class='linenumber'>1621</span>  *  &lt;tr>&lt;td>2&lt;/td>&lt;td>OK: 成功            &lt;/td>&lt;/tr>
<span class='linenumber'>1622</span>  *  &lt;tr>&lt;td>3&lt;/td>&lt;td>NG: 失敗            &lt;/td>&lt;/tr>
<span class='linenumber'>1623</span>  *  &lt;tr>&lt;td>4&lt;/td>&lt;td>END: 処理終了       &lt;/td>&lt;/tr>
<span class='linenumber'>1624</span>  *  &lt;/table>
<span class='linenumber'>1625</span>  *
<span class='linenumber'>1626</span>  * 各ステップで、fn(step番号, response, status, url, async)を呼び出します。&lt;br />
<span class='linenumber'>1627</span>  * responseには空文字列またはレスポンス文字列が格納されます(OKのみ)。&lt;br />
<span class='linenumber'>1628</span>  * statusには0またはステータスコードが格納されます(OKとNGのみ)。&lt;br />
<span class='linenumber'>1629</span>  * asyncは常にtrueになります。&lt;br />
<span class='linenumber'>1630</span>  *
<span class='linenumber'>1631</span>  * @param string   url    - リクエストURLを指定します。
<span class='linenumber'>1632</span>  * @param function [fn]   - リクエスト終了で呼び出す関数を指定します。デフォルトはundefinedです。
<span class='linenumber'>1633</span>  * @param string   [data] - encodeURIComponent済みの key = value のペアを渡します。
<span class='linenumber'>1634</span>  *                          dataに文字列を指定するとpostメソッドを使用します。デフォルトはnullです。
<span class='linenumber'>1635</span>  * @see &lt;a href="#.timeout">uu.ajax.timeout&lt;/a> - タイムアウト時間の指定
<span class='linenumber'>1636</span>  * @see &lt;a href="#.already">uu.ajax.already&lt;/a> - Ajax使用可能でtrue
<span class='linenumber'>1637</span>  * @see &lt;a href="#.loadIfMod">uu.ajax.loadIfMod&lt;/a> - 更新チェック付き非同期ロード
<span class='linenumber'>1638</span>  * @see &lt;a href="#.load">uu.ajax.load&lt;/a> - 非同期ロード
<span class='linenumber'>1639</span>  * @see &lt;a href="#.loadSync">uu.ajax.loadSync&lt;/a> - 同期ロード
<span class='linenumber'>1640</span>  */</span><span class="WHIT">
<span class='linenumber'>1641</span> </span><span class="NAME">uu.ajax.load</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">url</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">fn</span><span class="WHIT"> </span><span class="COMM">/* = undefined */</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">data</span><span class="WHIT"> </span><span class="COMM">/* = null */</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>1642</span> </span><span class="WHIT">  </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">url</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">throw</span><span class="WHIT"> </span><span class="NAME">TypeError</span><span class="PUNC">(</span><span class="STRN">"uu.ajax.load(url)"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>1643</span> </span><span class="WHIT">  </span><span class="NAME">uu.ajax.load._impl</span><span class="PUNC">(</span><span class="NAME">url</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">fn</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">uu.mute</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">data</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1644</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1645</span> 
<span class='linenumber'>1646</span> </span><span class="COMM">/** &lt;b>uu.ajax.loadIfMod - 更新チェック付き非同期ロード[Ajax async request with new-arrival check]&lt;/b>
<span class='linenumber'>1647</span>  *
<span class='linenumber'>1648</span>  * Ajaxで非同期にデータを取得します。&lt;br />
<span class='linenumber'>1649</span>  * loadIfMod()は、POSTメソッドが使用できません。&lt;br />
<span class='linenumber'>1650</span>  *
<span class='linenumber'>1651</span>  *  &lt;table>
<span class='linenumber'>1652</span>  *  &lt;tr>&lt;th>step番号&lt;/th>&lt;th>内容&lt;/th>&lt;/tr>
<span class='linenumber'>1653</span>  *  &lt;tr>&lt;td>0&lt;/td>&lt;td>BEGIN: 処理開始     &lt;/td>&lt;/tr>
<span class='linenumber'>1654</span>  *  &lt;tr>&lt;td>1&lt;/td>&lt;td>SEND: リクエスト開始&lt;/td>&lt;/tr>
<span class='linenumber'>1655</span>  *  &lt;tr>&lt;td>2&lt;/td>&lt;td>OK: 成功            &lt;/td>&lt;/tr>
<span class='linenumber'>1656</span>  *  &lt;tr>&lt;td>3&lt;/td>&lt;td>NG: 失敗            &lt;/td>&lt;/tr>
<span class='linenumber'>1657</span>  *  &lt;tr>&lt;td>4&lt;/td>&lt;td>END: 処理終了       &lt;/td>&lt;/tr>
<span class='linenumber'>1658</span>  *  &lt;/table>
<span class='linenumber'>1659</span>  *
<span class='linenumber'>1660</span>  * 各ステップで、fn(ユニークID, step番号, response, status, url, async)を呼び出します。&lt;br />
<span class='linenumber'>1661</span>  * responseには空文字列またはレスポンス文字列が格納されます(OKのみ)。&lt;br />
<span class='linenumber'>1662</span>  * statusには0またはステータスコードが格納されます(OKとNGのみ)。&lt;br />
<span class='linenumber'>1663</span>  * asyncは常にtrueになります。&lt;br />
<span class='linenumber'>1664</span>  * 過去に同じURLをリクエストしており、サーバ上のファイルが未更新ならfn(NG, "", 304, url, true)を返します。&lt;br />
<span class='linenumber'>1665</span>  *
<span class='linenumber'>1666</span>  * @param string   url - リクエストURLを指定します。
<span class='linenumber'>1667</span>  * @param function [fn] - 各stepで呼び出す関数を指定します。デフォルトはundefinedです。
<span class='linenumber'>1668</span>  * @see &lt;a href="#.timeout">uu.ajax.timeout&lt;/a> - タイムアウト時間の指定
<span class='linenumber'>1669</span>  * @see &lt;a href="#.already">uu.ajax.already&lt;/a> - Ajax使用可能でtrue
<span class='linenumber'>1670</span>  * @see &lt;a href="#.loadIfMod">uu.ajax.loadIfMod&lt;/a> - 更新チェック付き非同期ロード
<span class='linenumber'>1671</span>  * @see &lt;a href="#.load">uu.ajax.load&lt;/a> - 非同期ロード
<span class='linenumber'>1672</span>  * @see &lt;a href="#.loadSync">uu.ajax.loadSync&lt;/a> - 同期ロード
<span class='linenumber'>1673</span>  */</span><span class="WHIT">
<span class='linenumber'>1674</span> </span><span class="NAME">uu.ajax.loadIfMod</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">url</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">fn</span><span class="WHIT"> </span><span class="COMM">/* = undefined */</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>1675</span> </span><span class="WHIT">  </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">url</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">throw</span><span class="WHIT"> </span><span class="NAME">TypeError</span><span class="PUNC">(</span><span class="STRN">"uu.ajax.loadIfMod(url)"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>1676</span> </span><span class="WHIT">  </span><span class="NAME">uu.ajax.load._impl</span><span class="PUNC">(</span><span class="NAME">url</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">fn</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">uu.mute</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1677</span> </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>1678</span> 
<span class='linenumber'>1679</span> </span><span class="COMM">/** &lt;b>uu.ajax.loadSync - 同期ロード[Ajax sync request]&lt;/b>
<span class='linenumber'>1680</span>  *
<span class='linenumber'>1681</span>  * Ajaxでデータを取得します。&lt;br />
<span class='linenumber'>1682</span>  * 同期リクエストなのでタイムアウトしません。
<span class='linenumber'>1683</span>  *
<span class='linenumber'>1684</span>  *  &lt;table>
<span class='linenumber'>1685</span>  *  &lt;tr>&lt;th>step番号&lt;/th>&lt;th>内容&lt;/th>&lt;/tr>
<span class='linenumber'>1686</span>  *  &lt;tr>&lt;td>0&lt;/td>&lt;td>BEGIN: 処理開始     &lt;/td>&lt;/tr>
<span class='linenumber'>1687</span>  *  &lt;tr>&lt;td>1&lt;/td>&lt;td>SEND: リクエスト開始&lt;/td>&lt;/tr>
<span class='linenumber'>1688</span>  *  &lt;tr>&lt;td>2&lt;/td>&lt;td>OK: 成功            &lt;/td>&lt;/tr>
<span class='linenumber'>1689</span>  *  &lt;tr>&lt;td>3&lt;/td>&lt;td>NG: 失敗            &lt;/td>&lt;/tr>
<span class='linenumber'>1690</span>  *  &lt;tr>&lt;td>4&lt;/td>&lt;td>END: 処理終了       &lt;/td>&lt;/tr>
<span class='linenumber'>1691</span>  *  &lt;/table>
<span class='linenumber'>1692</span>  *
<span class='linenumber'>1693</span>  * 各ステップで、fn(ユニークID, step番号, response, status, url, async)を呼び出します。&lt;br />
<span class='linenumber'>1694</span>  * responseには空文字列またはレスポンス文字列が格納されます(OKのみ)。&lt;br />
<span class='linenumber'>1695</span>  * statusには0またはステータスコードが格納されます(OKとNGのみ)。&lt;br />
<span class='linenumber'>1696</span>  * asyncは常にfalseになります。&lt;br />
<span class='linenumber'>1697</span>  *
<span class='linenumber'>1698</span>  * @param string   url    - リクエストURLを指定します。
<span class='linenumber'>1699</span>  * @param function [fn]   - リクエスト終了で呼び出す関数を指定します。デフォルトはundefinedです。
<span class='linenumber'>1700</span>  * @param string   [data] - encodeURIComponent済みの key = value のペアを渡します。
<span class='linenumber'>1701</span>  *                          dataに文字列を指定するとpostメソッドを使用します。デフォルトはnullです。
<span class='linenumber'>1702</span>  * @see &lt;a href="#.already">uu.ajax.already&lt;/a> - Ajax使用可能でtrue
<span class='linenumber'>1703</span>  * @see &lt;a href="#.loadIfMod">uu.ajax.loadIfMod&lt;/a> - 更新チェック付き非同期ロード
<span class='linenumber'>1704</span>  * @see &lt;a href="#.load">uu.ajax.load&lt;/a> - 非同期ロード
<span class='linenumber'>1705</span>  * @see &lt;a href="#.loadSync">uu.ajax.loadSync&lt;/a> - 同期ロード
<span class='linenumber'>1706</span>  */</span><span class="WHIT">
<span class='linenumber'>1707</span> </span><span class="NAME">uu.ajax.loadSync</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">url</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">fn</span><span class="WHIT"> </span><span class="COMM">/* = undefined */</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">data</span><span class="WHIT"> </span><span class="COMM">/* = null */</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>1708</span> </span><span class="WHIT">  </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">url</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">throw</span><span class="WHIT"> </span><span class="NAME">TypeError</span><span class="PUNC">(</span><span class="STRN">"uu.ajax.loadSync(url)"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>1709</span> </span><span class="WHIT">  </span><span class="NAME">fn</span><span class="WHIT">   </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">fn</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">uu.mute</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1710</span> </span><span class="WHIT">  </span><span class="NAME">data</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">data</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1711</span> </span><span class="WHIT">  </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">me</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">uu.ajax.load</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">uid</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">uu.uniqueID</span><span class="PUNC">(</span><span class="STRN">"ajax"</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>1712</span> </span><span class="WHIT">      </span><span class="NAME">xhr</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">uuw.XMLHttpRequest</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">XMLHttpRequest</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT">
<span class='linenumber'>1713</span> </span><span class="WHIT">          </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">uuw.ActiveXObject</span><span class="WHIT">  </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">ActiveXObject</span><span class="PUNC">(</span><span class="STRN">'Microsoft.XMLHTTP'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1714</span> </span><span class="WHIT">  </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">H</span><span class="PUNC">(</span><span class="NAME">v</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">k</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="STRN">"setRequestHeader"</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">xhr</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">xhr.setRequestHeader</span><span class="PUNC">(</span><span class="NAME">k</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">v</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="COMM">// Opera8にはsetRequestHeader()メソッドが無い</span><span class="WHIT">
<span class='linenumber'>1715</span> 
<span class='linenumber'>1716</span> </span><span class="WHIT">  </span><span class="COMM">// 400 "Bad Request"</span><span class="WHIT">
<span class='linenumber'>1717</span> </span><span class="WHIT">  </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">xhr</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">fn</span><span class="PUNC">(</span><span class="NAME">uid</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">3</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">400</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">url</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">fn</span><span class="PUNC">(</span><span class="NAME">uid</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">4</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">url</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>1718</span> 
<span class='linenumber'>1719</span> </span><span class="WHIT">  </span><span class="NAME">fn</span><span class="PUNC">(</span><span class="NAME">uid</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">url</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1720</span> </span><span class="WHIT">  </span><span class="KEYW">try</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>1721</span> </span><span class="WHIT">    </span><span class="NAME">xhr.open</span><span class="PUNC">(</span><span class="NAME">data</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="STRN">"POST"</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">"GET"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">url.replace</span><span class="PUNC">(</span><span class="REGX">/&amp;/</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"&"</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// false = Sync</span><span class="WHIT">
<span class='linenumber'>1722</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">catch</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>1723</span> </span><span class="WHIT">    </span><span class="NAME">fn</span><span class="PUNC">(</span><span class="NAME">uid</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">3</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">400</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">url</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// 400 "Bad Request"</span><span class="WHIT">
<span class='linenumber'>1724</span> </span><span class="WHIT">    </span><span class="NAME">fn</span><span class="PUNC">(</span><span class="NAME">uid</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">4</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">url</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1725</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>1726</span> </span><span class="WHIT">  </span><span class="NAME">uu.forEach</span><span class="PUNC">(</span><span class="NAME">me.header</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">H</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1727</span> </span><span class="WHIT">  </span><span class="NAME">data</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">H</span><span class="PUNC">(</span><span class="STRN">"application/x-www-form-urlencoded"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"Content-Type"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1728</span> </span><span class="WHIT">  </span><span class="NAME">fn</span><span class="PUNC">(</span><span class="NAME">uid</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">url</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1729</span> </span><span class="WHIT">  </span><span class="NAME">xhr.send</span><span class="PUNC">(</span><span class="NAME">data</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1730</span> </span><span class="WHIT">  </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">xhr.status</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">200</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">fn</span><span class="PUNC">(</span><span class="NAME">uid</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">xhr.responseText</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">200</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">url</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>1731</span> </span><span class="WHIT">                     </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">fn</span><span class="PUNC">(</span><span class="NAME">uid</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">3</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">xhr.status</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">url</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>1732</span> </span><span class="WHIT">  </span><span class="NAME">fn</span><span class="PUNC">(</span><span class="NAME">uid</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">4</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">url</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1733</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1734</span> 
<span class='linenumber'>1735</span> </span><span class="COMM">/** &lt;b>uu.ajax.timeout - タイムアウト時間&lt;/b>
<span class='linenumber'>1736</span>  * uu.ajax.load()で使用するタイムアウト時間を指定します。
<span class='linenumber'>1737</span>  * 0以上の数値を指定します。単位はmsです。0を指定するとタイムアウトしません。
<span class='linenumber'>1738</span>  * デフォルトは0です。
<span class='linenumber'>1739</span>  *
<span class='linenumber'>1740</span>  * @type number
<span class='linenumber'>1741</span>  * @see &lt;a href="#.load">uu.ajax.load&lt;/a> - 非同期ロード
<span class='linenumber'>1742</span>  */</span><span class="WHIT">
<span class='linenumber'>1743</span> </span><span class="NAME">uu.ajax.load.timeout</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// 0ms</span><span class="WHIT">
<span class='linenumber'>1744</span> 
<span class='linenumber'>1745</span> </span><span class="COMM">/** &lt;b>uu.ajax.header - デフォルトヘッダ&lt;/b>
<span class='linenumber'>1746</span>  *
<span class='linenumber'>1747</span>  * リクエスト時に毎回送信するヘッダを指定します。
<span class='linenumber'>1748</span>  * デフォルトは、{ "X-Requested-With": "XMLHttpRequest" } です。
<span class='linenumber'>1749</span>  * 
<span class='linenumber'>1750</span>  * @type hash
<span class='linenumber'>1751</span>  * @see &lt;a href="#.load">uu.ajax.load&lt;/a> - 非同期ロード
<span class='linenumber'>1752</span>  * @see &lt;a href="#.loadIfMod">uu.ajax.loadIfMod&lt;/a> - 更新チェック付き非同期ロード
<span class='linenumber'>1753</span>  * @see &lt;a href="#.loadSync">uu.ajax.loadSync&lt;/a> - 同期ロード
<span class='linenumber'>1754</span>  */</span><span class="WHIT">
<span class='linenumber'>1755</span> </span><span class="NAME">uu.ajax.load.header</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="STRN">"X-Requested-With"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">"XMLHttpRequest"</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1756</span> 
<span class='linenumber'>1757</span> </span><span class="COMM">/** 非同期ロード */</span><span class="WHIT">
<span class='linenumber'>1758</span> </span><span class="NAME">uu.ajax.load._impl</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">url</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">fn</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">data</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">neo</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>1759</span> </span><span class="WHIT">  </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">me</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">uu.ajax.load</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">uid</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">uu.uniqueID</span><span class="PUNC">(</span><span class="STRN">"ajax"</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>1760</span> </span><span class="WHIT">      </span><span class="NAME">xhr</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">uuw.XMLHttpRequest</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">XMLHttpRequest</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT">
<span class='linenumber'>1761</span> </span><span class="WHIT">          </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">uuw.ActiveXObject</span><span class="WHIT">  </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">ActiveXObject</span><span class="PUNC">(</span><span class="STRN">'Microsoft.XMLHTTP'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1762</span> </span><span class="WHIT">  </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">H</span><span class="PUNC">(</span><span class="NAME">v</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">k</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="STRN">"setRequestHeader"</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">xhr</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">xhr.setRequestHeader</span><span class="PUNC">(</span><span class="NAME">k</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">v</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="COMM">// Opera8にはsetRequestHeader()メソッドが無い</span><span class="WHIT">
<span class='linenumber'>1763</span> 
<span class='linenumber'>1764</span> </span><span class="WHIT">  </span><span class="COMM">// 400 "Bad Request"</span><span class="WHIT">
<span class='linenumber'>1765</span> </span><span class="WHIT">  </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">xhr</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">fn</span><span class="PUNC">(</span><span class="NAME">uid</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">3</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">400</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">url</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">fn</span><span class="PUNC">(</span><span class="NAME">uid</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">4</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">url</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>1766</span> 
<span class='linenumber'>1767</span> </span><span class="WHIT">  </span><span class="NAME">fn</span><span class="PUNC">(</span><span class="NAME">uid</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">url</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1768</span> </span><span class="WHIT">  </span><span class="NAME">xhr.onreadystatechange</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>1769</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">xhr.readyState</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">4</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>1770</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">xhr.status</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">200</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>1771</span> </span><span class="WHIT">        </span><span class="NAME">fn</span><span class="PUNC">(</span><span class="NAME">uid</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">xhr.responseText</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">200</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">url</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1772</span> </span><span class="WHIT">        </span><span class="PUNC">(</span><span class="NAME">neo</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">me._cache</span><span class="PUNC">[</span><span class="NAME">url</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">me._header</span><span class="PUNC">(</span><span class="NAME">xhr</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"Last-Modified"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">Date.parse</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1773</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>1774</span> </span><span class="WHIT">        </span><span class="NAME">fn</span><span class="PUNC">(</span><span class="NAME">uid</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">3</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">xhr.status</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">url</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// 304 too</span><span class="WHIT">
<span class='linenumber'>1775</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>1776</span> </span><span class="WHIT">      </span><span class="NAME">fn</span><span class="PUNC">(</span><span class="NAME">uid</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">4</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">url</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1777</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>1778</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1779</span> 
<span class='linenumber'>1780</span> </span><span class="WHIT">  </span><span class="KEYW">try</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>1781</span> </span><span class="WHIT">    </span><span class="NAME">xhr.open</span><span class="PUNC">(</span><span class="NAME">data</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="STRN">"POST"</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">"GET"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">url.replace</span><span class="PUNC">(</span><span class="REGX">/&amp;/</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"&"</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// true = Async</span><span class="WHIT">
<span class='linenumber'>1782</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">catch</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>1783</span> </span><span class="WHIT">    </span><span class="NAME">fn</span><span class="PUNC">(</span><span class="NAME">uid</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">3</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">400</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">url</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// 400 "Bad Request"</span><span class="WHIT">
<span class='linenumber'>1784</span> </span><span class="WHIT">    </span><span class="NAME">fn</span><span class="PUNC">(</span><span class="NAME">uid</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">4</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">url</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1785</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>1786</span> </span><span class="WHIT">  </span><span class="NAME">uu.forEach</span><span class="PUNC">(</span><span class="NAME">me.header</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">H</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1787</span> </span><span class="WHIT">  </span><span class="PUNC">(</span><span class="NAME">neo</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">url</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">me._cache</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">H</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Date</span><span class="PUNC">(</span><span class="NAME">me._cache</span><span class="PUNC">[</span><span class="NAME">url</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">toRFC1123String</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"If-Modified-Since"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1788</span> </span><span class="WHIT">  </span><span class="NAME">data</span><span class="WHIT">                      </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">H</span><span class="PUNC">(</span><span class="STRN">"application/x-www-form-urlencoded"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"Content-Type"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1789</span> </span><span class="WHIT">  </span><span class="NAME">fn</span><span class="PUNC">(</span><span class="NAME">uid</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">url</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1790</span> </span><span class="WHIT">  </span><span class="NAME">xhr.send</span><span class="PUNC">(</span><span class="NAME">data</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1791</span> </span><span class="WHIT">  </span><span class="COMM">// 408 "Request Time-out"</span><span class="WHIT">
<span class='linenumber'>1792</span> </span><span class="WHIT">  </span><span class="NAME">me.timeout</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">uu.tm10.set</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>1793</span> </span><span class="WHIT">    </span><span class="NAME">xhr.abort</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1794</span> </span><span class="WHIT">    </span><span class="NAME">fn</span><span class="PUNC">(</span><span class="NAME">uid</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">3</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">408</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">url</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1795</span> </span><span class="WHIT">    </span><span class="NAME">fn</span><span class="PUNC">(</span><span class="NAME">uid</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">4</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">url</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1796</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">me.timeout</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1797</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1798</span> 
<span class='linenumber'>1799</span> </span><span class="NAME">uu.ajax.load._cache</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// If-Modified-Since用URLキャッシュ</span><span class="WHIT">
<span class='linenumber'>1800</span> 
<span class='linenumber'>1801</span> </span><span class="COMM">/** &lt;b>uu.ajax.load._header - get response header&lt;/b>
<span class='linenumber'>1802</span>  *
<span class='linenumber'>1803</span>  * @param XMLHttpRequest  xhr  - XMLHttpRequestオブジェクトを指定します。
<span class='linenumber'>1804</span>  * @param string          name - 検索するヘッダ文字列を指定します。
<span class='linenumber'>1805</span>  * @param function        [fn] - 検索結果に適用するトランスフォーム関数を指定します。
<span class='linenumber'>1806</span>  *                               デフォルトはundefinedです。
<span class='linenumber'>1807</span>  * @return string/mix          - 検索成功で文字列を返します。
<span class='linenumber'>1808</span>  *                               fnが指定されている場合はfn(検索結果)を返します。
<span class='linenumber'>1809</span>  *                               検索失敗で空文字列を返します。
<span class='linenumber'>1810</span>  */</span><span class="WHIT">
<span class='linenumber'>1811</span> </span><span class="NAME">uu.ajax.load._header</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">xhr</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">name</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">fn</span><span class="WHIT"> </span><span class="COMM">/* = undefined */</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>1812</span> </span><span class="WHIT">  </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">rv</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1813</span> </span><span class="WHIT">  </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">xhr.getAllResponseHeaders</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">match</span><span class="PUNC">(</span><span class="NAME">name</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>1814</span> </span><span class="WHIT">    </span><span class="NAME">rv</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">xhr.getResponseHeader</span><span class="PUNC">(</span><span class="NAME">name</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1815</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">rv</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">uu.isF</span><span class="PUNC">(</span><span class="NAME">fn</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">rv</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">fn</span><span class="PUNC">(</span><span class="NAME">rv</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>1816</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>1817</span> </span><span class="WHIT">  </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">rv</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1818</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1819</span> 
<span class='linenumber'>1820</span> </span><span class="COMM">////////////////////////////////////////////////////////////</span><span class="WHIT">
<span class='linenumber'>1821</span> </span><span class="COMM">/** &lt;b>JSON&lt;/b>
<span class='linenumber'>1822</span>  *
<span class='linenumber'>1823</span>  * @class
<span class='linenumber'>1824</span>  */</span><span class="WHIT">
<span class='linenumber'>1825</span> </span><span class="NAME">uu.json</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>1826</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1827</span> 
<span class='linenumber'>1828</span> </span><span class="COMM">/** &lt;b>uu.json.already - JSONPが使用可能でtrue&lt;/b>
<span class='linenumber'>1829</span>  *
<span class='linenumber'>1830</span>  * @return bool JSONPが使用可能でtrueを返します。
<span class='linenumber'>1831</span>  */</span><span class="WHIT">
<span class='linenumber'>1832</span> </span><span class="NAME">uu.json.already</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>1833</span> </span><span class="WHIT">  </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1834</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1835</span> 
<span class='linenumber'>1836</span> </span><span class="COMM">/** &lt;b>uu.json.load - 非同期ロード[JSONP async request]&lt;/b>
<span class='linenumber'>1837</span>  *
<span class='linenumber'>1838</span>  * JSONPで非同期にデータを取得します。
<span class='linenumber'>1839</span>  *
<span class='linenumber'>1840</span>  * 自動的にコールバック関数(uu.json._cache._{uid})が定義され、この関数名でラップされたJSONデータがサーバから返却されます。&lt;br />
<span class='linenumber'>1841</span>  * ロード完了から60秒後にリクエストに使用したリソースを開放します。&lt;br />&lt;br />
<span class='linenumber'>1842</span>  *
<span class='linenumber'>1843</span>  *  &lt;table>
<span class='linenumber'>1844</span>  *  &lt;tr>&lt;th>step番号&lt;/th>&lt;th>内容&lt;/th>&lt;/tr>
<span class='linenumber'>1845</span>  *  &lt;tr>&lt;td>0&lt;/td>&lt;td>BEGIN: 処理開始     &lt;/td>&lt;/tr>
<span class='linenumber'>1846</span>  *  &lt;tr>&lt;td>1&lt;/td>&lt;td>SEND: リクエスト開始&lt;/td>&lt;/tr>
<span class='linenumber'>1847</span>  *  &lt;tr>&lt;td>2&lt;/td>&lt;td>OK: 成功            &lt;/td>&lt;/tr>
<span class='linenumber'>1848</span>  *  &lt;tr>&lt;td>3&lt;/td>&lt;td>NG: 失敗            &lt;/td>&lt;/tr>
<span class='linenumber'>1849</span>  *  &lt;tr>&lt;td>4&lt;/td>&lt;td>END: 処理終了       &lt;/td>&lt;/tr>
<span class='linenumber'>1850</span>  *  &lt;/table>
<span class='linenumber'>1851</span>  *
<span class='linenumber'>1852</span>  * 各ステップで、fn(ユニークID, step番号, response, status, url, async)を呼び出します。&lt;br />
<span class='linenumber'>1853</span>  * responseには空文字列またはレスポンス文字列が格納されます(OKのみ)。&lt;br />
<span class='linenumber'>1854</span>  * statusには0またはステータスコードが格納されます(OKとNGのみ)。&lt;br />
<span class='linenumber'>1855</span>  * asyncは常にtrueになります。
<span class='linenumber'>1856</span>  *
<span class='linenumber'>1857</span>  * @param string   url  - リクエストURLを指定します。
<span class='linenumber'>1858</span>  * @param function [fn] - 各stepで呼び出す関数を指定します。デフォルトはundefinedです。
<span class='linenumber'>1859</span>  * @see uu.json.already - Ajax使用可能でtrue
<span class='linenumber'>1860</span>  * @see uu.json.timeout - タイムアウト時間の指定
<span class='linenumber'>1861</span>  */</span><span class="WHIT">
<span class='linenumber'>1862</span> </span><span class="NAME">uu.json.load</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">url</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">fn</span><span class="WHIT"> </span><span class="COMM">/* = undefined */</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>1863</span> </span><span class="WHIT">  </span><span class="NAME">fn</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">fn</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">uu.mute</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1864</span> </span><span class="WHIT">  </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">me</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">uu.json.load</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">uid</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">uu.uniqueID</span><span class="PUNC">(</span><span class="STRN">"jsonp"</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>1865</span> </span><span class="WHIT">      </span><span class="NAME">node</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">rurl</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">uu.url.query.add</span><span class="PUNC">(</span><span class="NAME">url</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">me.callbackFunctionName</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"uu.json.load._cache."</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">uid</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1866</span> </span><span class="WHIT">  </span><span class="NAME">fn</span><span class="PUNC">(</span><span class="NAME">uid</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">url</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// begin</span><span class="WHIT">
<span class='linenumber'>1867</span> 
<span class='linenumber'>1868</span> </span><span class="WHIT">  </span><span class="NAME">uud.head.appendChild</span><span class="PUNC">(</span><span class="NAME">node</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">uu.js.create</span><span class="PUNC">(</span><span class="NAME">uid</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1869</span> </span><span class="WHIT">  </span><span class="NAME">node._run</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1870</span> 
<span class='linenumber'>1871</span> </span><span class="WHIT">  </span><span class="NAME">me._cache</span><span class="PUNC">[</span><span class="NAME">uid</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">json</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">state</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>1872</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">suicide</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>1873</span> </span><span class="WHIT">      </span><span class="NAME">uud.head.removeChild</span><span class="PUNC">(</span><span class="NAME">node</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1874</span> </span><span class="WHIT">      </span><span class="NAME">node.src</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1875</span> </span><span class="WHIT">      </span><span class="KEYW">delete</span><span class="WHIT"> </span><span class="NAME">me._cache</span><span class="PUNC">[</span><span class="NAME">uid</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1876</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>1877</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">node._run</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>1878</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">json</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">fn</span><span class="PUNC">(</span><span class="NAME">uid</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">json</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">200</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">url</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="COMM">// 200 OK</span><span class="WHIT">
<span class='linenumber'>1879</span> </span><span class="WHIT">         </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">fn</span><span class="PUNC">(</span><span class="NAME">uid</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">3</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">,</span><span class="WHIT">   </span><span class="NUMB">404</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">url</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="COMM">// 404 "Not Found", 実際には他のエラーかもしれないが知る手段がない</span><span class="WHIT">
<span class='linenumber'>1880</span> </span><span class="WHIT">    </span><span class="NAME">uu.delay</span><span class="PUNC">(</span><span class="NAME">suicide</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">me._suicide</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// suicide</span><span class="WHIT">
<span class='linenumber'>1881</span> </span><span class="WHIT">    </span><span class="NAME">fn</span><span class="PUNC">(</span><span class="NAME">uid</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">4</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">url</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1882</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1883</span> </span><span class="WHIT">  </span><span class="NAME">fn</span><span class="PUNC">(</span><span class="NAME">uid</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">url</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1884</span> </span><span class="WHIT">  </span><span class="NAME">node.src</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">rurl</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1885</span> 
<span class='linenumber'>1886</span> </span><span class="WHIT">  </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">me.timeout</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>1887</span> </span><span class="WHIT">    </span><span class="NAME">uu.delay</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>1888</span> </span><span class="WHIT">      </span><span class="NAME">me._cache</span><span class="PUNC">[</span><span class="NAME">uid</span><span class="PUNC">]</span><span class="PUNC">(</span><span class="STRN">""</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">408</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// 408 "Request Time-out"</span><span class="WHIT">
<span class='linenumber'>1889</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">me.timeout</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1890</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>1891</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1892</span> 
<span class='linenumber'>1893</span> </span><span class="COMM">/** &lt;b>uu.json.encode - JSONエンコード(JSON encode)&lt;/b>
<span class='linenumber'>1894</span>  *
<span class='linenumber'>1895</span>  * @param hash/mix  mix   jsonエンコードする要素を指定します。
<span class='linenumber'>1896</span>  * @return string         jsonエンコード済みの文字列を返します。
<span class='linenumber'>1897</span>  * @throws TypeError "bad data" 無効なデータ(JSONフォーマットに変換不能)
<span class='linenumber'>1898</span>  * @see &lt;a href="#.decode">uu.json.decode&lt;/a> - JSONデコード
<span class='linenumber'>1899</span>  */</span><span class="WHIT">
<span class='linenumber'>1900</span> </span><span class="NAME">uu.json.encode</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">mix</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>1901</span> </span><span class="WHIT">  </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">rv</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">re</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="REGX">/[\\"\x00-\x1F\u0080-\uFFFF]/g</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>1902</span> </span><span class="WHIT">      </span><span class="NAME">esc</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="STRN">"\b"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">"\\b"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"\t"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">"\\t"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"\n"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">"\\n"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"\f"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">"\\f"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"\r"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">"\\r"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'"'</span><span class="PUNC">:</span><span class="WHIT">  </span><span class="STRN">'\\"'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"\\"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">"\\\\"</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1903</span> </span><span class="WHIT">  </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">isFake</span><span class="PUNC">(</span><span class="NAME">mix</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">mix</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">"object"</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="STRN">"length"</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">mix</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="COMM">// FakeArray</span><span class="WHIT">
<span class='linenumber'>1904</span> </span><span class="WHIT">  </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">U</span><span class="PUNC">(</span><span class="NAME">v</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">v</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">esc</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">esc</span><span class="PUNC">[</span><span class="NAME">v</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>1905</span> </span><span class="WHIT">                  </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="STRN">"\\u"</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="STRN">"0000"</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">v.charCodeAt</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">toString</span><span class="PUNC">(</span><span class="NUMB">16</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">slice</span><span class="PUNC">(</span><span class="PUNC">-</span><span class="NUMB">4</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>1906</span> </span><span class="WHIT">  </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">F</span><span class="PUNC">(</span><span class="NAME">mix</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>1907</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">z</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">rv.length</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">sz</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1908</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">mix</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT">                     </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">rv</span><span class="PUNC">[</span><span class="NAME">z</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"null"</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>1909</span> </span><span class="WHIT">    </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">uu.isB</span><span class="PUNC">(</span><span class="NAME">mix</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">uu.isN</span><span class="PUNC">(</span><span class="NAME">mix</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT">  </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">rv</span><span class="PUNC">[</span><span class="NAME">z</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">mix.toString</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>1910</span> </span><span class="WHIT">    </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">uu.isS</span><span class="PUNC">(</span><span class="NAME">mix</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT">                 </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">rv</span><span class="PUNC">[</span><span class="NAME">z</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'"'</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">mix.replace</span><span class="PUNC">(</span><span class="NAME">re</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">U</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">'"'</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>1911</span> </span><span class="WHIT">    </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">uu.isA</span><span class="PUNC">(</span><span class="NAME">mix</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">isFake</span><span class="PUNC">(</span><span class="NAME">mix</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT">  </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">rv</span><span class="PUNC">[</span><span class="NAME">z</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"["</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1912</span> </span><span class="WHIT">                                            </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">sz</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">mix.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">sz</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">++</span><span class="NAME">i</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">F</span><span class="PUNC">(</span><span class="NAME">mix</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1913</span> </span><span class="WHIT">                                                                                 </span><span class="NAME">rv</span><span class="PUNC">[</span><span class="NAME">rv.length</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">","</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>1914</span> </span><span class="WHIT">                                            </span><span class="NAME">rv</span><span class="PUNC">[</span><span class="NAME">rv.length</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"]"</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>1915</span> </span><span class="WHIT">    </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">mix</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">"object"</span><span class="PUNC">)</span><span class="WHIT">     </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">rv</span><span class="PUNC">[</span><span class="NAME">z</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"{"</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1916</span> </span><span class="WHIT">                                            </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">i</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">mix</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">rv</span><span class="PUNC">[</span><span class="NAME">rv.length</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'"'</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">i.replace</span><span class="PUNC">(</span><span class="NAME">re</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">U</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">'":'</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1917</span> </span><span class="WHIT">                                                             </span><span class="NAME">F</span><span class="PUNC">(</span><span class="NAME">mix</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1918</span> </span><span class="WHIT">                                                             </span><span class="NAME">rv</span><span class="PUNC">[</span><span class="NAME">rv.length</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">","</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>1919</span> </span><span class="WHIT">                                            </span><span class="NAME">rv</span><span class="PUNC">[</span><span class="NAME">rv.length</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"}"</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>1920</span> </span><span class="WHIT">    </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">throw</span><span class="WHIT"> </span><span class="NAME">TypeError</span><span class="PUNC">(</span><span class="STRN">"bad data"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>1921</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1922</span> </span><span class="WHIT">  </span><span class="NAME">F</span><span class="PUNC">(</span><span class="NAME">mix</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1923</span> </span><span class="WHIT">  </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">rv.join</span><span class="PUNC">(</span><span class="STRN">""</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1924</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1925</span> 
<span class='linenumber'>1926</span> </span><span class="COMM">/** &lt;b>uu.json.decode - JSONデコード(JSON decode)&lt;/b>
<span class='linenumber'>1927</span>  *
<span class='linenumber'>1928</span>  * @param string      str   jsonエンコード済みの文字列を返します。
<span class='linenumber'>1929</span>  * @return hash/mix         jsonデコードされた要素を指定します。
<span class='linenumber'>1930</span>  * @see &lt;a href="#.encode">uu.json.encode&lt;/a> - JSONエンコード
<span class='linenumber'>1931</span>  */</span><span class="WHIT">
<span class='linenumber'>1932</span> </span><span class="NAME">uu.json.decode</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">str</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>1933</span> </span><span class="WHIT">  </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="PUNC">(</span><span class="REGX">/[^,:{}\[\]0-9.\-+Eaeflnr-u \n\r\t]/</span><span class="PUNC">.</span><span class="NAME">test</span><span class="PUNC">(</span><span class="NAME">str.replace</span><span class="PUNC">(</span><span class="REGX">/"(\\.|[^"\\])*"/g</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT">
<span class='linenumber'>1934</span> </span><span class="WHIT">         </span><span class="NAME">eval</span><span class="PUNC">(</span><span class="STRN">"("</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">str</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">")"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1935</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1936</span> 
<span class='linenumber'>1937</span> </span><span class="COMM">/** &lt;b>uu.json.timeout - タイムアウト時間&lt;/b>
<span class='linenumber'>1938</span>  * uu.json.load()で使用するタイムアウト時間を指定します。
<span class='linenumber'>1939</span>  * 0以上の数値を指定します。単位はmsです。0を指定するとタイムアウトしません。
<span class='linenumber'>1940</span>  * デフォルトは10000(10秒)です。uu.json._suicideより小さな値を指定してください。
<span class='linenumber'>1941</span>  *
<span class='linenumber'>1942</span>  * @type number
<span class='linenumber'>1943</span>  * @see &lt;a href="#.load">uu.json.load&lt;/a> - 非同期ロード
<span class='linenumber'>1944</span>  */</span><span class="WHIT">
<span class='linenumber'>1945</span> </span><span class="NAME">uu.json.load.timeout</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">10000</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// 10s</span><span class="WHIT">
<span class='linenumber'>1946</span> 
<span class='linenumber'>1947</span> </span><span class="COMM">/** &lt;b>uu.json.load.callbackFunctionName - コールバック関数名&lt;/b>
<span class='linenumber'>1948</span>  *
<span class='linenumber'>1949</span>  * コールバックで使用する関数名を変更する場合に指定します。JSONPのサーバ側の実装に従って設定してください。
<span class='linenumber'>1950</span>  * デフォルトは"callback"です。
<span class='linenumber'>1951</span>  *
<span class='linenumber'>1952</span>  * @type string
<span class='linenumber'>1953</span>  * @see &lt;a href="#.load">uu.json.load&lt;/a> - 非同期ロード
<span class='linenumber'>1954</span>  */</span><span class="WHIT">
<span class='linenumber'>1955</span> </span><span class="NAME">uu.json.load.callbackFunctionName</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"callback"</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>1956</span> 
<span class='linenumber'>1957</span> </span><span class="COMM">/** &lt;b>uu.json._suicide - 自殺(リソース開放までの)時間&lt;/b>
<span class='linenumber'>1958</span>  * uu.json.load()で使用するリソースを開放までの時間を指定します。
<span class='linenumber'>1959</span>  * 60000(60秒)以上の数値を指定します。単位はmsです。
<span class='linenumber'>1960</span>  * デフォルトは60000(60秒)です。uu.json.timeoutより小さい値を指定すると動作がおかしくなります。
<span class='linenumber'>1961</span>  *
<span class='linenumber'>1962</span>  * @type number
<span class='linenumber'>1963</span>  * @see &lt;a href="#.load">uu.json.load&lt;/a> - 非同期ロード
<span class='linenumber'>1964</span>  */</span><span class="WHIT">
<span class='linenumber'>1965</span> </span><span class="NAME">uu.json.load._suicide</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">60000</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// 60s</span><span class="WHIT">
<span class='linenumber'>1966</span> 
<span class='linenumber'>1967</span> </span><span class="NAME">uu.json.load._cache</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// cache</span><span class="WHIT">
<span class='linenumber'>1968</span> 
<span class='linenumber'>1969</span> </span><span class="COMM">////////////////////////////////////////////////////////////</span><span class="WHIT">
<span class='linenumber'>1970</span> </span><span class="COMM">// --- uu extend ---</span><span class="WHIT">
<span class='linenumber'>1971</span> </span><span class="NAME">uu.forEach</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>1972</span> </span><span class="WHIT">  </span><span class="COMM">/** @scope uu */</span><span class="WHIT">
<span class='linenumber'>1973</span> 
<span class='linenumber'>1974</span> </span><span class="WHIT">  </span><span class="COMM">/** &lt;b>uu.sprintf - フォーマットされた文字列を生成する(Create formatted string)&lt;/b>
<span class='linenumber'>1975</span>    *
<span class='linenumber'>1976</span>    * sprintf相当の関数です。&lt;br />
<span class='linenumber'>1977</span>    * format: %[arg-index$][flag][width][.precision][size]type &lt;br />
<span class='linenumber'>1978</span>    *
<span class='linenumber'>1979</span>    * &lt;pre>
<span class='linenumber'>1980</span>    * arg-index: 引数の呼び出しと再利用, i18n対応(PHP - sprintf準拠)
<span class='linenumber'>1981</span>    *      数値: 数値とダラー("$")により引数を0から始まる番号で呼び出すことができます。
<span class='linenumber'>1982</span>    *
<span class='linenumber'>1983</span>    * flag: 出力方法を指定します。
<span class='linenumber'>1984</span>    *    以下をサポートします。
<span class='linenumber'>1985</span>    *      "#": typeがo,x,Xなら文字列の先頭に"0","0x","0X"を追加します。
<span class='linenumber'>1986</span>    *    以下は非サポートです。
<span class='linenumber'>1987</span>    *      "-": 左詰で出力します。(非サポート)
<span class='linenumber'>1988</span>    *      "+": 数値の前に符号を追加します。(非サポート)
<span class='linenumber'>1989</span>    *      空白: 数値が負なら"-"を、それ以外なら空白を出力します。(非サポート)
<span class='linenumber'>1990</span>    *
<span class='linenumber'>1991</span>    * width: 出力する最小文字数か数値の最低桁数を指定します。
<span class='linenumber'>1992</span>    *    以下をサポートします。
<span class='linenumber'>1993</span>    *      数値: 数値により最低限表示する桁数を指定できます。0で非表示になります。
<span class='linenumber'>1994</span>    *            数値や文字列の桁あわせに使用します。
<span class='linenumber'>1995</span>    *    以下は非サポートです。
<span class='linenumber'>1996</span>    *      "*": 引数で幅を指定します。(非サポート)
<span class='linenumber'>1997</span>    *
<span class='linenumber'>1998</span>    * precision: 出力する最大文字数か小数点以下の桁数を指定します。
<span class='linenumber'>1999</span>    *    以下をサポートします。
<span class='linenumber'>2000</span>    *      数値: 数値で、小数点以下の桁数や文字列の長さを指定できます。
<span class='linenumber'>2001</span>    *            precisionの前にはドット(".")が必要です。
<span class='linenumber'>2002</span>    *            typeがfなら小数点以下の桁数を指定します。
<span class='linenumber'>2003</span>    *              浮動小数点値は丸められる場合があります。0で小数点以下は非表示になります。
<span class='linenumber'>2004</span>    *            typeがsなら文字列の長さを指定します。
<span class='linenumber'>2005</span>    *              指定した長さ以上の文字は切り捨てられます。0で文字列全体が非表示になります。
<span class='linenumber'>2006</span>    *    以下は非サポートです。
<span class='linenumber'>2007</span>    *      "*": 引数で精度を指定します。(非サポート)
<span class='linenumber'>2008</span>    *
<span class='linenumber'>2009</span>    * size: デフォルト引数のサイズを指定します。
<span class='linenumber'>2010</span>    *    以下は非サポートです。
<span class='linenumber'>2011</span>    *      "l": long型に変更します。
<span class='linenumber'>2012</span>    *
<span class='linenumber'>2013</span>    * type: 変数の型を指定します。
<span class='linenumber'>2014</span>    *    以下をサポートします。
<span class='linenumber'>2015</span>    *      "d": 符号付き10進数値(signed decimal number)
<span class='linenumber'>2016</span>    *      "u": 符号無し10進数値(unsigned decimal number)
<span class='linenumber'>2017</span>    *      "o": 符号無し8進数値(unsigned octet number)
<span class='linenumber'>2018</span>    *      "x": 符号無し16進数値[小文字](unsigned hex number[lower case])
<span class='linenumber'>2019</span>    *      "X": 符号無し16進数値[大文字](unsigned hex number[upper case])
<span class='linenumber'>2020</span>    *      "f": 浮動小数点([-]dddd.dddd)(floating-point number)
<span class='linenumber'>2021</span>    *      "c": 文字の数値表現(the character with that ASCII value)
<span class='linenumber'>2022</span>    *      "s": 文字列(string)
<span class='linenumber'>2023</span>    *      "%": パーセント記号("%")そのものを出力
<span class='linenumber'>2024</span>    *    以下は非サポートです。"egEG"は"f"で代用してください。
<span class='linenumber'>2025</span>    *      "i": 符号付き8進数値(signed octet number)
<span class='linenumber'>2026</span>    *      "e": 浮動小数点([-]d.dddde[+/-]dddd)
<span class='linenumber'>2027</span>    *      "g": 浮動小数点("f","e"の結果でより短い方を出力する)
<span class='linenumber'>2028</span>    *      "E": 浮動小数点([-]d.ddddE[+/-]dddd)
<span class='linenumber'>2029</span>    *      "G": 浮動小数点("f","E"の結果でより短い方を出力する)
<span class='linenumber'>2030</span>    *      "n": 出力済みの文字数
<span class='linenumber'>2031</span>    *      "p": ポインタ
<span class='linenumber'>2032</span>    * &lt;/pre>
<span class='linenumber'>2033</span>    *
<span class='linenumber'>2034</span>    * @param string  format  - フォーマット文字列を指定します。
<span class='linenumber'>2035</span>    * @param mix     args__  - sprintfに与える引数を指定します。引数は可変個です。
<span class='linenumber'>2036</span>    * @return string         - フォーマットした文字列を返します。
<span class='linenumber'>2037</span>    * @see &lt;a href="http://jp2.php.net/manual/ja/function.sprintf.php">sprintf - PHP&lt;/a>
<span class='linenumber'>2038</span>    */</span><span class="WHIT">
<span class='linenumber'>2039</span> </span><span class="WHIT">  </span><span class="NAME">sprintf</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">format</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">args__</span><span class="WHIT"> </span><span class="COMM">/* ... */</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>2040</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">av</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">next</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">pi</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">parseInt</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>2041</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">uns</span><span class="PUNC">(</span><span class="NAME">v</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">v</span><span class="WHIT"> </span><span class="PUNC">>=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">v</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">v</span><span class="WHIT"> </span><span class="PUNC">%</span><span class="WHIT"> </span><span class="NUMB">0x100000000</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NUMB">0x100000000</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// to unsigned</span><span class="WHIT">
<span class='linenumber'>2042</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">fmt</span><span class="PUNC">(</span><span class="NAME">word</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ai</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">flag</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">width</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">prec</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">size</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">type</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">str</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">v</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="COMM">// size, strは未使用, vは常にundefined</span><span class="WHIT">
<span class='linenumber'>2043</span> </span><span class="WHIT">      </span><span class="NAME">idx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">ai</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">parseInt</span><span class="PUNC">(</span><span class="NAME">ai</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">next</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>2044</span> </span><span class="WHIT">      </span><span class="KEYW">switch</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">type</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>2045</span> </span><span class="WHIT">      </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">"d"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">v</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">pi</span><span class="PUNC">(</span><span class="NAME">av</span><span class="PUNC">[</span><span class="NAME">idx</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">toString</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>2046</span> </span><span class="WHIT">      </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">"u"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">v</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">pi</span><span class="PUNC">(</span><span class="NAME">av</span><span class="PUNC">[</span><span class="NAME">idx</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">isNaN</span><span class="PUNC">(</span><span class="NAME">v</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">v</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">uns</span><span class="PUNC">(</span><span class="NAME">v</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">toString</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>2047</span> </span><span class="WHIT">      </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">"o"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">v</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">pi</span><span class="PUNC">(</span><span class="NAME">av</span><span class="PUNC">[</span><span class="NAME">idx</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">isNaN</span><span class="PUNC">(</span><span class="NAME">v</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">v</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">flag</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="STRN">"0"</span><span class="WHIT">  </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">uns</span><span class="PUNC">(</span><span class="NAME">v</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">toString</span><span class="PUNC">(</span><span class="NUMB">8</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>2048</span> </span><span class="WHIT">      </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">"x"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">v</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">pi</span><span class="PUNC">(</span><span class="NAME">av</span><span class="PUNC">[</span><span class="NAME">idx</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">isNaN</span><span class="PUNC">(</span><span class="NAME">v</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">v</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">flag</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="STRN">"0x"</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">uns</span><span class="PUNC">(</span><span class="NAME">v</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">toString</span><span class="PUNC">(</span><span class="NUMB">16</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>2049</span> </span><span class="WHIT">      </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">"X"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">v</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">pi</span><span class="PUNC">(</span><span class="NAME">av</span><span class="PUNC">[</span><span class="NAME">idx</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">isNaN</span><span class="PUNC">(</span><span class="NAME">v</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">v</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">flag</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="STRN">"0X"</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">uns</span><span class="PUNC">(</span><span class="NAME">v</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">toString</span><span class="PUNC">(</span><span class="NUMB">16</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">toUpperCase</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>2050</span> </span><span class="WHIT">      </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">"f"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">v</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">parseFloat</span><span class="PUNC">(</span><span class="NAME">av</span><span class="PUNC">[</span><span class="NAME">idx</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">toFixed</span><span class="PUNC">(</span><span class="NAME">prec</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>2051</span> </span><span class="WHIT">      </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">"c"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">width</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">v</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">av</span><span class="PUNC">[</span><span class="NAME">idx</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">v</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">v</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">"number"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">String.fromCharCode</span><span class="PUNC">(</span><span class="NAME">v</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">NaN</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>2052</span> </span><span class="WHIT">      </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">"s"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">width</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">v</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">av</span><span class="PUNC">[</span><span class="NAME">idx</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">toString</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">prec</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">v</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">v.substring</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">prec</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>2053</span> </span><span class="WHIT">      </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">"%"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">v</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"%"</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>2054</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>2055</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">isNaN</span><span class="PUNC">(</span><span class="NAME">v</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">v</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">v.toString</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>2056</span> </span><span class="WHIT">      </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">v.length</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">width</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">repeat</span><span class="PUNC">(</span><span class="STRN">" "</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">width</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">v.length</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">v</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">v</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>2057</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>2058</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">repeat</span><span class="PUNC">(</span><span class="NAME">str</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">sz</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>2059</span> </span><span class="WHIT">      </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">rv</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>2060</span> </span><span class="WHIT">      </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">sz</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">++</span><span class="NAME">i</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">rv</span><span class="PUNC">[</span><span class="NAME">rv.length</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">str</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>2061</span> </span><span class="WHIT">      </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">rv.join</span><span class="PUNC">(</span><span class="STRN">""</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>2062</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>2063</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">format.replace</span><span class="PUNC">(</span><span class="REGX">/%(?:([\d]+)\$)?(#)?([\d]+)?(?:\.([\d]+))?(l)?([%duoxXfcs])/g</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">fmt</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>2064</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>2065</span> </span><span class="WHIT">  </span><span class="COMM">/** &lt;b>uu.assert - C言語スタイルのアサーション(C style assert)&lt;/b>
<span class='linenumber'>2066</span>    * @see uu.module.debug.js
<span class='linenumber'>2067</span>    */</span><span class="WHIT">
<span class='linenumber'>2068</span> </span><span class="WHIT">  </span><span class="NAME">assert</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>2069</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>2070</span> </span><span class="WHIT">  </span><span class="COMM">/** &lt;b>uu.isA - 配列ならtrue(is Array)&lt;/b>
<span class='linenumber'>2071</span>    *
<span class='linenumber'>2072</span>    * @param mix mix - 検査する変数を指定します。
<span class='linenumber'>2073</span>    * @return bool - mixが配列ならtrueを返します。
<span class='linenumber'>2074</span>    */</span><span class="WHIT">
<span class='linenumber'>2075</span> </span><span class="WHIT">  </span><span class="NAME">isA</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">mix</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>2076</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">mix</span><span class="WHIT"> </span><span class="KEYW">instanceof</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>2077</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>2078</span> </span><span class="WHIT">  </span><span class="COMM">/** &lt;b>uu.isU - undefinedならtrue(is Undefined)&lt;/b>
<span class='linenumber'>2079</span>    *
<span class='linenumber'>2080</span>    * @param mix mix - 検査する変数を指定します。
<span class='linenumber'>2081</span>    * @return bool - mixがundefinedならtrueを返します。
<span class='linenumber'>2082</span>    */</span><span class="WHIT">
<span class='linenumber'>2083</span> </span><span class="WHIT">  </span><span class="NAME">isU</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">mix</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>2084</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">mix</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">"undefined"</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>2085</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>2086</span> </span><span class="WHIT">  </span><span class="COMM">/** &lt;b>uu.isF - 関数ならtrue(is Function)&lt;/b>
<span class='linenumber'>2087</span>    *
<span class='linenumber'>2088</span>    * @param mix mix - 検査する変数を指定します。
<span class='linenumber'>2089</span>    * @return bool - mixがfunctionならtrueを返します。
<span class='linenumber'>2090</span>    */</span><span class="WHIT">
<span class='linenumber'>2091</span> </span><span class="WHIT">  </span><span class="NAME">isF</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">mix</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>2092</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">mix</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">"function"</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>2093</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>2094</span> </span><span class="WHIT">  </span><span class="COMM">/** &lt;b>uu.isN - 数値ならtrue(is Number)&lt;/b>
<span class='linenumber'>2095</span>    *
<span class='linenumber'>2096</span>    * @param mix mix - 検査する変数を指定します。
<span class='linenumber'>2097</span>    * @return bool - mixがnumberならtrueを返します。
<span class='linenumber'>2098</span>    */</span><span class="WHIT">
<span class='linenumber'>2099</span> </span><span class="WHIT">  </span><span class="NAME">isN</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">mix</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>2100</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">mix</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">"number"</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">isFinite</span><span class="PUNC">(</span><span class="NAME">mix</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>2101</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>2102</span> </span><span class="WHIT">  </span><span class="COMM">/** &lt;b>uu.isB - 真偽値ならtrue(is Boolean)&lt;/b>
<span class='linenumber'>2103</span>    *
<span class='linenumber'>2104</span>    * @param mix mix - 検査する変数を指定します。
<span class='linenumber'>2105</span>    * @return bool - mixがbooleanならtrueを返します。
<span class='linenumber'>2106</span>    */</span><span class="WHIT">
<span class='linenumber'>2107</span> </span><span class="WHIT">  </span><span class="NAME">isB</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">mix</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>2108</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">mix</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">"boolean"</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>2109</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>2110</span> </span><span class="WHIT">  </span><span class="COMM">/** &lt;b>uu.isS - 文字列ならtrue(is String)&lt;/b>
<span class='linenumber'>2111</span>    *
<span class='linenumber'>2112</span>    * @param mix mix - 検査する変数を指定します。
<span class='linenumber'>2113</span>    * @return bool - mixがstringならtrueを返します。
<span class='linenumber'>2114</span>    */</span><span class="WHIT">
<span class='linenumber'>2115</span> </span><span class="WHIT">  </span><span class="NAME">isS</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">mix</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>2116</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">mix</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">"string"</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>2117</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>2118</span> </span><span class="WHIT">  </span><span class="COMM">/** &lt;b>uu.mute - ダミー関数&lt;/b>
<span class='linenumber'>2119</span>    * 何もしないダミー関数です。
<span class='linenumber'>2120</span>    */</span><span class="WHIT">
<span class='linenumber'>2121</span> </span><span class="WHIT">  </span><span class="NAME">mute</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>2122</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>2123</span> </span><span class="WHIT">  </span><span class="COMM">/** &lt;b>uu.mute - ダミー関数&lt;/b>
<span class='linenumber'>2124</span>    * 何もしないダミー関数です。第一引数をそのまま返します。
<span class='linenumber'>2125</span>    */</span><span class="WHIT">
<span class='linenumber'>2126</span> </span><span class="WHIT">  </span><span class="NAME">echo</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">dummy</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>2127</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">dummy</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>2128</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>2129</span> </span><span class="WHIT">  </span><span class="COMM">/** &lt;b>uu.baseURL - ベースURLの取得&lt;/b>
<span class='linenumber'>2130</span>    *
<span class='linenumber'>2131</span>    * ベースURL(uupaa.jsを読み込んだHTMLのパス)を返します。&lt;br />
<span class='linenumber'>2132</span>    * 結果はキャッシュされ、次回以降はキャッシュを返します。
<span class='linenumber'>2133</span>    *
<span class='linenumber'>2134</span>    * @return string - ベースURLを返します。
<span class='linenumber'>2135</span>    */</span><span class="WHIT">
<span class='linenumber'>2136</span> </span><span class="WHIT">  </span><span class="NAME">baseURL</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>2137</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">uu.baseURL._cache</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">uu.baseURL._cache</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">uu.url.path</span><span class="PUNC">(</span><span class="NAME">uu.url.abs</span><span class="PUNC">(</span><span class="NAME">uu.id</span><span class="PUNC">(</span><span class="STRN">"uupaa.js"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">src</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>2138</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>2139</span> </span><span class="WHIT">  </span><span class="COMM">/** &lt;b>uu.notax - 結合文字列, 文字列の配列, 文字列を受け取り、配列を返す&lt;/b>
<span class='linenumber'>2140</span>    *
<span class='linenumber'>2141</span>    * taxingをパースしfnで評価した配列を返します。
<span class='linenumber'>2142</span>    *
<span class='linenumber'>2143</span>    * &lt;pre class="eg">var a = "a, b,C,d ";
<span class='linenumber'>2144</span>    * uu.notax(a,"", function(str) { return str.toLowerCase(); }); // ["a","b","c","d"]
<span class='linenumber'>2145</span>    * &lt;/pre>
<span class='linenumber'>2146</span>    *
<span class='linenumber'>2147</span>    * @param taxing    tax           - セパレータで区切られた文字列,文字列の配列 または 文字列を指定します。
<span class='linenumber'>2148</span>    * @param hash      [param]       - パラメタを指定します。
<span class='linenumber'>2149</span>    * @param string    [param.sep]   - セパレータを指定します。デフォルトはカンマ(",")です。
<span class='linenumber'>2150</span>    * @param function  [param.fn]    - 各要素を評価する関数を指定します。デフォルトはundefinedです。
<span class='linenumber'>2151</span>    * @param bool      [param.trim]  - カンマ結合文字列の各要素の左右の空白文字をトリムする場合はtrueを指定します。デフォルトはtrueです。
<span class='linenumber'>2152</span>    *                                  taxが文字列や、配列で指定されている場合はトリムしません。
<span class='linenumber'>2153</span>    * @return array      - taxが結合文字列なら、各要素に分割、左右の空白をトリム後に配列化して返します。
<span class='linenumber'>2154</span>    *                      taxが文字列なら、taxを唯一の要素とする配列を返します。
<span class='linenumber'>2155</span>    *                      taxが配列ならtaxをそのまま返します。
<span class='linenumber'>2156</span>    * @throws TypeError  "uu.notax(tax) bad arg"  引数が文字列でも配列でもない
<span class='linenumber'>2157</span>    */</span><span class="WHIT">
<span class='linenumber'>2158</span> </span><span class="WHIT">  </span><span class="NAME">notax</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">tax</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">param</span><span class="WHIT"> </span><span class="COMM">/* = { sep: ",", fn: undefined, trim: true } */</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>2159</span> </span><span class="WHIT">    </span><span class="NAME">param</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">uu.mix.param</span><span class="PUNC">(</span><span class="NAME">param</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">sep</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">","</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">fn</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">uu.echo</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">trim</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>2160</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">uu.isA</span><span class="PUNC">(</span><span class="NAME">tax</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">param.fn</span><span class="PUNC">(</span><span class="NAME">tax</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>2161</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">uu.isS</span><span class="PUNC">(</span><span class="NAME">tax</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">throw</span><span class="WHIT"> </span><span class="NAME">TypeError</span><span class="PUNC">(</span><span class="STRN">"uu.notax(tax) bad arg"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>2162</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">tax.indexOf</span><span class="PUNC">(</span><span class="NAME">param.sep</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">param.fn</span><span class="PUNC">(</span><span class="NAME">tax</span><span class="PUNC">)</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>2163</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">tax.split</span><span class="PUNC">(</span><span class="NAME">param.sep</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">map</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">v</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>2164</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">param.trim</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">v</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">uu.trim</span><span class="PUNC">(</span><span class="NAME">v</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>2165</span> </span><span class="WHIT">      </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">param.fn</span><span class="PUNC">(</span><span class="NAME">v</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>2166</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>2167</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>2168</span> </span><span class="WHIT">  </span><span class="COMM">/** &lt;b>配列をhash化&lt;/b>
<span class='linenumber'>2169</span>    *
<span class='linenumber'>2170</span>    * 配列をhash化します。&lt;br />
<span class='linenumber'>2171</span>    * 同じindexはひとつにまとめられ、関数オブジェクトは除外します。
<span class='linenumber'>2172</span>    *
<span class='linenumber'>2173</span>    * &lt;pre class="eg">
<span class='linenumber'>2174</span>    *  var ary = [undefined, null, 1, 1, "hoge", function(){} ];
<span class='linenumber'>2175</span>    *  ary["hash_index"] = "lost value";
<span class='linenumber'>2176</span>    *  var b = uu.toHash(ary); // { undefined: undefined, null: null, 1: 1, hoge: "hoge" }
<span class='linenumber'>2177</span>    * &lt;/pre>
<span class='linenumber'>2178</span>    *
<span class='linenumber'>2179</span>    * @param array ary - hash化する配列を指定します。
<span class='linenumber'>2180</span>    * @return hash     - hash化した配列を返します。
<span class='linenumber'>2181</span>    */</span><span class="WHIT">
<span class='linenumber'>2182</span> </span><span class="WHIT">  </span><span class="NAME">toHash</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">ary</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>2183</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">rv</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">sz</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">ary.length</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>2184</span> </span><span class="WHIT">    </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">sz</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">++</span><span class="NAME">i</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>2185</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">i</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">ary</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">ary</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="STRN">"function"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>2186</span> </span><span class="WHIT">        </span><span class="NAME">rv</span><span class="PUNC">[</span><span class="NAME">ary</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">ary</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="WHIT">
<span class='linenumber'>2187</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>2188</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>2189</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">rv</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>2190</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>2191</span> </span><span class="WHIT">  </span><span class="COMM">/** &lt;b>uu.ltrim - 左側の空白文字を除去&lt;/b>
<span class='linenumber'>2192</span>    *
<span class='linenumber'>2193</span>    * 文字列の左側から空白文字をトリム(除去)し、新しい文字列を返します。
<span class='linenumber'>2194</span>    *
<span class='linenumber'>2195</span>    * &lt;pre class="eg">uu.ltrim(" hoge "); // "hoge "&lt;/pre>
<span class='linenumber'>2196</span>    *
<span class='linenumber'>2197</span>    * @param string           str - 文字列を指定します。
<span class='linenumber'>2198</span>    * @param regexp/undefined reg - 文字列の左側からトリミングする文字の集合を正規表現オブジェクトで指定します。
<span class='linenumber'>2199</span>    *                               省略時は、NULL("\0"),空白(" "),タブ("\t"),改行("\n"),垂直タブ("\v"),復帰("\d")をトリミングします。
<span class='linenumber'>2200</span>    * @return string - トリム後の文字列を返します。
<span class='linenumber'>2201</span>    * @see &lt;a href="#rtrim">uu.rtrim&lt;/a> - 右側の空白文字を除去
<span class='linenumber'>2202</span>    * @see &lt;a href="#trim">uu.trim&lt;/a> - 両側の空白文字を除去
<span class='linenumber'>2203</span>    */</span><span class="WHIT">
<span class='linenumber'>2204</span> </span><span class="WHIT">  </span><span class="NAME">ltrim</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">str</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">reg</span><span class="WHIT"> </span><span class="COMM">/* = undefined */</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>2205</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">str.replace</span><span class="PUNC">(</span><span class="NAME">RegExp</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">reg</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="STRN">"^[\\s]+"</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">"^["</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">reg</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"]+"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"g"</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>2206</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>2207</span> </span><span class="WHIT">  </span><span class="COMM">/** &lt;b>uu.rtrim - 左側の空白文字を除去&lt;/b>
<span class='linenumber'>2208</span>    *
<span class='linenumber'>2209</span>    * 文字列の右側から空白文字をトリム(除去)し、新しい文字列を返します。
<span class='linenumber'>2210</span>    *
<span class='linenumber'>2211</span>    * &lt;pre class="eg">uu.rtrim(" hoge "); // " hoge"&lt;/pre>
<span class='linenumber'>2212</span>    *
<span class='linenumber'>2213</span>    * @param string           str - 文字列を指定します。
<span class='linenumber'>2214</span>    * @param regexp/undefined reg - 文字列の右側からトリミングする文字の集合を正規表現オブジェクトで指定します。
<span class='linenumber'>2215</span>    *                               省略時は、NULL("\0"),空白(" "),タブ("\t"),改行("\n"),垂直タブ("\v"),復帰("\d")をトリミングします。
<span class='linenumber'>2216</span>    * @return string - トリム後の文字列を返します。
<span class='linenumber'>2217</span>    * @see &lt;a href="#ltrim">uu.ltrim&lt;/a> - 左側の空白文字を除去
<span class='linenumber'>2218</span>    * @see &lt;a href="#trim">uu.trim&lt;/a> - 両側の空白文字を除去
<span class='linenumber'>2219</span>    */</span><span class="WHIT">
<span class='linenumber'>2220</span> </span><span class="WHIT">  </span><span class="NAME">rtrim</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">str</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">reg</span><span class="WHIT"> </span><span class="COMM">/* = undefined */</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>2221</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">str.replace</span><span class="PUNC">(</span><span class="NAME">RegExp</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">reg</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="STRN">"[\\s]+$"</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">"["</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">reg</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"]+$"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"g"</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>2222</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>2223</span> </span><span class="WHIT">  </span><span class="COMM">/** &lt;b>uu.trim - 両側から空白文字を除去&lt;/b>
<span class='linenumber'>2224</span>    *
<span class='linenumber'>2225</span>    * 文字列の両側から空白文字をトリム(除去)し、新しい文字列を返します。
<span class='linenumber'>2226</span>    *
<span class='linenumber'>2227</span>    * &lt;pre class="eg">uu.trim(" hoge "); // "hoge"&lt;/pre>
<span class='linenumber'>2228</span>    *
<span class='linenumber'>2229</span>    * @param string           str - 文字列を指定します。
<span class='linenumber'>2230</span>    * @param regexp/undefined reg - 文字列の左右からトリミングする文字の集合を正規表現オブジェクトで指定します。
<span class='linenumber'>2231</span>    *                               省略時は、NULL("\0"),空白(" "),タブ("\t"),改行("\n"),垂直タブ("\v"),復帰("\d")をトリミングします。
<span class='linenumber'>2232</span>    * @return string - トリム後の文字列を返します。
<span class='linenumber'>2233</span>    * @see &lt;a href="#rtrim">uu.rtrim&lt;/a> - 右側の空白文字を除去
<span class='linenumber'>2234</span>    * @see &lt;a href="#ltrim">uu.ltrim&lt;/a> - 左側の空白文字を除去
<span class='linenumber'>2235</span>    */</span><span class="WHIT">
<span class='linenumber'>2236</span> </span><span class="WHIT">  </span><span class="NAME">trim</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">str</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">reg</span><span class="WHIT"> </span><span class="COMM">/* = undefined */</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>2237</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">reg</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">str.replace</span><span class="PUNC">(</span><span class="REGX">/^[\s]*|[\s]*$/g</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT">
<span class='linenumber'>2238</span> </span><span class="WHIT">                    </span><span class="NAME">str.replace</span><span class="PUNC">(</span><span class="NAME">RegExp</span><span class="PUNC">(</span><span class="STRN">"^["</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">reg</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"]+"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"g"</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">)</span><span class="WHIT">
<span class='linenumber'>2239</span> </span><span class="WHIT">                       </span><span class="PUNC">.</span><span class="NAME">replace</span><span class="PUNC">(</span><span class="NAME">RegExp</span><span class="PUNC">(</span><span class="STRN">"["</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">reg</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"]+$"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"g"</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>2240</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>2241</span> </span><span class="WHIT">  </span><span class="COMM">/** &lt;b>uu.indexes - array/hashのindexを列挙し配列を返す&lt;/b>
<span class='linenumber'>2242</span>    *
<span class='linenumber'>2243</span>    * mixがarrayなら、indexを列挙し配列を返します。hash要素(文字列のindexを持つ要素)は除外します。&lt;br />
<span class='linenumber'>2244</span>    * mixがhashなら、数値/文字両方のindexを列挙し配列を返します。&lt;br />
<span class='linenumber'>2245</span>    *
<span class='linenumber'>2246</span>    * 要素数(length)の取得にも利用できます。
<span class='linenumber'>2247</span>    *
<span class='linenumber'>2248</span>    * &lt;pre class="eg">
<span class='linenumber'>2249</span>    * var array = [74, 50, 50], hash = { a: 74, b: 50, c: 50 };
<span class='linenumber'>2250</span>    * array["hash_index"] = "hash";
<span class='linenumber'>2251</span>    * hash[0] = "hash";
<span class='linenumber'>2252</span>    * delete array[0];
<span class='linenumber'>2253</span>    * uu.indexes(array); // [undefined, 1, 2]
<span class='linenumber'>2254</span>    * uu.indexes(hash); // ["a", "b", "c", 0]
<span class='linenumber'>2255</span>    * &lt;/pre>
<span class='linenumber'>2256</span>    *
<span class='linenumber'>2257</span>    * @param hash/array mix - 検索対象の要素を指定します。
<span class='linenumber'>2258</span>    * @return array         - hash/arrayのindexを列挙した配列を返します。
<span class='linenumber'>2259</span>    *                         有効な要素がなければ、空の配列([])を返します。
<span class='linenumber'>2260</span>    * @see &lt;a href="#values">uu.values&lt;/a> - array/hashの値を列挙
<span class='linenumber'>2261</span>    */</span><span class="WHIT">
<span class='linenumber'>2262</span> </span><span class="WHIT">  </span><span class="NAME">indexes</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">mix</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>2263</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">rv</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">sz</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>2264</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">uu.isA</span><span class="PUNC">(</span><span class="NAME">mix</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>2265</span> </span><span class="WHIT">      </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">sz</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">mix.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">sz</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">++</span><span class="NAME">i</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>2266</span> </span><span class="WHIT">        </span><span class="PUNC">(</span><span class="NAME">i</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">mix</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">rv.push</span><span class="PUNC">(</span><span class="NAME">i</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>2267</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>2268</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>2269</span> </span><span class="WHIT">      </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">i</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">mix</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>2270</span> </span><span class="WHIT">        </span><span class="NAME">mix.hasOwnProperty</span><span class="PUNC">(</span><span class="NAME">i</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">rv.push</span><span class="PUNC">(</span><span class="NAME">i</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>2271</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>2272</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>2273</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">rv</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>2274</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>2275</span> </span><span class="WHIT">  </span><span class="COMM">/** &lt;b>uu.values - array/hashの値を列挙し配列を返す&lt;/b>
<span class='linenumber'>2276</span>    *
<span class='linenumber'>2277</span>    * mixがarrayなら、値を列挙し配列を返します。hash要素(文字列のindexを持つ要素)は除外します。&lt;br />
<span class='linenumber'>2278</span>    * mixがhashなら、数値/文字両方のindexを持つ値を列挙し配列を返します。&lt;br />
<span class='linenumber'>2279</span>    *
<span class='linenumber'>2280</span>    * 要素数(length)の取得にも利用できます。
<span class='linenumber'>2281</span>    *
<span class='linenumber'>2282</span>    * &lt;pre class="eg">
<span class='linenumber'>2283</span>    * var array = [74, 50, 50], hash = { a: 74, b: 50, c: 50 };
<span class='linenumber'>2284</span>    * array["hash_index"] = "hash";
<span class='linenumber'>2285</span>    * hash[0] = "hash";
<span class='linenumber'>2286</span>    * delete array[0];
<span class='linenumber'>2287</span>    * uu.values(array); // [50, 50]
<span class='linenumber'>2288</span>    * uu.values(hash); // [74, 50, 50, "hash"]
<span class='linenumber'>2289</span>    * &lt;/pre>
<span class='linenumber'>2290</span>    *
<span class='linenumber'>2291</span>    * @param hash/array mix - 検索対象の要素を指定します。
<span class='linenumber'>2292</span>    * @return array         - hash/arrayの値を列挙した配列を返します。
<span class='linenumber'>2293</span>    *                         有効な要素がなければ、空の配列([])を返します。
<span class='linenumber'>2294</span>    * @see &lt;a href="#indexes">uu.indexes&lt;/a> - array/hashのindexを列挙
<span class='linenumber'>2295</span>    */</span><span class="WHIT">
<span class='linenumber'>2296</span> </span><span class="WHIT">  </span><span class="NAME">values</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">mix</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>2297</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">rv</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">sz</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>2298</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">uu.isA</span><span class="PUNC">(</span><span class="NAME">mix</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>2299</span> </span><span class="WHIT">      </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">sz</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">mix.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">sz</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">++</span><span class="NAME">i</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>2300</span> </span><span class="WHIT">        </span><span class="PUNC">(</span><span class="NAME">i</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">mix</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">rv.push</span><span class="PUNC">(</span><span class="NAME">mix</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>2301</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>2302</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>2303</span> </span><span class="WHIT">      </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">i</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">mix</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>2304</span> </span><span class="WHIT">        </span><span class="NAME">mix.hasOwnProperty</span><span class="PUNC">(</span><span class="NAME">i</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">rv.push</span><span class="PUNC">(</span><span class="NAME">mix</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>2305</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>2306</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>2307</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">rv</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>2308</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>2309</span> </span><span class="WHIT">  </span><span class="COMM">/** &lt;b>uu.toArray - 擬似配列を配列化&lt;/b>
<span class='linenumber'>2310</span>    *
<span class='linenumber'>2311</span>    * 与えられた擬似配列を配列化します。&lt;br />
<span class='linenumber'>2312</span>    *
<span class='linenumber'>2313</span>    * 擬似配列には以下のようなものがあります。&lt;br />
<span class='linenumber'>2314</span>    * document.images, NodeList, arguments
<span class='linenumber'>2315</span>    *
<span class='linenumber'>2316</span>    * &lt;pre class="eg">
<span class='linenumber'>2317</span>    *  var node = uu.toArray(uu.tag("*"));
<span class='linenumber'>2318</span>    * &lt;/pre>
<span class='linenumber'>2319</span>    *
<span class='linenumber'>2320</span>    * @param FakeArray fake - 擬似配列を指定します。
<span class='linenumber'>2321</span>    * @return array  - fakeがnullやlengthプロパティを持たないhashが指定された場合は空の配列([])を返します。&lt;br />
<span class='linenumber'>2322</span>    *                  fakeがlengthプロパティを持つ擬似配列なら配列化してから返します。
<span class='linenumber'>2323</span>    * @see &lt;a href="http://d.hatena.ne.jp/uupaa/20080602">uupaa開発日記&lt;/a>
<span class='linenumber'>2324</span>    */</span><span class="WHIT">
<span class='linenumber'>2325</span> </span><span class="WHIT">  </span><span class="NAME">toArray</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">fake</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>2326</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">fake</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="PUNC">(</span><span class="STRN">"length"</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">fake</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">fake.length</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>2327</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">rv</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">(</span><span class="NAME">fake.length</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">sz</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">rv.length</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>2328</span> </span><span class="WHIT">    </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">sz</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">++</span><span class="NAME">i</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">rv</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">fake</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>2329</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">rv</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>2330</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>2331</span> </span><span class="WHIT">  </span><span class="COMM">/** &lt;b>uu.pushArray - 擬似配列をオブジェクトの要素に追加&lt;/b>
<span class='linenumber'>2332</span>    *
<span class='linenumber'>2333</span>    * 与えられた擬似配列を、オブジェクトの要素に追加します。&lt;br />
<span class='linenumber'>2334</span>    * obj.lengthを追加した要素数に更新します。
<span class='linenumber'>2335</span>    *
<span class='linenumber'>2336</span>    * &lt;pre class="eg">
<span class='linenumber'>2337</span>    *  var hash = {};
<span class='linenumber'>2338</span>    *  uu.pushArray(uu.tag("*"), hash); // hash[0] = html, hash[1] = head, hash[2] = meta, ...
<span class='linenumber'>2339</span>    * &lt;/pre>
<span class='linenumber'>2340</span>    *
<span class='linenumber'>2341</span>    * @param FakeArray fake - 擬似配列を指定します。
<span class='linenumber'>2342</span>    * @param object    [obj - オブジェクトを指定します。
<span class='linenumber'>2343</span>    * @return object  - fake追加後のオブジェクトを返します。
<span class='linenumber'>2344</span>    * @see uu.toArray - 擬似配列を配列化
<span class='linenumber'>2345</span>    */</span><span class="WHIT">
<span class='linenumber'>2346</span> </span><span class="WHIT">  </span><span class="NAME">pushArray</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">fake</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">obj</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>2347</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">fake</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="PUNC">(</span><span class="STRN">"length"</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">fake</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">fake.length</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">obj.length</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">obj</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>2348</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">sz</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">fake.length</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>2349</span> </span><span class="WHIT">    </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">sz</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">++</span><span class="NAME">i</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">obj</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">fake</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>2350</span> </span><span class="WHIT">    </span><span class="NAME">obj.length</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">sz</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>2351</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">obj</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>2352</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>2353</span> </span><span class="WHIT">  </span><span class="COMM">/** &lt;b>uu.diet - コンパクト化(Memory compaction)&lt;/b>
<span class='linenumber'>2354</span>    *
<span class='linenumber'>2355</span>    * mixが配列なら、数字indexを持つ要素のうち、
<span class='linenumber'>2356</span>    * 値がnull/undefinedの要素や、hash要素を除いた新しい配列を返します。&lt;br />
<span class='linenumber'>2357</span>    * mixがhashなら、数字/hash indexを持つ要素のうち、
<span class='linenumber'>2358</span>    * 値がnull/undefinedの要素を除いた新しいhashを返します。&lt;br />
<span class='linenumber'>2359</span>    *
<span class='linenumber'>2360</span>    * &lt;pre class="eg">
<span class='linenumber'>2361</span>    * var array = [null, undefined, 3], hash = { a: null, b: undefined, c: 50 };
<span class='linenumber'>2362</span>    * array["hash_index"] = "hash";
<span class='linenumber'>2363</span>    * hash[0] = "hash";
<span class='linenumber'>2364</span>    * uu.diet(array); // [3]
<span class='linenumber'>2365</span>    * uu.diet(hash); // { c: 50, 0: "hash" }
<span class='linenumber'>2366</span>    * &lt;/pre>
<span class='linenumber'>2367</span>    *
<span class='linenumber'>2368</span>    * @param hash/array mix - hashか配列を指定します。
<span class='linenumber'>2369</span>    * @return hash/array - 有効な要素のみを持つ新しい配列かhashを返します。&lt;br />
<span class='linenumber'>2370</span>    *                      有効な要素がなければ、空の配列([])かhash({})を返します。
<span class='linenumber'>2371</span>    */</span><span class="WHIT">
<span class='linenumber'>2372</span> </span><span class="WHIT">  </span><span class="NAME">diet</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">mix</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>2373</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">rv</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">sz</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>2374</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">uu.isA</span><span class="PUNC">(</span><span class="NAME">mix</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>2375</span> </span><span class="WHIT">      </span><span class="NAME">rv</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">sz</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">mix.length</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>2376</span> </span><span class="WHIT">      </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">sz</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">++</span><span class="NAME">i</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>2377</span> </span><span class="WHIT">        </span><span class="PUNC">(</span><span class="NAME">mix</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">mix</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="STRN">"undefined"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">rv.push</span><span class="PUNC">(</span><span class="NAME">mix</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>2378</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>2379</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>2380</span> </span><span class="WHIT">      </span><span class="NAME">rv</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>2381</span> </span><span class="WHIT">      </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">i</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">mix</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>2382</span> </span><span class="WHIT">        </span><span class="PUNC">(</span><span class="NAME">mix</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">mix</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="STRN">"undefined"</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">mix.hasOwnProperty</span><span class="PUNC">(</span><span class="NAME">i</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">rv</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">mix</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>2383</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>2384</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>2385</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">rv</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>2386</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>2387</span> </span><span class="WHIT">  </span><span class="COMM">/** &lt;b>uu.uniqueID - ユニークIDの生成(generate unique id)&lt;/b>
<span class='linenumber'>2388</span>    *
<span class='linenumber'>2389</span>    * @param string [prefix] - プリフィクスを指定します。デフォルトは"uu"です。
<span class='linenumber'>2390</span>    * @return string         - プリフィクス + ユニークナンバー で構成される文字列を返します。
<span class='linenumber'>2391</span>    */</span><span class="WHIT">
<span class='linenumber'>2392</span> </span><span class="WHIT">  </span><span class="NAME">uniqueID</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">prefix</span><span class="WHIT"> </span><span class="COMM">/* = "uu" */</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>2393</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">prefix</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="STRN">"uu"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">++</span><span class="NAME">uu.uniqueID._count</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>2394</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>2395</span> </span><span class="WHIT">  </span><span class="COMM">/** &lt;b>uu.delay - 遅延評価&lt;/b>
<span class='linenumber'>2396</span>    *
<span class='linenumber'>2397</span>    * @param function fn      - 遅延評価する関数を指定します。
<span class='linenumber'>2398</span>    * @param number   [delay] - 遅延時間をms単位で指定します。デフォルトは0です。
<span class='linenumber'>2399</span>    * @return number          - タイマーIDを返します。
<span class='linenumber'>2400</span>    */</span><span class="WHIT">
<span class='linenumber'>2401</span> </span><span class="WHIT">  </span><span class="NAME">delay</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">fn</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">delay</span><span class="WHIT"> </span><span class="COMM">/* = 0ms */</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>2402</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">uuw.setTimeout</span><span class="PUNC">(</span><span class="NAME">fn</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">delay</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>2403</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>2404</span> </span><span class="WHIT">  </span><span class="COMM">/** &lt;b>uu.basicClass - クラスの雛形を生成&lt;/b>
<span class='linenumber'>2405</span>    *
<span class='linenumber'>2406</span>    * クラスの雛形を生成するクロージャを返します。&lt;br />
<span class='linenumber'>2407</span>    * newされたタイミングで、コンストラクタを自動で呼び出し、
<span class='linenumber'>2408</span>    * uu.window.unready()にデストラクタを登録します。
<span class='linenumber'>2409</span>    *
<span class='linenumber'>2410</span>    * @return function - クラスの雛形を生成するクロージャを返します。
<span class='linenumber'>2411</span>    */</span><span class="WHIT">
<span class='linenumber'>2412</span> </span><span class="WHIT">  </span><span class="NAME">basicClass</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">_</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>2413</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>2414</span> </span><span class="WHIT">      </span><span class="NAME">this.construct.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>2415</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.destruct</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>2416</span> </span><span class="WHIT">        </span><span class="NAME">uu.window.unready</span><span class="PUNC">(</span><span class="NAME">this.destruct</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>2417</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>2418</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>2419</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>2420</span> </span><span class="WHIT">  </span><span class="COMM">/** &lt;b>uu.abstractClass - 委譲用のクラスの雛形を生成&lt;/b>
<span class='linenumber'>2421</span>    *
<span class='linenumber'>2422</span>    * 委譲用クラスの雛形を生成するクロージャを返します。&lt;br />
<span class='linenumber'>2423</span>    *
<span class='linenumber'>2424</span>    * このメソッドは、コンストラクタとデストラクタを自動で呼び出しません。&lt;br />
<span class='linenumber'>2425</span>    * 委譲元で処理する必要があります。
<span class='linenumber'>2426</span>    *
<span class='linenumber'>2427</span>    * @return function - クラスの雛形を生成するクロージャを返します。
<span class='linenumber'>2428</span>    */</span><span class="WHIT">
<span class='linenumber'>2429</span> </span><span class="WHIT">  </span><span class="NAME">abstractClass</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">_</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>2430</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>2431</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>2432</span> </span><span class="WHIT">  </span><span class="COMM">/** &lt;b>uu.staticClass - public staticなクラスの雛形を生成&lt;/b>
<span class='linenumber'>2433</span>    *
<span class='linenumber'>2434</span>    * 静的クラス(常に存在し、newしなくても使用できるメソッドを持つクラス)の雛形を生成するクロージャを返します。&lt;br />
<span class='linenumber'>2435</span>    *
<span class='linenumber'>2436</span>    * @return function - クラスの雛形を生成するクロージャを返します。
<span class='linenumber'>2437</span>    */</span><span class="WHIT">
<span class='linenumber'>2438</span> </span><span class="WHIT">  </span><span class="NAME">staticClass</span><span class="PUNC">:</span><span class="WHIT">  </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">_</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>2439</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>2440</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>2441</span> </span><span class="WHIT">  </span><span class="COMM">/** &lt;b>uu.singletonClass - シングルトンクラスの雛形を生成&lt;/b>
<span class='linenumber'>2442</span>    *
<span class='linenumber'>2443</span>    * シングルトンクラス(インスタンスを一つしか生成できないクラス)の雛形を生成するクロージャを返します。&lt;br />
<span class='linenumber'>2444</span>    * newされたタイミングで、コンストラクタを自動で呼び出し、
<span class='linenumber'>2445</span>    * uu.window.unready()にデストラクタを登録します。
<span class='linenumber'>2446</span>    *
<span class='linenumber'>2447</span>    * @return function - クラスの雛形を生成するクロージャを返します。
<span class='linenumber'>2448</span>    */</span><span class="WHIT">
<span class='linenumber'>2449</span> </span><span class="WHIT">  </span><span class="NAME">singletonClass</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">_</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>2450</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>2451</span> </span><span class="WHIT">      </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">me</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">arguments.callee</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>2452</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">me.instance</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>2453</span> </span><span class="WHIT">        </span><span class="NAME">me.instance</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// keep instance</span><span class="WHIT">
<span class='linenumber'>2454</span> </span><span class="WHIT">        </span><span class="NAME">this.construct.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>2455</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.destruct</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">uu.window.unready</span><span class="PUNC">(</span><span class="NAME">this.destruct</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>2456</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>2457</span> </span><span class="WHIT">      </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">me.instance</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>2458</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>2459</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>2460</span> </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">v</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">p</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>2461</span> </span><span class="WHIT">  </span><span class="NAME">uu</span><span class="PUNC">[</span><span class="NAME">p</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">v</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>2462</span> </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>2463</span> </span><span class="NAME">uu.uniqueID._count</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>2464</span> </span><span class="NAME">uu.baseURL._cache</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>2465</span> 
<span class='linenumber'>2466</span> </span><span class="COMM">////////////////////////////////////////////////////////////</span><span class="WHIT">
<span class='linenumber'>2467</span> </span><span class="COMM">// --- Array extend ---</span><span class="WHIT">
<span class='linenumber'>2468</span> 
<span class='linenumber'>2469</span> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">Array.prototype.forEach</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>2470</span> </span><span class="WHIT">  </span><span class="COMM">/** @scope Array.prototype */</span><span class="WHIT">
<span class='linenumber'>2471</span> </span><span class="WHIT">  </span><span class="COMM">/** &lt;b>Array.forEach - 全要素をfnで評価する&lt;/b>
<span class='linenumber'>2472</span>    * @param function  fn   - 各要素を評価する関数を指定します。
<span class='linenumber'>2473</span>    * @param this      [me] - thisオブジェクトを指定します。デフォルトはundefined(=window)です。
<span class='linenumber'>2474</span>    * @return this - 元の配列(this)を返します(JavaScript1.6のArray.forEach()はthisを返さない仕様です)。
<span class='linenumber'>2475</span>    * @see &lt;a href="http://developer.mozilla.org/ja/docs/Core_JavaScript_1.5_Reference:Global_Objects:Array:forEach">Array.forEach&lt;/a> - 全要素を評価し配列を返す - MDC
<span class='linenumber'>2476</span>    * @see &lt;a href="#filter">Array.filter&lt;/a> - 全要素を評価し結果が真の要素を配列で返す
<span class='linenumber'>2477</span>    * @see &lt;a href="#every">Array.every&lt;/a> - 全要素を評価し全て真ならtrueを返す
<span class='linenumber'>2478</span>    * @see &lt;a href="#some">Array.some&lt;/a> - 全要素を評価し全て偽ならtrueを返す
<span class='linenumber'>2479</span>    * @see &lt;a href="#map">Array.map&lt;/a> - 全要素を評価し配列を返す
<span class='linenumber'>2480</span>    */</span><span class="WHIT">
<span class='linenumber'>2481</span> </span><span class="WHIT">  </span><span class="NAME">Array.prototype.forEach</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">fn</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">me</span><span class="WHIT"> </span><span class="COMM">/* = undefined */</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>2482</span> </span><span class="WHIT">    </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">sz</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">sz</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">++</span><span class="NAME">i</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>2483</span> </span><span class="WHIT">      </span><span class="PUNC">(</span><span class="NAME">i</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">fn.call</span><span class="PUNC">(</span><span class="NAME">me</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>2484</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>2485</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>2486</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>2487</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>2488</span> 
<span class='linenumber'>2489</span> </span><span class="NAME">uu.forEach</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>2490</span> </span><span class="WHIT">  </span><span class="COMM">/** @scope Array.prototype */</span><span class="WHIT">
<span class='linenumber'>2491</span> 
<span class='linenumber'>2492</span> </span><span class="WHIT">  </span><span class="COMM">/** &lt;b>Array.indexOf - 配列の先頭から値を検索し最初のindexを返す。無ければ-1を返す(JavaScript 1.6準拠)&lt;/b>
<span class='linenumber'>2493</span>    *
<span class='linenumber'>2494</span>    * &lt;pre class="eg">var rv = [0, 1, 1, 2];
<span class='linenumber'>2495</span>    * rv["hash"] = "hash";
<span class='linenumber'>2496</span>    * rv.indexOf(1), rv.indexOf(1, -2); // 1, 2
<span class='linenumber'>2497</span>    * rv.indexOf("1"), rv.indexOf("hash"); // -1, -1&lt;/pre>
<span class='linenumber'>2498</span>    *
<span class='linenumber'>2499</span>    * @param mix     value   - 検索する値を指定します。検索は===演算子で比較します。
<span class='linenumber'>2500</span>    * @param number  [index] - 検索を開始するindexを指定します。負の値は配列の末尾からのオフセットとみなします。デフォルトは0です。
<span class='linenumber'>2501</span>    * @return number - 検索成功で0以上の値を返します。失敗で-1を返します。
<span class='linenumber'>2502</span>    * @see &lt;a href="http://developer.mozilla.org/ja/docs/Core_JavaScript_1.5_Reference:Global_Objects:Array:indexOf">Array:indexOf&lt;/a> - 配列の末尾から値を検索 - MDC
<span class='linenumber'>2503</span>    * @see &lt;a href="#lastIndexOf">Array.lastIndexOf&lt;/a> - 配列の末尾から値を検索
<span class='linenumber'>2504</span>    */</span><span class="WHIT">
<span class='linenumber'>2505</span> </span><span class="WHIT">  </span><span class="NAME">indexOf</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">value</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">index</span><span class="WHIT"> </span><span class="COMM">/* = 0 */</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>2506</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">sz</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">index</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">index</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">index</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">index</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">index</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">sz</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">index</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>2507</span> </span><span class="WHIT">    </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">index</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">sz</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">++</span><span class="NAME">index</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>2508</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">index</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">[</span><span class="NAME">index</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">value</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">index</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>2509</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>2510</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>2511</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>2512</span> </span><span class="WHIT">  </span><span class="COMM">/** &lt;b>Array.lastIndexOf - 配列の後方から値を検索し最初のindexを返す。無ければ-1を返す(JavaScript 1.6準拠)&lt;/b>
<span class='linenumber'>2513</span>    *
<span class='linenumber'>2514</span>    * &lt;pre class="eg">var rv = [0, 1, 1, 2]; rv["hash"] = "hash";
<span class='linenumber'>2515</span>    * rv.lastIndexOf(1), rv.lastIndexOf(1, -2); // 2, 2
<span class='linenumber'>2516</span>    * rv.lastIndexOf("1"), rv.lastIndexOf("hash"); // -1, -1&lt;/pre>
<span class='linenumber'>2517</span>    *
<span class='linenumber'>2518</span>    * @param mix     value   - 検索する値を指定します。検索は===演算子で比較します。
<span class='linenumber'>2519</span>    * @param number  [index] - 検索を開始するindexを指定します。負の値は配列の末尾からのオフセットとみなします。デフォルトは0です。
<span class='linenumber'>2520</span>    * @return number - 検索成功で0以上の値を返します。失敗で-1を返します。
<span class='linenumber'>2521</span>    * @see &lt;a href="http://developer.mozilla.org/ja/docs/Core_JavaScript_1.5_Reference:Global_Objects:Array:lastIndexOf">Array:lastIndexOf&lt;/a> - 配列の先頭から値を検索 - MDC
<span class='linenumber'>2522</span>    * @see &lt;a href="#lastIndexOf">Array.lastIndexOf&lt;/a> - 配列の先頭から値を検索
<span class='linenumber'>2523</span>    */</span><span class="WHIT">
<span class='linenumber'>2524</span> </span><span class="WHIT">  </span><span class="NAME">lastIndexOf</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">value</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">index</span><span class="WHIT"> </span><span class="COMM">/* = this.length */</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>2525</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">sz</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">index</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">index</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">index</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">sz</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">sz</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>2526</span> </span><span class="WHIT">    </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">index</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">--</span><span class="NAME">index</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>2527</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">index</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">[</span><span class="NAME">index</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">value</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">index</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>2528</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>2529</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>2530</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>2531</span> </span><span class="WHIT">  </span><span class="COMM">/** &lt;b>Array.filter - 全要素を評価し、結果が真の要素を配列で返す(JavaScript 1.6準拠)&lt;/b>
<span class='linenumber'>2532</span>    *
<span class='linenumber'>2533</span>    * @param function  fn   - 各要素を評価する関数を指定します。
<span class='linenumber'>2534</span>    * @param this      [me] - thisオブジェクトを指定します。デフォルトはundefined(=window)です。
<span class='linenumber'>2535</span>    * @return array - array([ 要素, ... ])を返します。
<span class='linenumber'>2536</span>    * @see &lt;a href="#forEach">Array.forEach&lt;/a> - 全要素を評価し配列を返す
<span class='linenumber'>2537</span>    * @see &lt;a href="http://developer.mozilla.org/ja/docs/Core_JavaScript_1.5_Reference:Global_Objects:Array:filter">Array.filter&lt;/a> - 全要素を評価し結果が真の要素を配列で返す - MDC
<span class='linenumber'>2538</span>    * @see &lt;a href="#every">Array.every&lt;/a> - 全要素を評価し全て真ならtrueを返す
<span class='linenumber'>2539</span>    * @see &lt;a href="#some">Array.some&lt;/a> - 全要素を評価し全て偽ならtrueを返す
<span class='linenumber'>2540</span>    * @see &lt;a href="#map">Array.map&lt;/a> - 全要素を評価し配列を返す
<span class='linenumber'>2541</span>    */</span><span class="WHIT">
<span class='linenumber'>2542</span> </span><span class="WHIT">  </span><span class="NAME">filter</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">fn</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">me</span><span class="WHIT"> </span><span class="COMM">/* = undefined */</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>2543</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">rv</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">sz</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.length</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">v</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>2544</span> </span><span class="WHIT">    </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">sz</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">++</span><span class="NAME">i</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>2545</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">i</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>2546</span> </span><span class="WHIT">        </span><span class="NAME">v</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>2547</span> </span><span class="WHIT">        </span><span class="PUNC">(</span><span class="NAME">fn.call</span><span class="PUNC">(</span><span class="NAME">me</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">v</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">rv.push</span><span class="PUNC">(</span><span class="NAME">v</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>2548</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>2549</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>2550</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">rv</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>2551</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>2552</span> </span><span class="WHIT">  </span><span class="COMM">/** &lt;b>Array.every - 全要素を評価し、全て真ならtrue,偽があればループを中断しfalseを返す(JavaScript 1.6準拠)&lt;/b>
<span class='linenumber'>2553</span>    *
<span class='linenumber'>2554</span>    * @param function  fn   - 各要素を評価する関数を指定します。
<span class='linenumber'>2555</span>    * @param this      [me] - thisオブジェクトを指定します。デフォルトはundefined(=window)です。
<span class='linenumber'>2556</span>    * @return bool - 全て真ならtrue, 偽があればfalseを返します。
<span class='linenumber'>2557</span>    * @see &lt;a href="#forEach">Array.forEach&lt;/a> - 全要素を評価し配列を返す
<span class='linenumber'>2558</span>    * @see &lt;a href="#filter">Array.filter&lt;/a> - 全要素を評価し結果が真の要素を配列で返す
<span class='linenumber'>2559</span>    * @see &lt;a href="http://developer.mozilla.org/ja/docs/Core_JavaScript_1.5_Reference:Global_Objects:Array:every">Array.every&lt;/a> - 全要素を評価し全て真ならtrueを返す - MDC
<span class='linenumber'>2560</span>    * @see &lt;a href="#some">Array.some&lt;/a> - 全要素を評価し全て偽ならtrueを返す
<span class='linenumber'>2561</span>    * @see &lt;a href="#map">Array.map&lt;/a> - 全要素を評価し配列を返す
<span class='linenumber'>2562</span>    */</span><span class="WHIT">
<span class='linenumber'>2563</span> </span><span class="WHIT">  </span><span class="NAME">every</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">fn</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">me</span><span class="WHIT"> </span><span class="COMM">/* = undefined */</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>2564</span> </span><span class="WHIT">    </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">sz</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">sz</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">++</span><span class="NAME">i</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>2565</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">i</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">fn.call</span><span class="PUNC">(</span><span class="NAME">me</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>2566</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>2567</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>2568</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>2569</span> </span><span class="WHIT">  </span><span class="COMM">/** &lt;b>Array.some - 全要素を評価し、全て偽ならfalse,真があればループを中断しtrueを返す(JavaScript 1.6準拠)&lt;/b>
<span class='linenumber'>2570</span>    *
<span class='linenumber'>2571</span>    * @param function  fn   - 各要素を評価する関数を指定します。
<span class='linenumber'>2572</span>    * @param this      [me] - thisオブジェクトを指定します。デフォルトはundefined(=window)です。
<span class='linenumber'>2573</span>    * @return bool - 全て偽ならfalse, 真があればtrueを返します。
<span class='linenumber'>2574</span>    * @see &lt;a href="#forEach">Array.forEach&lt;/a> - 全要素を評価し配列を返す
<span class='linenumber'>2575</span>    * @see &lt;a href="#filter">Array.filter&lt;/a> - 全要素を評価し結果が真の要素を配列で返す
<span class='linenumber'>2576</span>    * @see &lt;a href="#every">Array.every&lt;/a> - 全要素を評価し全て真ならtrueを返す
<span class='linenumber'>2577</span>    * @see &lt;a href="http://developer.mozilla.org/ja/docs/Core_JavaScript_1.5_Reference:Global_Objects:Array:some">Array.some&lt;/a> - 全要素を評価し全て偽ならtrueを返す - MDC
<span class='linenumber'>2578</span>    * @see &lt;a href="#map">Array.map&lt;/a> - 全要素を評価し配列を返す
<span class='linenumber'>2579</span>    */</span><span class="WHIT">
<span class='linenumber'>2580</span> </span><span class="WHIT">  </span><span class="NAME">some</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">fn</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">me</span><span class="WHIT"> </span><span class="COMM">/* = undefined */</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>2581</span> </span><span class="WHIT">    </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">sz</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">sz</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">++</span><span class="NAME">i</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>2582</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">i</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">fn.call</span><span class="PUNC">(</span><span class="NAME">me</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>2583</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>2584</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>2585</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>2586</span> </span><span class="WHIT">  </span><span class="COMM">/** &lt;b>Array.map - 全要素を評価し配列を返す(JavaScript 1.6準拠)&lt;/b>
<span class='linenumber'>2587</span>    *
<span class='linenumber'>2588</span>    * @param function  fn   - 各要素を評価する関数を指定します。
<span class='linenumber'>2589</span>    * @param this      [me] - thisオブジェクトを指定します。デフォルトはundefined(=window)です。
<span class='linenumber'>2590</span>    * @return array - 結果を配列で返します。
<span class='linenumber'>2591</span>    * @see &lt;a href="#forEach">Array.forEach&lt;/a> - 全要素を評価し配列を返す
<span class='linenumber'>2592</span>    * @see &lt;a href="#filter">Array.filter&lt;/a> - 全要素を評価し結果が真の要素を配列で返す
<span class='linenumber'>2593</span>    * @see &lt;a href="#every">Array.every&lt;/a> - 全要素を評価し全て真ならtrueを返す
<span class='linenumber'>2594</span>    * @see &lt;a href="#some">Array.some&lt;/a> - 全要素を評価し全て偽ならtrueを返す
<span class='linenumber'>2595</span>    * @see &lt;a href="http://developer.mozilla.org/ja/docs/Core_JavaScript_1.5_Reference:Global_Objects:Array:map">Array.map&lt;/a> - 全要素を評価し配列を返す - MDC
<span class='linenumber'>2596</span>    */</span><span class="WHIT">
<span class='linenumber'>2597</span> </span><span class="WHIT">  </span><span class="NAME">map</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">fn</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">me</span><span class="WHIT"> </span><span class="COMM">/* = undefined */</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>2598</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">rv</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">(</span><span class="NAME">this.length</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">sz</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.length</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>2599</span> </span><span class="WHIT">    </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">sz</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">++</span><span class="NAME">i</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>2600</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">i</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">rv</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">fn.call</span><span class="PUNC">(</span><span class="NAME">me</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>2601</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>2602</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">rv</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>2603</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>2604</span> </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">v</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">p</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>2605</span> </span><span class="WHIT">  </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">Array.prototype</span><span class="PUNC">[</span><span class="NAME">p</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">Array.prototype</span><span class="PUNC">[</span><span class="NAME">p</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">v</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>2606</span> </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>2607</span> 
<span class='linenumber'>2608</span> </span><span class="COMM">////////////////////////////////////////////////////////////</span><span class="WHIT">
<span class='linenumber'>2609</span> </span><span class="COMM">// --- Date extend ---</span><span class="WHIT">
<span class='linenumber'>2610</span> </span><span class="NAME">uu.forEach</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>2611</span> </span><span class="WHIT">  </span><span class="COMM">/** @scope Date.prototype */</span><span class="WHIT">
<span class='linenumber'>2612</span> 
<span class='linenumber'>2613</span> </span><span class="WHIT">  </span><span class="COMM">/** &lt;b>Date.toRFC1123String - RFC1123に準拠した日付文字列の生成(Create RFC1123 formated string)&lt;/b>
<span class='linenumber'>2614</span>    *
<span class='linenumber'>2615</span>    * ms単位の値から、HTTP/1.1準拠の日付文字列( "Thu, 01 Jan 1970 00:00:00 GMT" )を生成します。
<span class='linenumber'>2616</span>    *
<span class='linenumber'>2617</span>    * &lt;pre class="eg">(new Date()).toRFC1123String(); // "Wed, 28 May 2008 10:59:12 GMT"&lt;/pre>
<span class='linenumber'>2618</span>    *
<span class='linenumber'>2619</span>    * @return string - "曜日, 日付 月 年 時:分:秒 GMT" フォーマットの日付文字列を返します。
<span class='linenumber'>2620</span>    * @see &lt;a href="http://d.hatena.ne.jp/uupaa/20080515/1210791702">uupaa開発日記&lt;/a>
<span class='linenumber'>2621</span>    */</span><span class="WHIT">
<span class='linenumber'>2622</span> </span><span class="WHIT">  </span><span class="NAME">toRFC1123String</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>2623</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">uu.ua.ie</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.toUTCString</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>2624</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">rv</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.toUTCString</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">replace</span><span class="PUNC">(</span><span class="REGX">/UTC/</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"GMT"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>2625</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">rv.length</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NUMB">29</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">rv.replace</span><span class="PUNC">(</span><span class="REGX">/, /</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">", 0"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">rv</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// pad zero</span><span class="WHIT">
<span class='linenumber'>2626</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>2627</span> </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">v</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">p</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>2628</span> </span><span class="WHIT">  </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">Date.prototype</span><span class="PUNC">[</span><span class="NAME">p</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">Date.prototype</span><span class="PUNC">[</span><span class="NAME">p</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">v</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>2629</span> </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>2630</span> 
<span class='linenumber'>2631</span> </span><span class="COMM">////////////////////////////////////////////////////////////</span><span class="WHIT">
<span class='linenumber'>2632</span> </span><span class="COMM">// --- Number extend ---</span><span class="WHIT">
<span class='linenumber'>2633</span> </span><span class="NAME">uu.forEach</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>2634</span> </span><span class="WHIT">  </span><span class="COMM">/** @scope Number.prototype */</span><span class="WHIT">
<span class='linenumber'>2635</span> 
<span class='linenumber'>2636</span> </span><span class="WHIT">  </span><span class="COMM">/** &lt;b>Number.toRGBString - カラー値から色指定用文字列を生成(Create color string for rgb function)&lt;/b>
<span class='linenumber'>2637</span>    *
<span class='linenumber'>2638</span>    * カラー値から、rgb関数用の文字列( "rgb(255,255,255)" )を生成します。
<span class='linenumber'>2639</span>    * 
<span class='linenumber'>2640</span>    * &lt;pre class="eg">0xff9999.toRGBString(); // "rgb(255,153,153)"&lt;/pre>
<span class='linenumber'>2641</span>    *
<span class='linenumber'>2642</span>    * @return string - "rgb(red,green,blue)" フォーマットの色指定用文字列を返します。
<span class='linenumber'>2643</span>    */</span><span class="WHIT">
<span class='linenumber'>2644</span> </span><span class="WHIT">  </span><span class="NAME">toRGBString</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>2645</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">v</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.valueOf</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">rv</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">(</span><span class="NAME">v</span><span class="WHIT"> </span><span class="PUNC">>></span><span class="WHIT"> </span><span class="NUMB">16</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&</span><span class="WHIT"> </span><span class="NUMB">0xff</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">v</span><span class="WHIT"> </span><span class="PUNC">>></span><span class="WHIT"> </span><span class="NUMB">8</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&</span><span class="WHIT"> </span><span class="NUMB">0xff</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">v</span><span class="WHIT"> </span><span class="PUNC">&</span><span class="WHIT"> </span><span class="NUMB">0xff</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>2646</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="STRN">"rgb("</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">rv.join</span><span class="PUNC">(</span><span class="STRN">","</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">")"</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>2647</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>2648</span> 
<span class='linenumber'>2649</span> </span><span class="WHIT">  </span><span class="COMM">/** &lt;b>Number.toRGBAString - カラー値から色指定用文字列を生成(Create color string for rgba function)&lt;/b>
<span class='linenumber'>2650</span>    *
<span class='linenumber'>2651</span>    * カラー値から、rgba関数用の文字列( "rgba(255,255,255,1.0)" )を生成します。
<span class='linenumber'>2652</span>    * 
<span class='linenumber'>2653</span>    * &lt;pre class="eg">0xff9999.toRGBAString(0.4); // "rgba(255,153,153,0.4)"&lt;/pre>
<span class='linenumber'>2654</span>    *
<span class='linenumber'>2655</span>    * @param number alpha - 不透明度を指定します。0.0～1.0の値を指定可能です。デフォルトは1.0です。
<span class='linenumber'>2656</span>    * @return string - "rgba(red,green,blue,alpha)" フォーマットの色指定用文字列を返します。
<span class='linenumber'>2657</span>    */</span><span class="WHIT">
<span class='linenumber'>2658</span> </span><span class="WHIT">  </span><span class="NAME">toRGBAString</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">alpha</span><span class="WHIT"> </span><span class="COMM">/* = 1.0 */</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>2659</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">v</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.valueOf</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">rv</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">(</span><span class="NAME">v</span><span class="WHIT"> </span><span class="PUNC">>></span><span class="WHIT"> </span><span class="NUMB">16</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&</span><span class="WHIT"> </span><span class="NUMB">0xff</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">v</span><span class="WHIT"> </span><span class="PUNC">>></span><span class="WHIT"> </span><span class="NUMB">8</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&</span><span class="WHIT"> </span><span class="NUMB">0xff</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">v</span><span class="WHIT"> </span><span class="PUNC">&</span><span class="WHIT"> </span><span class="NUMB">0xff</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">alpha</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NUMB">1.0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>2660</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="STRN">"rgba("</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">rv.join</span><span class="PUNC">(</span><span class="STRN">","</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">")"</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>2661</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>2662</span> </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">v</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">p</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>2663</span> </span><span class="WHIT">  </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">Number.prototype</span><span class="PUNC">[</span><span class="NAME">p</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">Number.prototype</span><span class="PUNC">[</span><span class="NAME">p</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">v</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>2664</span> </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>2665</span> 
<span class='linenumber'>2666</span> </span><span class="COMM">////////////////////////////////////////////////////////////</span><span class="WHIT">
<span class='linenumber'>2667</span> </span><span class="COMM">// --- Math extend ---</span><span class="WHIT">
<span class='linenumber'>2668</span> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">Math.RADIAN</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">"undefined"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>2669</span> </span><span class="WHIT">  </span><span class="NAME">Math.RADIAN</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Math.PI</span><span class="WHIT"> </span><span class="REGX">/ 180;
<span class='linenumber'>2670</span> }
<span class='linenumber'>2671</span> 
<span class='linenumber'>2672</span> /</span><span class="COMM">///////////////////////////////////////////////////////////</span><span class="WHIT">
<span class='linenumber'>2673</span> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">uu.ua.gecko</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>2674</span> </span><span class="WHIT">  </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">HTMLElement.prototype.outerHTML</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="COMM">// for Firefox</span><span class="WHIT">
<span class='linenumber'>2675</span> </span><span class="WHIT">    </span><span class="COMM">/** &lt;b>HTMLElement.outerHTML extend&lt;/b>
<span class='linenumber'>2676</span>      *
<span class='linenumber'>2677</span>      * gecko用のouterHTMLの拡張です。
<span class='linenumber'>2678</span>      * @ignore
<span class='linenumber'>2679</span>      */</span><span class="WHIT">
<span class='linenumber'>2680</span> </span><span class="WHIT">    </span><span class="NAME">HTMLElement.prototype.__defineSetter__</span><span class="PUNC">(</span><span class="STRN">"outerHTML"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">html</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>2681</span> </span><span class="WHIT">      </span><span class="NAME">this._outerHTMLValue</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">html</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>2682</span> </span><span class="WHIT">      </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">r</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">uud.createRange</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">f</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>2683</span> </span><span class="WHIT">      </span><span class="NAME">r.setStartBefore</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>2684</span> </span><span class="WHIT">      </span><span class="NAME">f</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">r.createContextualFragment</span><span class="PUNC">(</span><span class="NAME">html</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>2685</span> </span><span class="WHIT">      </span><span class="NAME">this.parentNode.replaceChild</span><span class="PUNC">(</span><span class="NAME">f</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>2686</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>2687</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>2688</span> </span><span class="WHIT">  </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">HTMLElement.prototype.innerText</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="COMM">// for Firefox</span><span class="WHIT">
<span class='linenumber'>2689</span> </span><span class="WHIT">    </span><span class="COMM">/** &lt;b>HTMLElement.innerText setter&lt;/b>
<span class='linenumber'>2690</span>      *
<span class='linenumber'>2691</span>      * gecko用のinnerHTMLの拡張です。
<span class='linenumber'>2692</span>      * @ignore
<span class='linenumber'>2693</span>      */</span><span class="WHIT">
<span class='linenumber'>2694</span> </span><span class="WHIT">    </span><span class="NAME">HTMLElement.prototype.__defineSetter__</span><span class="PUNC">(</span><span class="STRN">"innerText"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">text</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>2695</span> </span><span class="WHIT">      </span><span class="KEYW">while</span><span class="PUNC">(</span><span class="NAME">this.hasChildNodes</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>2696</span> </span><span class="WHIT">        </span><span class="NAME">this.removeChild</span><span class="PUNC">(</span><span class="NAME">this.lastChild</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>2697</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>2698</span> </span><span class="WHIT">      </span><span class="NAME">this._innerTextValue</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">text</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>2699</span> </span><span class="WHIT">      </span><span class="NAME">this.appendChild</span><span class="PUNC">(</span><span class="NAME">uud.createTextNode</span><span class="PUNC">(</span><span class="NAME">text</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>2700</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>2701</span> </span><span class="WHIT">    </span><span class="COMM">/** &lt;b>HTMLElement.innerText getter&lt;/b>
<span class='linenumber'>2702</span>      *
<span class='linenumber'>2703</span>      * gecko用のinnerHTMLの拡張です。
<span class='linenumber'>2704</span>      * @ignore
<span class='linenumber'>2705</span>      */</span><span class="WHIT">
<span class='linenumber'>2706</span> </span><span class="WHIT">    </span><span class="NAME">HTMLElement.prototype.__defineGetter__</span><span class="PUNC">(</span><span class="STRN">"innerText"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>2707</span> </span><span class="WHIT">      </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">this._innerTextValue</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="STRN">"undefined"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">this._innerTextValue</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">this.textContent</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>2708</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>2709</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>2710</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>2711</span> 
<span class='linenumber'>2712</span> </span><span class="COMM">////////////////////////////////////////////////////////////</span><span class="WHIT">
<span class='linenumber'>2713</span> </span><span class="COMM">// regular module section</span><span class="WHIT">
<span class='linenumber'>2714</span> 
<span class='linenumber'>2715</span> </span><span class="COMM">/** &lt;b>Quick Timer&lt;/b>
<span class='linenumber'>2716</span>  *
<span class='linenumber'>2717</span>  * ベースとなるタイマーで時刻を刻み、
<span class='linenumber'>2718</span>  * その上で複数の仮想タイマーを動作させることで、コンテキストスイッチを減らし、
<span class='linenumber'>2719</span>  * 100個以上のタイマーを高速に動作させることができる高機能タイマーです。&lt;br />
<span class='linenumber'>2720</span>  * 一時停止、再開、ループ回数の指定、遅延時間の動的な指定が可能です。&lt;br />
<span class='linenumber'>2721</span>  *
<span class='linenumber'>2722</span>  * タイマーの精度は、setIntervalやsetTimeoutよりは落ちます(そもそもそれらも正確ではありません)。&lt;br />
<span class='linenumber'>2723</span>  * タイマー周期は約27万年分ほどあるのでオーバーフローの心配はありません。
<span class='linenumber'>2724</span>  * @class
<span class='linenumber'>2725</span>  */</span><span class="WHIT">
<span class='linenumber'>2726</span> </span><span class="NAME">uu.module.virtualTimer</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">uu.basicClass</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>2727</span> </span><span class="NAME">uu.module.virtualTimer.prototype</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>2728</span> </span><span class="WHIT">  </span><span class="COMM">/** @scope uu.module.virtualTimer.prototype */</span><span class="WHIT">
<span class='linenumber'>2729</span> 
<span class='linenumber'>2730</span> </span><span class="WHIT">  </span><span class="COMM">/** &lt;b>uu.module.virtualTimer.construct - 初期化&lt;/b>
<span class='linenumber'>2731</span>    *
<span class='linenumber'>2732</span>    * @param number [baseClock] - ベースクロックの指定です。単位はmsで、デフォルトは10です。
<span class='linenumber'>2733</span>    */</span><span class="WHIT">
<span class='linenumber'>2734</span> </span><span class="WHIT">  </span><span class="NAME">construct</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">baseClock</span><span class="WHIT"> </span><span class="COMM">/* = 10ms */</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>2735</span> </span><span class="WHIT">    </span><span class="NAME">uu.mix</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">baseClock</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">baseClock</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NUMB">10</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>2736</span> </span><span class="WHIT">                   </span><span class="NAME">tick</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT">     </span><span class="COMM">// 内部時刻(現実の時間とはズレます)</span><span class="WHIT">
<span class='linenumber'>2737</span> </span><span class="WHIT">                   </span><span class="NAME">btid</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT">     </span><span class="COMM">// base timer id (window.setInterval result)</span><span class="WHIT">
<span class='linenumber'>2738</span> </span><span class="WHIT">                   </span><span class="NAME">lock</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT">     </span><span class="COMM">// 1: under memory-compaction execution</span><span class="WHIT">
<span class='linenumber'>2739</span> </span><span class="WHIT">                   </span><span class="NAME">data</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// [ vtid: [vtid, next, fn, count, dfn, delay, loop], ... ]</span><span class="WHIT">
<span class='linenumber'>2740</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>2741</span> </span><span class="WHIT">  </span><span class="COMM">/** &lt;b>uu.module.virtualTimer.destruct - 後始末&lt;/b> */</span><span class="WHIT">
<span class='linenumber'>2742</span> </span><span class="WHIT">  </span><span class="NAME">destruct</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>2743</span> </span><span class="WHIT">    </span><span class="NAME">this.suspend</span><span class="PUNC">(</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>2744</span> </span><span class="WHIT">    </span><span class="NAME">this.data</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>2745</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>2746</span> </span><span class="WHIT">  </span><span class="COMM">/** &lt;b>uu.module.virtualTimer.set - 仮想タイマーの登録&lt;/b>
<span class='linenumber'>2747</span>    *
<span class='linenumber'>2748</span>    * 仮想タイマーを追加します。&lt;br />
<span class='linenumber'>2749</span>    * ベースタイマーが停止している状態ならベースタイマーを再始動させます。
<span class='linenumber'>2750</span>    *
<span class='linenumber'>2751</span>    * @param function/string   fn     - 遅延評価関数を指定します。文字列化した関数も指定可能です。
<span class='linenumber'>2752</span>    *                                   デフォルトはuu.muteです。
<span class='linenumber'>2753</span>    * @param number/function   delay  - 遅延時間を指定します。単位はmsです。&lt;br />
<span class='linenumber'>2754</span>    *                                   デフォルトは10です。&lt;br />
<span class='linenumber'>2755</span>    *                                   遅延時間を返す関数を指定することもできます。
<span class='linenumber'>2756</span>    *                                   delayに関数を指定した場合は、delay(呼び出し回数)の形でコールバックします。
<span class='linenumber'>2757</span>    *                                   呼び出し回数は0以上の整数になります。
<span class='linenumber'>2758</span>    * @param number            [loop] - 評価回数を指定します。0なら無限, 1なら1回, 100なら100回評価します。
<span class='linenumber'>2759</span>    * @return number                  - unset()で使用するvtidを返します。
<span class='linenumber'>2760</span>    * @see &lt;a href="#resetLoop">uu.module.virtualTimer.resetLoop&lt;/a> - 仮想タイマーのループ回数を再設定
<span class='linenumber'>2761</span>    */</span><span class="WHIT">
<span class='linenumber'>2762</span> </span><span class="WHIT">  </span><span class="NAME">set</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">fn</span><span class="WHIT"> </span><span class="COMM">/* = uu.mute */</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">delay</span><span class="WHIT"> </span><span class="COMM">/* = 10 */</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">loop</span><span class="WHIT"> </span><span class="COMM">/* = 0 */</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>2763</span> </span><span class="WHIT">    </span><span class="NAME">fn</span><span class="WHIT">    </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">uu.isF</span><span class="PUNC">(</span><span class="NAME">fn</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">fn</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">uu.isS</span><span class="PUNC">(</span><span class="NAME">fn</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Function</span><span class="PUNC">(</span><span class="NAME">fn</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">uu.mute</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// fnが文字列なら関数化</span><span class="WHIT">
<span class='linenumber'>2764</span> </span><span class="WHIT">    </span><span class="NAME">delay</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">delay</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NUMB">10</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>2765</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">dfn</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">uu.isF</span><span class="PUNC">(</span><span class="NAME">delay</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">delay</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">undefined</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">rv</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.data.length</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>2766</span> </span><span class="WHIT">    </span><span class="NAME">this.resume</span><span class="PUNC">(</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>2767</span> </span><span class="WHIT">    </span><span class="NAME">this.data</span><span class="PUNC">[</span><span class="NAME">rv</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">vtid</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">rv</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">next</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">this.tick</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">dfn</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">dfn</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">delay</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="COMM">// nextをdfn()で計算し格納</span><span class="WHIT">
<span class='linenumber'>2768</span> </span><span class="WHIT">                      </span><span class="NAME">fn</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">fn</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">count</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">dfn</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">dfn</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">delay</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">delay</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">loop</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">loop</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>2769</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">rv</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>2770</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>2771</span> </span><span class="WHIT">  </span><span class="COMM">/** &lt;b>uu.module.virtualTimer.resetLoop - 仮想タイマーのループ回数を再設定&lt;/b>
<span class='linenumber'>2772</span>    *
<span class='linenumber'>2773</span>    * loop = 0なら、vtidで指定したタイマーを無限ループ化します。&lt;br />
<span class='linenumber'>2774</span>    * loop > 0なら、vtidの現在のループ数に追加します。&lt;br />
<span class='linenumber'>2775</span>    * 仮想タイマーが停止中なら再始動させます。
<span class='linenumber'>2776</span>    *
<span class='linenumber'>2777</span>    * @param number  vtid - set()が返すvtidを指定します。
<span class='linenumber'>2778</span>    * @param number  [loop] - ループ数の指定です。0以上の値を指定します。デフォルトは0です。
<span class='linenumber'>2779</span>    * @see &lt;a href="#set">uu.module.virtualTimer.set&lt;/a> - 仮想タイマーの登録
<span class='linenumber'>2780</span>    */</span><span class="WHIT">
<span class='linenumber'>2781</span> </span><span class="WHIT">  </span><span class="NAME">resetLoop</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">vtid</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">loop</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>2782</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>2783</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="PUNC">(</span><span class="NAME">vtid</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">this.data</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">loop</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>2784</span> </span><span class="WHIT">    </span><span class="NAME">d</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.data</span><span class="PUNC">[</span><span class="NAME">vtid</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>2785</span> </span><span class="WHIT">    </span><span class="NAME">d.loop</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">loop</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">d.loop</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">loop</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// loop = 0で無限ループ, loop > 0でループ数追加</span><span class="WHIT">
<span class='linenumber'>2786</span> </span><span class="WHIT">    </span><span class="NAME">d.next</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">d.next</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">          </span><span class="COMM">// 停止中なら再始動</span><span class="WHIT">
<span class='linenumber'>2787</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>2788</span> </span><span class="WHIT">  </span><span class="COMM">/** &lt;b>uu.module.virtualTimer.resume - タイマーの開始(再開)&lt;/b>
<span class='linenumber'>2789</span>    *
<span class='linenumber'>2790</span>    * ベースタイマーと仮想タイマーの開始(再開)を行います。&lt;br />
<span class='linenumber'>2791</span>    * ベースタイマー停止中に仮想タイマーを再開させると、
<span class='linenumber'>2792</span>    * ベースタイマーの再始動も行います。
<span class='linenumber'>2793</span>    *
<span class='linenumber'>2794</span>    * @param number  [vtid] - vtidを指定すると仮想タイマーを開始します。&lt;br />
<span class='linenumber'>2795</span>    *                         -1を指定するとベースタイマーを開始します。&lt;br />
<span class='linenumber'>2796</span>    *                         デフォルトは-1です。
<span class='linenumber'>2797</span>    * @see &lt;a href="#suspend">uu.module.virtualTimer.suspend&lt;/a> - タイマーの停止(一時停止)
<span class='linenumber'>2798</span>    */</span><span class="WHIT">
<span class='linenumber'>2799</span> </span><span class="WHIT">  </span><span class="NAME">resume</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">vtid</span><span class="WHIT"> </span><span class="COMM">/* = -1 */</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>2800</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>2801</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">vtid</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>2802</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.btid</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>2803</span> </span><span class="WHIT">        </span><span class="NAME">this.tick</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Date</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">getTime</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>2804</span> </span><span class="WHIT">        </span><span class="NAME">this.btid</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this._impl</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>2805</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>2806</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">vtid</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">this.data</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>2807</span> </span><span class="WHIT">      </span><span class="NAME">d</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.data</span><span class="PUNC">[</span><span class="NAME">vtid</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>2808</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">d.next</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">d.next</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">d.dfn</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">d.dfn</span><span class="PUNC">(</span><span class="NAME">d.count</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>2809</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.btid</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">arguments.callee</span><span class="PUNC">(</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="COMM">// resume(-1) - begin base timer</span><span class="WHIT">
<span class='linenumber'>2810</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>2811</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>2812</span> </span><span class="WHIT">  </span><span class="COMM">/** &lt;b>uu.module.virtualTimer.suspend - タイマーの停止(一時停止)&lt;/b>
<span class='linenumber'>2813</span>    *
<span class='linenumber'>2814</span>    * ベースタイマーと仮想タイマーの停止(一時停止)を行います。
<span class='linenumber'>2815</span>    *
<span class='linenumber'>2816</span>    * @param number  [vtid] - vtidを指定すると仮想タイマーを停止します。&lt;br />
<span class='linenumber'>2817</span>    *                         -1を指定するとベースタイマーを停止します。&lt;br />
<span class='linenumber'>2818</span>    *                         デフォルトは-1です。
<span class='linenumber'>2819</span>    * @see &lt;a href="#resume">uu.module.virtualTimer.resume&lt;/a> - タイマーの開始(再開)
<span class='linenumber'>2820</span>    */</span><span class="WHIT">
<span class='linenumber'>2821</span> </span><span class="WHIT">  </span><span class="NAME">suspend</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">vtid</span><span class="WHIT"> </span><span class="COMM">/* = -1 */</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>2822</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">vtid</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>2823</span> </span><span class="WHIT">      </span><span class="NAME">this.btid</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">uuw.clearInterval</span><span class="PUNC">(</span><span class="NAME">this.btid</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>2824</span> </span><span class="WHIT">      </span><span class="NAME">this.btid</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>2825</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">vtid</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">this.data</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>2826</span> </span><span class="WHIT">      </span><span class="COMM">// _impl内でthis.data[vtid]を評価中に要素そのものを削除すると例外が発生するため、</span><span class="WHIT">
<span class='linenumber'>2827</span> </span><span class="WHIT">      </span><span class="COMM">// 予定時刻をゼロにすることでスケジューリングを停止します。</span><span class="WHIT">
<span class='linenumber'>2828</span> </span><span class="WHIT">      </span><span class="NAME">this.data</span><span class="PUNC">[</span><span class="NAME">vtid</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">next</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>2829</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>2830</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>2831</span> </span><span class="WHIT">  </span><span class="COMM">/** &lt;b>uu.module.virtualTimer.diet - Memory Compaction&lt;/b>
<span class='linenumber'>2832</span>    * 不要になった仮想タイマーの情報を削除します。
<span class='linenumber'>2833</span>    * 処理中でもベースタイマーは停止しませんが、仮想タイマーは数baseClock分遅延します。
<span class='linenumber'>2834</span>    */</span><span class="WHIT">
<span class='linenumber'>2835</span> </span><span class="WHIT">  </span><span class="NAME">diet</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>2836</span> </span><span class="WHIT">    </span><span class="PUNC">++</span><span class="NAME">this.lock</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>2837</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>2838</span> </span><span class="WHIT">  </span><span class="COMM">/** &lt;b>uu.module.virtualTimer._impl&lt;/b> */</span><span class="WHIT">
<span class='linenumber'>2839</span> </span><span class="WHIT">  </span><span class="NAME">_impl</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>2840</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">me</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>2841</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">uuw.setInterval</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>2842</span> </span><span class="WHIT">      </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">sz</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">me.data.length</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">t</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">me.tick</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">me.baseClock</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>2843</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">me.lock</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="COMM">// Memory Compaction</span><span class="WHIT">
<span class='linenumber'>2844</span> </span><span class="WHIT">        </span><span class="COMM">// 予定時刻(next > 0)があるものだけをme.dataに残す</span><span class="WHIT">
<span class='linenumber'>2845</span> </span><span class="WHIT">        </span><span class="NAME">me.data</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">me.data.filter</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">v</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="PUNC">!</span><span class="NAME">v.next</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>2846</span> </span><span class="WHIT">        </span><span class="NAME">me.lock</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// unlock</span><span class="WHIT">
<span class='linenumber'>2847</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>2848</span> </span><span class="WHIT">        </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">sz</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">++</span><span class="NAME">i</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>2849</span> </span><span class="WHIT">          </span><span class="NAME">d</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">me.data</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// fetch</span><span class="WHIT">
<span class='linenumber'>2850</span> </span><span class="WHIT">          </span><span class="COMM">// 予定時刻(d.next)が現在時刻(t)を過ぎていれば、</span><span class="WHIT">
<span class='linenumber'>2851</span> </span><span class="WHIT">          </span><span class="COMM">// 次回の予定時刻(d.next)を計算しfn()をコール,ループ回数が設定されていればデクリメント、</span><span class="WHIT">
<span class='linenumber'>2852</span> </span><span class="WHIT">          </span><span class="COMM">// loop回数がゼロになったら予定時刻を0にしてカウンタを停止。</span><span class="WHIT">
<span class='linenumber'>2853</span> </span><span class="WHIT">          </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">d.next</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">t</span><span class="WHIT"> </span><span class="PUNC">>=</span><span class="WHIT"> </span><span class="NAME">d.next</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>2854</span> </span><span class="WHIT">            </span><span class="NAME">d.next</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">d.loop</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="PUNC">(</span><span class="PUNC">--</span><span class="NAME">d.loop</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">t</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">d.dfn</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">d.dfn</span><span class="PUNC">(</span><span class="PUNC">++</span><span class="NAME">d.count</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">d.delay</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>2855</span> </span><span class="WHIT">            </span><span class="NAME">d.fn</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>2856</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>2857</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>2858</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>2859</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">me.baseClock</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>2860</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>2861</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>2862</span> 
<span class='linenumber'>2863</span> </span><span class="COMM">// 汎用仮想タイマー</span><span class="WHIT">
<span class='linenumber'>2864</span> </span><span class="NAME">uu.tm10</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">uu.module.virtualTimer</span><span class="PUNC">(</span><span class="NUMB">10</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// instantiate</span><span class="WHIT">
<span class='linenumber'>2865</span> 
<span class='linenumber'>2866</span> </span><span class="COMM">////////////////////////////////////////////////////////////</span><span class="WHIT">
<span class='linenumber'>2867</span> </span><span class="COMM">/** Message Pump Module.
<span class='linenumber'>2868</span>  *
<span class='linenumber'>2869</span>  * @class
<span class='linenumber'>2870</span>  */</span><span class="WHIT">
<span class='linenumber'>2871</span> </span><span class="NAME">uu.module.messagePump</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>2872</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>2873</span> 
<span class='linenumber'>2874</span> </span><span class="NAME">uu.module.messagePump</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">uu.singletonClass</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>2875</span> </span><span class="NAME">uu.module.messagePump.prototype</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>2876</span> </span><span class="WHIT">  </span><span class="NAME">construct</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>2877</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">me</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>2878</span> </span><span class="WHIT">    </span><span class="NAME">this.reg</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// registered object { tid: instance, ... }</span><span class="WHIT">
<span class='linenumber'>2879</span> </span><span class="WHIT">    </span><span class="NAME">this.msg</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// stocked message [ [ id, msg, param1, param2], ... ]</span><span class="WHIT">
<span class='linenumber'>2880</span> </span><span class="WHIT">    </span><span class="NAME">this.vtm</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">uu.module.virtualTimer</span><span class="PUNC">(</span><span class="NUMB">10</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// 仮想タイマーを生成</span><span class="WHIT">
<span class='linenumber'>2881</span> </span><span class="WHIT">    </span><span class="NAME">this.vtid</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.vtm.set</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>2882</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">me.msg.length</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>2883</span> </span><span class="WHIT">        </span><span class="NAME">me.vtm.suspend</span><span class="PUNC">(</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>2884</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>2885</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">e</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">me.msg.shift</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>2886</span> </span><span class="WHIT">        </span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">me.reg</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">me.reg</span><span class="PUNC">[</span><span class="NAME">e</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">procedure</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">e</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">e</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>2887</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>2888</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">10</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>2889</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>2890</span> </span><span class="WHIT">  </span><span class="COMM">/** &lt;b>メッセージの送信先を登録&lt;/b>
<span class='linenumber'>2891</span>    *
<span class='linenumber'>2892</span>    * @param string  tid - ターゲットID(送信先ID)を指定します。"broadcast"は指定できません。
<span class='linenumber'>2893</span>    * @param object  obj - インスタンスを指定します。
<span class='linenumber'>2894</span>    * @see &lt;a href="#send">uu.module.messagePump.send&lt;/a> - メッセージの同期送信
<span class='linenumber'>2895</span>    * @see &lt;a href="#post">uu.module.messagePump.post&lt;/a> - メッセージの非同期送信
<span class='linenumber'>2896</span>    * @throws TypeError "uu.module.messagePump(tid)"  引数が無効
<span class='linenumber'>2897</span>    */</span><span class="WHIT">
<span class='linenumber'>2898</span> </span><span class="WHIT">  </span><span class="NAME">set</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">tid</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">obj</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>2899</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">tid</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">"broadcast"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">throw</span><span class="WHIT"> </span><span class="NAME">TypeError</span><span class="PUNC">(</span><span class="STRN">"uu.module.messagePump(tid)"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>2900</span> </span><span class="WHIT">    </span><span class="NAME">this.reg</span><span class="PUNC">[</span><span class="NAME">tid</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">obj</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>2901</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>2902</span> </span><span class="WHIT">  </span><span class="COMM">/** &lt;b>メッセージの同期送信&lt;/b>
<span class='linenumber'>2903</span>    *
<span class='linenumber'>2904</span>    * メッセージを送信し送信結果を返します。param1,param2にはどのような引数でも渡せます。
<span class='linenumber'>2905</span>    *
<span class='linenumber'>2906</span>    * @param  string tid      - ターゲットID(送信先ID)の指定です。
<span class='linenumber'>2907</span>    *                           有効なIDを指定するとユニキャストします。
<span class='linenumber'>2908</span>    *                           無効なIDや"broadcast"を指定するとブロードキャストします。
<span class='linenumber'>2909</span>    * @param  string msg      - メッセージを指定します。
<span class='linenumber'>2910</span>    * @param  mix    [param1] - 1つめのパラメタの指定です。デフォルトはundefinedです。
<span class='linenumber'>2911</span>    * @param  mix    [param2] - 2つめのパラメタの指定です。デフォルトはundefinedです。
<span class='linenumber'>2912</span>    * @return array/mix       - 送信先.procedure()の実行結果の配列を返します。
<span class='linenumber'>2913</span>    * @see &lt;a href="#set">uu.module.messagePump.set&lt;/a> - メッセージの送信先を登録
<span class='linenumber'>2914</span>    */</span><span class="WHIT">
<span class='linenumber'>2915</span> </span><span class="WHIT">  </span><span class="NAME">send</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">tid</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">msg</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">param1</span><span class="WHIT"> </span><span class="COMM">/* = undefined */</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">param2</span><span class="WHIT"> </span><span class="COMM">/* = undefined */</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>2916</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">rv</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>2917</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">tid</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">tid</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">this.reg</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="COMM">// unicast</span><span class="WHIT">
<span class='linenumber'>2918</span> </span><span class="WHIT">      </span><span class="NAME">rv.push</span><span class="PUNC">(</span><span class="NAME">this.reg</span><span class="PUNC">[</span><span class="NAME">tid</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">procedure</span><span class="PUNC">(</span><span class="NAME">msg</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">param1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">param2</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>2919</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="COMM">// broadcast</span><span class="WHIT">
<span class='linenumber'>2920</span> </span><span class="WHIT">      </span><span class="NAME">uu.forEach</span><span class="PUNC">(</span><span class="NAME">this.reg</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">v</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">rv.push</span><span class="PUNC">(</span><span class="NAME">v.procedure</span><span class="PUNC">(</span><span class="NAME">msg</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">param1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">param2</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>2921</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>2922</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">rv</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>2923</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>2924</span> </span><span class="WHIT">  </span><span class="COMM">/** &lt;b>メッセージの非同期送信&lt;/b>
<span class='linenumber'>2925</span>    *
<span class='linenumber'>2926</span>    * メッセージを非同期送信します。param1,param2にはどのような引数でも渡せます。
<span class='linenumber'>2927</span>    *
<span class='linenumber'>2928</span>    * @param  string tid      - ターゲットID(送信先ID)の指定です。
<span class='linenumber'>2929</span>    *                           有効なIDを指定するとユニキャストします。
<span class='linenumber'>2930</span>    *                           無効なIDや"broadcast"を指定するとブロードキャストします。
<span class='linenumber'>2931</span>    * @param  string msg      - メッセージを指定します。
<span class='linenumber'>2932</span>    * @param  mix    [param1] - 1つめのパラメタの指定です。デフォルトはundefinedです。
<span class='linenumber'>2933</span>    * @param  mix    [param2] - 2つめのパラメタの指定です。デフォルトはundefinedです。
<span class='linenumber'>2934</span>    * @see &lt;a href="#set">uu.module.messagePump.set&lt;/a> - メッセージの送信先を登録
<span class='linenumber'>2935</span>    */</span><span class="WHIT">
<span class='linenumber'>2936</span> </span><span class="WHIT">  </span><span class="NAME">post</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">tid</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">msg</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">param1</span><span class="WHIT"> </span><span class="COMM">/* = undefined */</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">param2</span><span class="WHIT"> </span><span class="COMM">/* = undefined */</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>2937</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">tid</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">tid</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">this.reg</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="COMM">// unicast</span><span class="WHIT">
<span class='linenumber'>2938</span> </span><span class="WHIT">      </span><span class="NAME">this.msg.push</span><span class="PUNC">(</span><span class="PUNC">[</span><span class="NAME">tid</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">msg</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">param1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">param2</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>2939</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="COMM">// broadcast</span><span class="WHIT">
<span class='linenumber'>2940</span> </span><span class="WHIT">      </span><span class="NAME">uu.forEach</span><span class="PUNC">(</span><span class="NAME">this.reg</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">v</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">this.msg.push</span><span class="PUNC">(</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">msg</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">param1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">param2</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>2941</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>2942</span> </span><span class="WHIT">    </span><span class="NAME">this.vtm.resume</span><span class="PUNC">(</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>2943</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>2944</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>2945</span> </span><span class="COMM">/** メッセージポンプのインスタンス(uu.module.messagePump instance)
<span class='linenumber'>2946</span>  *
<span class='linenumber'>2947</span>  * @type object
<span class='linenumber'>2948</span>  */</span><span class="WHIT">
<span class='linenumber'>2949</span> </span><span class="NAME">uu.msgpump</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">uu.module.messagePump</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// instantiate</span><span class="WHIT">
<span class='linenumber'>2950</span> 
<span class='linenumber'>2951</span> </span><span class="COMM">////////////////////////////////////////////////////////////</span><span class="WHIT">
<span class='linenumber'>2952</span> </span><span class="COMM">// init & config</span><span class="WHIT">
<span class='linenumber'>2953</span> 
<span class='linenumber'>2954</span> </span><span class="COMM">/** &lt;b>config&lt;/b>
<span class='linenumber'>2955</span>  *
<span class='linenumber'>2956</span>  * コンフィギュレーション
<span class='linenumber'>2957</span>  *
<span class='linenumber'>2958</span>  * @class
<span class='linenumber'>2959</span>  */</span><span class="WHIT">
<span class='linenumber'>2960</span> </span><span class="NAME">uu.config</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>2961</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>2962</span> 
<span class='linenumber'>2963</span> </span><span class="COMM">/** &lt;b>uu.config.parseQuery - クエリ文字列に指定された設定項目を取り込む&lt;/b>
<span class='linenumber'>2964</span>  *
<span class='linenumber'>2965</span>  * id="uupaa.js"のscript要素のsrc属性のクエリ文字列に、
<span class='linenumber'>2966</span>  * "設定項目名=値" を指定するとこれらを自動で取り込みます。&lt;br />
<span class='linenumber'>2967</span>  *
<span class='linenumber'>2968</span>  * &lt;pre>
<span class='linenumber'>2969</span>  * 例:
<span class='linenumber'>2970</span>  *    ＜script id="uupaa.js" "uupaa.js?debug=false&png24=0"＞
<span class='linenumber'>2971</span>  *    uu.config.debug はfalseになります。
<span class='linenumber'>2972</span>  *    uu.config.png24 はfalseになります。
<span class='linenumber'>2973</span>  * &lt;/pre>
<span class='linenumber'>2974</span>  * bool型の設定項目(png24など)は、
<span class='linenumber'>2975</span>  * "false"や"0"を指定するとfalseになり、それ以外の文字列を指定するとtrueになります。
<span class='linenumber'>2976</span>  */</span><span class="WHIT">
<span class='linenumber'>2977</span> </span><span class="NAME">uu.config._parseQuery</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>2978</span> </span><span class="WHIT">  </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">rv</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">e</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">uu.id</span><span class="PUNC">(</span><span class="STRN">"uupaa.js"</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">pos</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">e.src.indexOf</span><span class="PUNC">(</span><span class="STRN">"?"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>2979</span> </span><span class="WHIT">  </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">pos</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>2980</span> </span><span class="WHIT">    </span><span class="NAME">rv</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">uu.url.query</span><span class="PUNC">(</span><span class="NAME">e.src.slice</span><span class="PUNC">(</span><span class="NAME">pos</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>2981</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>2982</span> </span><span class="WHIT">  </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">toBool</span><span class="PUNC">(</span><span class="NAME">val</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">val</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">"false"</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">val</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">"0"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>2983</span> </span><span class="WHIT">  </span><span class="NAME">uu.mix</span><span class="PUNC">(</span><span class="NAME">uu.config</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>2984</span> </span><span class="WHIT">    </span><span class="NAME">debug</span><span class="PUNC">:</span><span class="WHIT">      </span><span class="NAME">rv.debug</span><span class="WHIT">      </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">toBool</span><span class="PUNC">(</span><span class="NAME">rv.debug</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">uu.config.debug</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>2985</span> </span><span class="WHIT">    </span><span class="NAME">verbose</span><span class="PUNC">:</span><span class="WHIT">    </span><span class="NAME">rv.verbose</span><span class="WHIT">    </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">toBool</span><span class="PUNC">(</span><span class="NAME">rv.verbose</span><span class="PUNC">)</span><span class="PUNC">:</span><span class="NAME">uu.config.verbose</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>2986</span> </span><span class="WHIT">    </span><span class="NAME">png24</span><span class="PUNC">:</span><span class="WHIT">      </span><span class="NAME">rv.png24</span><span class="WHIT">      </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">toBool</span><span class="PUNC">(</span><span class="NAME">rv.png24</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">uu.config.png24</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>2987</span> </span><span class="WHIT">    </span><span class="NAME">imagePath</span><span class="PUNC">:</span><span class="WHIT">  </span><span class="NAME">rv.imagePath</span><span class="WHIT">  </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">rv.imagePath</span><span class="WHIT">     </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">uu.config.imagePath</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>2988</span> </span><span class="WHIT">    </span><span class="NAME">modulePath</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">rv.modulePath</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">rv.modulePath</span><span class="WHIT">    </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">uu.config.modulePath</span><span class="WHIT">
<span class='linenumber'>2989</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>2990</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>2991</span> 
<span class='linenumber'>2992</span> </span><span class="COMM">/** &lt;b>uu.config.debug - デバッグモードのON/OFF(debug mode)&lt;/b>
<span class='linenumber'>2993</span>  *
<span class='linenumber'>2994</span>  * @type bool
<span class='linenumber'>2995</span>  */</span><span class="WHIT">
<span class='linenumber'>2996</span> </span><span class="NAME">uu.config.debug</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>2997</span> 
<span class='linenumber'>2998</span> </span><span class="COMM">/** &lt;b>uu.config.verbose - おしゃべりモードのON/OFF(verbose mode)&lt;/b>
<span class='linenumber'>2999</span>  *
<span class='linenumber'>3000</span>  * @type bool
<span class='linenumber'>3001</span>  */</span><span class="WHIT">
<span class='linenumber'>3002</span> </span><span class="NAME">uu.config.verbose</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>3003</span> 
<span class='linenumber'>3004</span> </span><span class="COMM">/** &lt;b>uu.config.png24 - 24bit png画像の有効/無効(24bit alpha channel png image)&lt;/b>
<span class='linenumber'>3005</span>  * 24bit png画像をサポートする場合はtrueにします。デフォルトはtrueです。
<span class='linenumber'>3006</span>  * IE5.5/6.0専用の設定です。
<span class='linenumber'>3007</span>  * 
<span class='linenumber'>3008</span>  * @type bool
<span class='linenumber'>3009</span>  * @see uu.module.image.png24()
<span class='linenumber'>3010</span>  */</span><span class="WHIT">
<span class='linenumber'>3011</span> </span><span class="NAME">uu.config.png24</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>3012</span> 
<span class='linenumber'>3013</span> </span><span class="COMM">/** &lt;b>uu.config.imagePath - uupaa.jsが使用する画像の検索パス(image search path)&lt;/b>
<span class='linenumber'>3014</span>  * uupaa.jsから呼び出す画像の検索パスを指定します。&lt;br />
<span class='linenumber'>3015</span>  *
<span class='linenumber'>3016</span>  * 変更する場合は、スラッシュ("/")で終わる絶対パスで指定してください。&lt;br />
<span class='linenumber'>3017</span>  * デフォルトはuupaa.jsが設置されているパス以下のimg/ディレクトリです。
<span class='linenumber'>3018</span>  *
<span class='linenumber'>3019</span>  * &lt;pre class="eg">uu.config.imagePath = "http://example.com/img/";&lt;/pre>
<span class='linenumber'>3020</span>  * 
<span class='linenumber'>3021</span>  * @type string
<span class='linenumber'>3022</span>  * @see uu.module.image.png24
<span class='linenumber'>3023</span>  */</span><span class="WHIT">
<span class='linenumber'>3024</span> </span><span class="NAME">uu.config.imagePath</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">uu.baseURL</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"img/"</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>3025</span> 
<span class='linenumber'>3026</span> </span><span class="COMM">/** &lt;b>uu.config.modulePath - module検索パス(module search path)&lt;/b>
<span class='linenumber'>3027</span>  * モジュール検索パスを指定します。&lt;br />
<span class='linenumber'>3028</span>  *
<span class='linenumber'>3029</span>  * 変更する場合は、スラッシュ("/")で終わる絶対パスで指定してください。&lt;br />
<span class='linenumber'>3030</span>  * デフォルトは、"./,./mini/"です。
<span class='linenumber'>3031</span>  *
<span class='linenumber'>3032</span>  * &lt;pre class="eg">uu.config.modulePath = ["./", "./mini/", "http://example.com/mini/"];&lt;/pre>
<span class='linenumber'>3033</span>  * 
<span class='linenumber'>3034</span>  * @type taxing
<span class='linenumber'>3035</span>  * @see uu.module.load - モジュールの非同期ロード
<span class='linenumber'>3036</span>  * @see uu.module.loadSync - モジュールの同期ロード
<span class='linenumber'>3037</span>  */</span><span class="WHIT">
<span class='linenumber'>3038</span> </span><span class="NAME">uu.config.modulePath</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"./,./mini/"</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>3039</span> 
<span class='linenumber'>3040</span> </span><span class="COMM">////////////////////////////////////////////////////////////</span><span class="WHIT">
<span class='linenumber'>3041</span> </span><span class="COMM">// ユーザが uu.dom.ready(), uu.window.ready()を使用していないケースでも</span><span class="WHIT">
<span class='linenumber'>3042</span> </span><span class="COMM">// uu.dom.already(), uu.window.already() がtrueを返せるように、</span><span class="WHIT">
<span class='linenumber'>3043</span> </span><span class="COMM">// ダミーのイベントハンドラを登録する</span><span class="WHIT">
<span class='linenumber'>3044</span> </span><span class="NAME">uu.dom.ready</span><span class="PUNC">(</span><span class="NAME">uu.mute</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>3045</span> </span><span class="NAME">uu.window.ready</span><span class="PUNC">(</span><span class="NAME">uu.mute</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>3046</span> </span><span class="NAME">uu.config._parseQuery</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>3047</span> 
<span class='linenumber'>3048</span> </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// end (function())()</span><span class="WHIT">
<span class='linenumber'>3049</span> </span></pre></body></html>