<!DOCTYPE html><html lang="ja"><head><meta charset="UTF-8" />
<title>uu.url.test</title>
<script src="../../src/uupaa.js"></script>
<script src="../../src/misc/url.js"></script>
<script>
uu.ready(function(uu) {
    var url, hash, result, ary;

    uu.ok("get absolute directory");


    url = uu.url();
    uu.ok("uu.url() - current abs-dir", url, "is string");

    hash = uu.url(uu.url());
    uu.ok("uu.url(uu.url()) to URLHash", hash, "is hash");

    uu.ok("parse url");




    url = "http://example.com:8080/dir/file.ext?query=string;more=value#fragment";
    result = {
        url:        "http://example.com:8080/dir/file.ext?query=string;more=value#fragment",
        scheme:     "http",
        domain:     "example.com",
        port:       "8080",
        base:       "http://example.com:8080/dir/",
        path:       "/dir/file.ext",
        dir:        "/dir/",
        file:       "file.ext",
        query:      "query=string;more=value",
        hash:       { query: "string", more: "value" },
        fragment:   "fragment"
    };
    hash = uu.url(url);
    uu.ok("uu.url('http://example.com:8080/dir/file.ext?query=string;more=value#fragment') - parse url",
            hash, "==", result);

    uu.ok("build url");



    result = "http://example.com:8080/dir/file.ext?query=string;more=value#fragment";
    hash = {
        url:        "http://example.com:8080/dir/file.ext?query=string;more=value#fragment",
        scheme:     "http",
        domain:     "example.com",
        port:       "8080",
        base:       "http://example.com:8080/dir/",
        path:       "/dir/file.ext",
        dir:        "/dir/",
        file:       "file.ext",
        query:      "query=string;more=value",
        hash:       { query: "string", more: "value" },
        fragment:   "fragment"
    };
    url = uu.url(hash);
    uu.ok("uu.url(URLHash) -> build url",
            url, "==", result);


    uu.ok("rebuild url(parse + build)");


    url = "http://example.com:8080/dir/file.ext?query=string;more=value#fragment";
    uu.ok("uu.url(uu.url('http://example.com:8080/dir/file.ext?query=string;more=value#fragment'))",
            uu.url(uu.url(url)), "==", url);

    uu.ok("get absolute path");
    uu.ok("uu.url.abs('../dir/file.ext') は 相対URL を絶対URLに変換する",
            uu.url.abs('../dir/file.ext'), "is string");


    uu.ok("get directory");

    hash = uu.url.dir("http://example.com/dir/file.ext");
    uu.ok("uu.url.dir('http://example.com/dir/file.ext') -> 'http://example.com/dir/'",
            hash, "==", "http://example.com/dir/");


    hash = uu.url.dir('/root/dir/file.ext');
    uu.ok("uu.url.dir('/root/dir/file.ext') -> '/root/dir/'",
            hash, "==", '/root/dir/');


    hash = uu.url.dir('/file.ext');
    uu.ok("uu.url.dir('/file.ext') -> '/'",
            hash, "==", '/');

    hash = uu.url.dir('/');
    uu.ok("uu.url.dir('/') -> '/'",
            hash, "==", '/');


    hash = uu.url.dir('');
    uu.ok("uu.url.dir('') -> '/'",
            hash, "==", '/');


    uu.ok("split directory, file");

    ary = uu.url.split('http://example.com/dir/file.ext');
    uu.ok("uu.url.split('http://example.com/dir/file.ext') -> ['http://example.com/dir/', 'file.ext']",
            ary, "==", ['http://example.com/dir/', 'file.ext']);


    uu.ok("query string");

    result = uu.url.query("key=val;key2=val2");
    uu.ok('uu.url.query("key=val;key2=val2") -> { key: "val", key2: "val2" }',
            result, "==", { key: "val", key2: "val2" });


    result = uu.url.query({ key: "val",     key2: "val2" });
    uu.ok('uu.url.query({ key: "val",     key2: "val2" }) -> "key=val;key2=val2"',
            result, "==", "key=val;key2=val2");


    result = uu.url.query( "key=val",     { key2: "val2" });
    uu.ok('uu.url.query( "key=val",     { key2: "val2" }) -> "key=val;key2=val2"',
            result, "==", "key=val;key2=val2");


    result = uu.url.query({ key: "val" }, { key2: "val2" });
    uu.ok('uu.url.query({ key: "val" }, { key2: "val2" }) -> "key=val;key2=val2"',
            result, "==", "key=val;key2=val2");


    uu.ok("boundary");


    url = 'http://example.com:8080/dir/file.ext?key=val&key2=val2#fragment';
    uu.ok("uu.url.query('http://example.com:8080/dir/file.ext?key=val&key2=val2#fragment') は URL から QueryString を取り出しパース可能",
            uu.url.query(url), "==", { key: "val", key2: "val2" });


    uu.ok("uu.url.query('key=val&key2=val2#frag') はパースに失敗する",
            uu.url.query('key=val&key2=val2#frag'), "!=", { key: "val", key2: "val2" });

    uu.ok();
});
</script>
</head><body></body></html>
