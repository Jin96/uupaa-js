#summary uu.fx はエフェクトとアニメーションを提供します

<wiki:toc max_depth="2" />
a
= 導入 =

uu.fx() と !NodeSet.fx() は CSSプロパティを連続的に変化させるCSSアニメーション機能を提供します。

uu.fx() と !NodeSet.fx() は uupaa.js に最初から組み込まれています。

uu.fxを特殊化した以下の関数があります。
  * uu.fx.show        !NodeSet.show
  * uu.fx.hide        !NodeSet.hide
  * uu.fx.fade        !NodeSet.fade
  * uu.fx.puff        !NodeSet.puff
  * uu.fx.flare       !NodeSet.flare
  * uu.fx.shrink      !NodeSet.shrink
  * uu.fx.movein      !NodeSet.movein
  * uu.fx.moveout     !NodeSet.moveout
  * uu.fx.highlight   !NodeSet.highlight

また、要素の表示/非表示状態を取得する関数もあります。
  * uu.fx.isHide

以下の easing 関数が利用できます。easing 関数の特性については http://uupaa-js.googlecode.com/svn/trunk/0.8/test/core/fx.easeing.htm を参照してください。
  * linear
  * !InQuad
  * !OutQuad
  * !InOutQuad
  * !InCubic
  * !OutCubic
  * !InOutCubic
  * !OutInCubic
  * !InQuart
  * !OutQuart
  * !InOutQuart
  * !OutInQuart
  * !InBack
  * !OutBack
  * !InOutBack
  * !OutInBack
  * InBounce
  * !OutBounce

= API =

== uu.fx ==

uu.fx(_node_:Node, _duration_:Number, _option_:Hash/Function):Node は
_node_ で指定したノードにアニメーションキューを設定し _node_ を返します。
_duration_ で指定した時間が経過するまで、_option_ で指定した幾つかのCSSプロパティを連続的に変化させます。
_duration_ で指定した時間が経過すると、アニメーションを停止し、_option_.after 関数が指定されていればコールバックします。

_duration_ には 0 以上の数値を指定します。単位は ms です。

_option_ にHashを指定すると、一定時間内に変化させるCSSプロパティと変化の割合わeasing関数により指定できます。
_option_ にFunctionを指定すると、一定間隔で _option_ をコールバックします。

_option_ がHashなら { key: endValue, ...  } または { key: `[`endValue, easing`]`, ... } のように指定します。
  * key には color, opacity といった CSSプロパティ や、予約済みのキーワード( init, before, after, chain, reverse, deny, cssCache ) などのキーワードを指定します。
    * { before: beforeCallback } を指定すると、アニメーション開始前に beforeCallback(_node_, _option_, _back_) の形でコールバックします。
    * { after: afterCallback } を指定すると、アニメーション終了後に afterCallback(_node_, _option_, _back_) の形でコールバックします。
      * 逆再生中は _back_ に true が渡されます。
    * アニメーションの逆再生を行うには、逆再生したいキュー全てに{ chain: 1 }を指定し、逆再生を開始するキューに{ reverse: 1 } を指定します。uu.fx は { chain: 1 } と { reverse: 1 } が指定されたキューのアニメーションを連続的に逆再生します。
  * endValue には 文字列または数値を指定します
    * 現在の値を基準に、増減した値を指定するには "+100" "-100" "`*`100" "/100" のように指定します。
    * top, left, width, height 等のCSSプロパティは、数値で指定するか "100px"のように指定します。em や pt 等は速度的な理由から指定できません。
    * "px" の指定はオプションです。{ width: 100 } と { width: "100px" } は同じ結果になります。
  * _easing_ は uu.fx.easing に登録されている関数名を文字列で指定します。省略も可能です。大文字小文字は区別しません。デフォルトは !inoutquad です。

== uu.fx.show ==
uu.fx.show(_node_:Node, _duration_:Number = 0, _displayValue_:String= "block"):Node は、_node_ を _duration_ 時間かけて表示し、_node_ を返します。

_duration_ には処理時間を ms 単位で指定します。 0 を指定するとすぐに表示し、1000 を指定すると 1秒かけて表示します。

_displayValue_ には style.display が "none" の場合に、display に設定する値を指定します。デフォルトは "block" です。

{{{
    uu.fx(node, { w: 100, h: 100, o: 0.5 });

    // 1秒かけて要素を表示する
    uu.fx.show(node, 1000);
}}}

== uu.fx.hide ==
uu.fx.hide(_node_:Node, _duration_:Number = 0):Node は、_node_ を _duration_ 時間かけて隠し、_node_ を返します。

_duration_ には処理時間を ms 単位で指定します。 0 を指定するとすぐに隠します、1000 を指定すると 1秒かけて隠します。

{{{
    uu.fx(node, { w: 100, h: 100, o: 1 });

    // 1秒かけて要素を隠す
    uu.fx.hide(node, 1000);
}}}

== uu.fx.isHide ===
uu.fx.isHide(_node_:Node):Boolean は、要素が見えない状態で true を返します。

  * style.opacity === 0
  * style.display === "none"
  * style.visibility === "hidden"

上記のいずれかで true を返します。

=== 色の変化 ===
色を連続的に変化させます。
{{{
    var c = uu.color.random().hex,
        bgc = uu.color.random().hex;

    // 色(color)と背景色(background-color)を 500ms かけて変化させる。c は color のエリアスで、bgc は background-color のエリアスです。
    uu.fx(node, 500, { c: c, bgc: bgc });
}}}

=== 不透明度の変化 ===
不透明度(opacity)を連続的に変化させます。o は opacity の別名です。
{{{
    // 不透明度を 500ms かけて 0 ～ 1 に連続的に変化させる
    uu("div").css({ o: 0 }).fx(500, { o: 1 });
}}}

=== 位置の変化 ===
位置(left, top)を連続的に変化させます。変化方法も指定します。x, y は left, top の別名です。
{{{
    // left と top を 500ms かけて left = 100, top + 200(現在位置 + 200) の位置に連続的に変化させる
    // top は InOutQuad の計算結果を使用する
    uu("div").css({ x: 0 }).fx(500, { x: 100, y: ["+200", "InOutQuad"] });
}}}

=== 大きさの変化 ===
大きさ(width, height)を連続的に変化させます。w, h は width, height の別名です。
{{{
    // width と height を 500ms かけて width = 0, height 0 に連続的に変化させる
    uu("div").css({ w: 100, h: 100 }).fx(500, { w: 0, h: 0 });
}}}

=== reverse の指定 ===
事前に chain: 1 を指定したキューを幾つか積み、reverse: 1 を指定すると、それまでに積まれたアニメーションキューの逆再生を行います。

{{{
    // width を 現在の値 → 0px → 300px → 0px → 現在の値 に戻す
    uu(".box").fx(500, { w: 0, chain: 1 }).fx(500, { w: 300, reverse: 1 });
}}}
  * http://uupaa-js.googlecode.com/svn/trunk/0.8/test/core/fx.easeing.htm

単一のキューを再生し逆再生するには、 reverse: 1 を指定します。
{{{
    // opacity を 現在の値 → 1.0 → 現在の値 に戻す
    uu(".box").css({ o: 0.2 }).fx(500, { o: 1.0, reverse: 1 });
}}}
  * http://uupaa-js.googlecode.com/svn/trunk/0.8/test/core/fx.wiki.reverse.htm

=== fps の指定 ===
window.uuconfig.fx.fps に 1以上の数字を指定することでアニメーションの fps を調整できます。デフォルト値は 10 です。
{{{
<script>
window.uuconfig = {
    fx: {
        fps: 10
    }
};
}}}

=== スタンバイキュー ===
uu.fx(_node_, _duration_, uu.nop) とすることで、_duration_ の間だけ何もしないスタンバイキューを作成できます。
{{{
    // 500ms かけて不透明にし、500ms なにもせず、その後 500ms かけて透明にする
    uu("div").fx(500, { o: 1.0 }).fx(500, uu.nop).fx(500, { o: 0 });
}}}

== uu.fx.skip ==
uu.fx.skip(_node_:Node = null, _skipAll_:Boolean = false, _invisible_:Boolean = false):!NodeArray は、_node_ のキューに積まれたアニメーションを一つだけスキップし、キューをスキップしたノードの配列 !NodeArray を返します。
スキップすると、各CSSプロパティの値は、アニメーション開始時に uu.fx で指定した endValue の値になります。

_node_ に null を指定すると、アニメーションキューを持つ全てのノードから先頭のキューを一つだけスキップし、!NodeArray を返します。
_skipAll_ に true を指定すると、全てのアニメーションキューをスキップします。
_invisible_ に true を指定すると、2つ以上のアニメーションを連続でスキップする際に style.visibility = "hidden" を設定し、スキップ完了後に "visible" に戻す特別な処理が追加されます。この処理をいれるとフリッカー(点滅)を抑止できるケースがあります。

{{{
    // node のアニメーションを一つスキップする
    uu.fx.skip(node);
}}}
{{{
    // アニメーションしている全てのノードで、アニメーションキューを全てスキップし、
    // アニメーションを終了させる
    uu.fx.skip(0, true);
}}}
{{{
    // ちらつきを抑えつつ、アニメーションを終了させる
    uu.fx.skip(0, true, true);
}}}

== uu.fx.isBusy ==
uu.fx.isBusy(_node_:Node) は _node_ がアニメーション中かアニメーションキューが積まれている状態で true を返します。

== uu.fx.fade ==

uu.fx.fade(_node_:Node, _duration_:Number, _option_:Hash/Function = void):Node は、
opacity が 0.5以上ならフェードアウトし、0.5未満ならフェードインします。

== uu.fx.puff ==

uu.fx.puff(_node_:Node, _duration_:Number, _option_:Hash/Function = void):Node は、
その場で拡大しながら消えます。

== uu.fx.flare ==

uu.fx.flare(_node_:Node, _duration_:Number, _option_:Hash/Function = { parts: 10, range: 200 }):Node は、
フレア状に拡散し消えます。
  * _option_.parts にはフレアの数を 1以上の値で指定します。
  * _option_.range にはフレアの飛距離を 100以上の値で指定します。

== uu.fx.shrink ==

uu.fx.shrink(_node_:Node, _duration_:Number, _option_:Hash/Function = void):Node は、
縮小し消えます。

== uu.fx.movein ==

uu.fx.movein(_node_:Node, _duration_:Number, _option_:Hash/Function = { degree: 0, range: 200 }):Node は、
離れた場所から登場します。
  * _option_.degree には登場位置を、角度(0～360)で指定します。
  * _option_.range には飛距離を 100以上の値で指定します。

== uu.fx.moveout ==

uu.fx.moveout(_node_:Node, _duration_:Number, _option_:Hash/Function = { degree: 0, range: 200 }):Node は、
離れた場所に消えます。
  * _option_.degree には登場位置を、角度(0～360)で指定します。
  * _option_.range には飛距離を 100以上の値で指定します。

== uu.fx.highlight ==

uu.fx.highlight(_node_:Node, _duration_:Number, _option_:Hash/Function = { bgc: "#ff9", r: 1 }):Node は、
背景色をハイライトカラー(#ff9)にし、元の背景色に戻します。

= Test Code =
  * http://uupaa-js.googlecode.com/svn/trunk/0.8/test/core/fx.show.htm (uu.fx.show / uu.fx.hide)
  * http://uupaa-js.googlecode.com/svn/trunk/0.8/test/core/fx.htm
  * http://uupaa-js.googlecode.com/svn/trunk/0.8/test/core/fx.dance.htm
  * http://uupaa-js.googlecode.com/svn/trunk/0.8/test/core/fx.plus.htm
  * http://uupaa-js.googlecode.com/svn/trunk/0.8/test/core/fx.easeing.htm
  * http://uupaa-js.googlecode.com/svn/trunk/0.8/test/core/fx.stress.htm
  * http://uupaa-js.googlecode.com/svn/trunk/0.8/test/core/fx.timming.htm