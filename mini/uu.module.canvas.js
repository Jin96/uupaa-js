(function(){var F=window,C=F.uu,E=Math,A=E.PI,B=180/A;if(!("canvas" in C.module)){C.module.canvas=function(){}}C.module.canvas2d=C.klass.kiss();C.module.canvas2d.prototype={_RADIAN:A/180,_PI2:A*2,_STYLES:{color:"color",fill:"fillStyle",stroke:"strokeStyle",width:"lineWidth",cap:"lineCap",join:"lineJoin",miter:"miterLimit",shadow:"shadowColor",blur:"shadowBlur",ox:"shadowOffsetX",oy:"shadowOffsetY",font:"font",align:"textAlign",baseline:"textBaseline",alpha:"globalAlpha",mix:"globalCompositeOperation",ielf:"ielf"},_EXSTYLE:{fit:"fit",degree:"degree"},construct:function(G){this.ctx=G.getContext("2d");this._fit=false;this._degree=true;this._repair=false;if(C.ua.ie&&(C.config.repair&1)&&this.ctx.init_){this._repair=true;this.ctx.init_()}},clear:function(G,J,H,I){this.ctx.clearRect(G||0,J||0,H||this.ctx.canvas.width,I||this.ctx.canvas.height);
return this},scale:function(G,H){this.ctx.scale(G,H);return this},translate:function(G,H){this.ctx.translate(G,H);return this},rotate:function(G){this.ctx.rotate(this._degree?G*this._RADIAN:G);return this},setStyle:function(G,I){var H=this;C.forEach(C.isS(G)?C.toPair(G,I):G,function(J,K){if(K in H._EXSTYLE){H["_"+K]=J}else{K=(K in H._STYLES)?H._STYLES[K]:K;if(C.ua.ie){switch(K){case"color":H.ctx.setDefaultColor_&&(J=H.ctx.setDefaultColor_(J));break;case"fillStyle":if(C.isS(J)||"r" in J){H.ctx.setFillColor_&&(J=H.ctx.setFillColor_(J))}break;case"strokeStyle":if(C.isS(J)||"r" in J){H.ctx.setStrokeColor_&&(J=H.ctx.setStrokeColor_(J))}break}}switch(typeof J){case"string":case"number":break;default:if("r" in J){J=C.color.rgba(J)}break}H.ctx[K]=J}});return this},style:function(G){if(G in this._EXSTYLE){return this["_"+G]
}return(G in this._STYLES)?this._STYLES[G]:""},begin:function(G,H){this.ctx.beginPath();(G!==void 0&&H!==void 0)&&this.ctx.moveTo(G||0,H||0);return this},move:function(G,H){this.ctx.moveTo(G,H);return this},line:function(G,H){this.ctx.lineTo(G,H);return this},arc:function(H,N,M,J,I,K){var L=this._degree,G=this._RADIAN;J=J||0,K=K===void 0||K;L?this.ctx.arc(H,N,M,J,(I===void 0)?this._PI2:I,!K):this.ctx.arc(H,N,M,J*G,((I===void 0)?359:I)*G,!K);return this},curve:function(){var G=arguments,H=G.length===4;H?this.ctx.quadraticCurveTo(G[0],G[1],G[2],G[3]):this.ctx.bezierCurveTo(G[0],G[1],G[2],G[3],G[4],G[5]);return this},clip:function(){this.ctx.clip();return this},stroke:function(){this.ctx.stroke();return this},fill:function(G){G?this.ctx.stroke():this.ctx.fill();return this},text:function(J,G,K,I,H){},close:function(G,H){this.ctx.closePath();
(G!==void 0&&H!==void 0)&&this.ctx.moveTo(G||0,H||0);return this},inPath:function(G,H){return this.ctx.isPointInPath(G,H)},box:function(G,L,H,I,J,K){if(!J){K?this.ctx.strokeRect(G,L,H,I):this.ctx.fillRect(G,L,H,I);return this}return this.begin(G,L+J).line(G,L+I-J).curve(G,L+I,G+J,L+I).line(G+H-J,L+I).curve(G+H,L+I,G+H,L+I-J).line(G+H,L+J).curve(G+H,L,G+H-J,L).line(G+J,L).curve(G,L,G,L+J).fill(K||false).close()},poly:function(G,K){var J=G||[0,0],H,I=G.length;this.begin(J[0],J[1]);for(H=2;H<I;H+=2){this.line(J[H],J[H+1])}this.fill(K||false).close()},metabo:function(G,M,H,I,K,J,L){K=K||0,J=(J===void 0)?10:J,L=L||false;if(J){return this.begin(G,M+K).line(G,M+I-K).curve(G+H*0.5,M+I+J,G+H,M+I-K).line(G+H,M+K).curve(G+H,M,G+H-K,M).line(G+K,M).curve(G,M,G,M+K).fill(L).close()}return this.begin(G,M+K).line(G,M+I).line(G+H,M+I).line(G+H,M+K).curve(G+H,M,G+H-K,M).line(G+K,M).curve(G,M,G,M+K).fill(L).close()
},oval:function(G,L,H,I,J,K){K=K||false;if(H===I){if(this._repair&&!K){if(!C.isS(this.ctx.fillStyle)&&(this.ctx.fillStyle.type_==="gradientradial")){this.begin(G,L);this.ctx.radialGradientOval_(G,L,H,I,J);return this}}return this.begin(G,L).arc(G,L,J,0,A*2,true).fill(K).close()}return this},dotBlt:function(G,N,H,L,K){var J=0,I=0;try{for(;I<L;++I){for(J=0;J<H;++J){if(K[J+I*H].a){this.setStyle({fill:K[J+I*H]});this.ctx.fillRect(G+J,N+I,1,1)}}}}catch(M){}return this},gradation:function(N,H){var M,K=N,G=H,L,I=0,J=G.length;if(N.length===4){M=this.ctx.createLinearGradient(K[0],K[1],K[2],K[3])}else{M=this.ctx.createRadialGradient(K[0],K[1],K[2],K[3],K[4],K[5])}if(C.ua.ie){for(;I<J;I+=2){L=G[I+1];if(C.isS(L)){M.addColorStop(G[I],C.color.coffee(C.color.hash(L)))}else{M.addColorStop(G[I],C.color.coffee(L))
}}}else{for(;I<J;I+=2){L=G[I+1];if(!C.isS(L)){L=C.color.rgba(L)}M.addColorStop(G[I],L)}}return M},pattern:function(H,G){return this.ctx.createPattern(H,(G===void 0)?"repeat":G)},image:function(H,M,L,O,J,Q,P,G,K){if(!this._fit){switch(arguments.length){case 1:this.ctx.drawImage(H,0,0);break;case 3:this.ctx.drawImage(H,M,L);break;case 5:this.ctx.drawImage(H,M,L,O,J);break;case 9:this.ctx.drawImage(H,M,L,O,J,Q,P,G,K);break;default:C.log("bad arg: uu.module.canvas2d.image(args=%d)",arguments.length)}}else{var N=this.ctx.canvas.width,I=this.ctx.canvas.height;O=H.width;J=H.height;Q=(O<=N)?Math.floor((N-O)/2):0;P=(J<=I)?Math.floor((I-J)/2):0;G=(O<=N)?O:N;K=(J<=I)?J:I;this.ctx.drawImage(H,M,L,O,J,Q,P,G,K)}return this},grid:function(L){var K=this,J=C.mix.param(L||{},{size:64,color:"#FFD8BD"}),G=this.ctx,H=new C.module.image(),I=C.config.imagePath+"uu.module.canvas.grid.gif";
H.load(I,function(O,P,N){if(P===2&&!C.ua.ie){K.begin().setStyle({fill:G.createPattern(N,"")}).box(0,0,K.w,K.h).close();return }var M,Q;K.begin().setStyle({stroke:J.color});for(Q=J.size;Q<K.h;Q+=J.size){K.move(0,Q).line(K.w,Q)}for(M=J.size;M<K.w;M+=J.size){K.move(M,0).line(M,K.h)}K.stroke().close()},6)}};if(!C.ua.ie||!(C.config.repair&1)){return }if(!("CanvasRenderingContext2D" in window)){throw Error("need excanvas.js")}C.mix(CanvasRenderingContext2D.prototype,{createLinearGradient:function(H,J,G,I){var K=new CanvasGradient("gradient");K.param_={x0:H,y0:J,x1:G,y1:I};return K},createRadialGradient:function(J,L,I,H,K,G){var M=new CanvasGradient("gradientradial");M.param_={x0:J,y0:L,r0:I,x1:H,y1:K,r1:G};return M},createPattern:function(H,G){return new D(H,G)},stroke:function(){this.element_.insertAdjacentHTML("beforeEnd",this.colorStroke_());
this.currentPath_=[]},fill:function(){var G="";if(!C.isS(this.fillStyle)){switch(this.fillStyle.type_){case"gradient":G=this.linearGradientFill_();break;case"tile":G=this.patternFill_();break}}else{G=this.colorFill_()}if(G){this.element_.insertAdjacentHTML("beforeEnd",G)}this.currentPath_=[]},colorStroke_:function(){var N=[],I,J,M=this.buildPath_(),L=this.lineWidth+"px",H=this.lineJoin,K=this.miterLimit,G=(this.lineCap in this.caps_)?this.caps_[this.lineCap]:this.caps_.square;if(C.isS(this.strokeStyle)){I=this.strokeStyleCOFFEE_;J=this.strokeStyleRGBA_.a*this.globalAlpha}else{I=this.colorCOFFEE_;J=this.colorRGBA_.a*this.globalAlpha}N.push('<g_vml_:shape style="position:absolute;width:10;height:10"',' filled="f" stroked="t" coordorigin="0,0" coordsize="100,100"',' path="',M,'">');N.push('<g_vml_:stroke color="',I,'" weight="',L,'"',' endcap="',G,'" opacity="',J,'"',' joinstyle="',H,'" miterlimit="',K,'" />');
N.push("</g_vml_:shape>");return N.join("")},colorFill_:function(){var J=[],G,H,I=this.buildPath_();if(C.isS(this.fillStyle)){G=this.fillStyleCOFFEE_;H=this.fillStyleRGBA_.a*this.globalAlpha}else{G=this.colorCOFFEE_;H=this.colorRGBA_.a*this.globalAlpha}J.push('<g_vml_:shape style="position:absolute;width:10;height:10"',' filled="t" stroked="f" coordorigin="0,0" coordsize="100,100"',' path="',I,'">');J.push('<g_vml_:fill type="solid" color="',G,'" opacity="',H,'" />');J.push("</g_vml_:shape>");return J.join("")},linearGradientFill_:function(){var M=[],G=this.fillStyle,J=G.param_,K=this.buildPath_(),H=this.buildColors_(G.colors_),L=Math.atan2(Math.pow(J.x1-J.x0,2),Math.pow(J.y1-J.y0,2))*B,I=this.globalAlpha;M.push('<g_vml_:shape style="position:absolute;width:10;height:10"',' filled="t" stroked="f" coordorigin="0,0" coordsize="100,100"',' path="',K,'">');
M.push('<g_vml_:fill type="gradient" method="sigma"',' focus="',this.ielf,'" ',' colors="',H,'" opacity="',I,'" angle="',L,'" />');M.push("</g_vml_:shape>");return M.join("")},patternFill_:function(){var K=[],G=this.fillStyle,I=this.buildPath_(),J=G.src_,H=this.colorCOFFEE_;opacity=this.globalAlpha;K.push('<g_vml_:shape style="position:absolute;width:10;height:10"',' filled="t" stroked="f" coordorigin="0,0" coordsize="100,100"',' path="',I,'">');K.push('<g_vml_:fill type="tile" color="',H,'"',' opacity="',opacity,'" src="',J,'" />');K.push("</g_vml_:shape>");return K.join("")},radialGradientOval_:function(R,Q,S,M,H){var L=[],N=this.fillStyle,P=N.param_,I,K,J,G=this.buildColors_(N.colors_),O=this.globalAlpha;I=P.r0/P.x0;K=(1-I+(P.x0-P.x1)/P.r1)/2;J=(1-I+(P.y0-P.y1)/P.r1)/2;L.push("<g_vml_:oval",' style="position:absolute',";left:",R-P.r1,";top:",Q-P.r1,";width:",P.r1,";height:",P.r1,'"',' stroked="f" coordorigin="0,0" coordsize="11000,11000">');
L.push('<g_vml_:fill type="gradientradial" method="sigma"',' focussize="',I,",",I,'"',' focusposition="',K,",",J,'"',' colors="',G,'" opacity="',O,'" />');L.push("</g_vml_:oval>");this.element_.insertAdjacentHTML("beforeEnd",L.join(""));this.currentPath_=[]},drawImage:function(J){var I="",R=arguments,Q=R.length,N={w:0,h:0},U,T,H,M,P,O,S,K,G="image",L=0;if("src" in J){N=this.getOriginalElementSize_(J)}else{if("getContext" in J){++L}}if(!L){switch(Q){case 3:U=R[1],T=R[2],H=N.w,M=N.h,P=0,O=0,S=N.w,K=N.h,G="image";break;case 5:U=R[1],T=R[2],H=R[3],M=R[4],P=0,O=0,S=N.w,K=N.h,G="scale";break;case 9:U=R[5],T=R[6],H=R[7],M=R[8],P=R[1],O=R[2],S=R[3],K=R[4],G="scale";break;default:(C.config.debug&1)&&C.die("CanvasRenderingContext2D.prototype.drawImage","arguments.length",Q)}}I=L?this.drawCanvas_(J,P,O,S,K,U,T,H,M,N.w,N.h,G):this.drawImage_(J,P,O,S,K,U,T,H,M,N.w,N.h,G);
if(I){this.element_.insertAdjacentHTML("BeforeEnd",I)}},drawImage_:function(R,Q,P,S,X,N,M,O,U,V,K,I){var L=[],W=this.getCoords_(N,M),G=10,Y=Math.ceil,T=Math.round,H="filter:progid:DxImageTransform.Microsoft",J=(Q||P);if(this.m_[0][0]!=1||this.m_[0][1]){L.push('<div style="position:absolute;',this.getImageTransformationMatrixStyle_(N,M,O,U),'">')}else{L.push('<div style="position:absolute;',"top:",T(W.y/G),"px;left:",T(W.x/G),"px",'">')}L.push('<div style="position:relative;overflow:hidden;width:',T(O),"px;height:",T(U),'px">');if(J){L.push('<div style="width:',Y(O+Q*O/S),"px;","height:",Y(U+P*U/X),"px;",H,".Matrix(Dx=",-Q*O/S,",Dy=",-P*U/X,')">')}L.push('<div style="width:',T(V*O/S),"px;","height:",T(K*U/X),"px;",H,".AlphaImageLoader(src=",R.src,",sizingMethod="+I+')"></div>');L.push(J?"</div>":"","</div></div>");
return L.join("")},drawCanvas_:function(H,N,M,O,J,Q,P,G,L,K,I){return""},init_:function(){this.caps_={square:"square",butt:"flat",round:"round"};this.ielf="0%";this.color=this.setDefaultColor_("black");this.fillStyle=this.setFillColor_("black");this.strokeStyle=this.setStrokeColor_("black")},setDefaultColor_:function(G){var H=C.isS(G)?C.color.hash(G):G;this.colorCOFFEE_=C.color.coffee(H);this.colorRGBA_=H;return C.color.rgba(H)},setFillColor_:function(G){var H=C.isS(G)?C.color.hash(G):G;this.fillStyleCOFFEE_=C.color.coffee(H);this.fillStyleRGBA_=H;return C.color.rgba(H)},setStrokeColor_:function(G){var H=C.isS(G)?C.color.hash(G):G;this.strokeStyleCOFFEE_=C.color.coffee(H);this.strokeStyleRGBA_=H;return C.color.rgba(H)},buildColors_:function(H){var K=[],G=0,I=H.length;function J(M,L){return M.offset-L.offset
}H.sort(J);for(;G<I;++G){K.push(H[G].offset+" "+H[G].color[0])}return K.join(",")},buildPath_:function(S){S=S||false;var N=[],R=0,U=this.currentPath_.length,L,T,Q,P,K=Math.round,J,H,O,M,G,V;function I(W,X){if(O===void 0||W<O){O=W}if(M===void 0||X<M){M=X}if(G===void 0||W>G){G=W}if(V===void 0||X>V){V=X}}for(;R<U;++R){L=this.currentPath_[R];switch(L.type){case"moveTo":T=this.getCoords_(L.x,L.y);N.push("m ",K(T.x),",",K(T.y));S&&I(T.x,T.y);break;case"lineTo":T=this.getCoords_(L.x,L.y);N.push("l ",K(T.x),",",K(T.y));S&&I(T.x,T.y);break;case"bezierCurveTo":T=this.getCoords_(L.x,L.y);Q=this.getCoords_(L.cp1x,L.cp1y);P=this.getCoords_(L.cp2x,L.cp2y);N.push("c ",K(Q.x),",",K(Q.y),",",K(P.x),",",K(P.y),",",K(T.x),",",K(T.y));S&&I(T.x,T.y);break;case"at":case"wa":T=this.getCoords_(L.x,L.y);Q=this.getCoords_(L.xStart,L.yStart);
P=this.getCoords_(L.xEnd,L.yEnd);J=this.arcScaleX_*L.radius;H=this.arcScaleY_*L.radius;N.push(L.type," ",K(T.x-J),",",K(T.y-H)," ",K(T.x+J),",",K(T.y+H)," ",K(Q.x),",",K(Q.y)," ",K(P.x),",",K(P.y));S&&I(T.x,T.y);break;case"close":N.push("x ");break}}if(S){return[N.join(""),G-O,V-M]}return N.join("")},getOriginalElementSize_:function(J){var I={w:0,h:0},G=J.runtimeStyle.width,H=J.runtimeStyle.height;J.runtimeStyle.width="auto";J.runtimeStyle.height="auto";I.w=J.width;I.h=J.height;J.runtimeStyle.width=G;J.runtimeStyle.height=H;return I},getImageTransformationMatrixStyle_:function(Q,P,R,O){var J=this.m_,G=10,H=Math.round,N=this.getCoords_(Q,P),M=this.getCoords_(Q+R,P),L=this.getCoords_(Q,P+O),K=this.getCoords_(Q+R,P+O),S=["M11='",J[0][0],"',","M12='",J[1][0],"',","M21='",J[0][1],"',","M22='",J[1][1],"',","Dx='",H(N.x/G),"',","Dy='",H(N.y/G),"'"],I=["padding:0 ",H(Math.max(N.x,M.x,L.x,K.x)/G),"px ",H(Math.max(N.y,M.y,L.y,K.y)/G),"px 0;","filter:progid:DXImageTransform.Microsoft.Matrix(",S.join(""),",sizingmethod='clip')"];
return I.join("")}});CanvasGradient.prototype.addColorStop=function(H,G){this.colors_.push({offset:1-H,color:[G,1]})};function D(H,G){G=G||"repeat";switch(G){case"repeat":break;default:throw SyntaxError("bad argument")}this.type_="tile";if("src" in H){if(!H.complete){throw Error("INVALID_STATE_ERR")}if("uuIEBoostAlphapngSrc" in H){this.src_=H.uuIEBoostAlphapngSrc}else{this.src_=H.src}this.repeat_=G}else{if("getContext" in H){throw Error("not impl")}}}})();