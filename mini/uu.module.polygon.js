(function(){var B=window,A=B.uu;A.module.polygon=A.klass.generic();A.module.polygon.prototype={construct:function(C){this.param=A.mix.param(C||{},{fps:50});this.fps=1000/C.fps;this.cube=[];this.tmid=-1},add:function(F){F=A.mix.param(F||{},{highLight:64,color:0,opacity:1,x:0,y:0,zoom:600,phi:Math.PI/100,theta:Math.PI/80});var D=[[],[],[],[],[],[]],C=0,G,E;for(;C<5;++C){G=(!C)?0:Math.SQRT2*Math.cos((0.5*C-0.25)*Math.PI);E=(!C)?0:Math.SQRT2*Math.sin((0.5*C-0.25)*Math.PI);D[0].push([G,E,1]);D[1].push([1,G,E]);D[2].push([E,1,G]);D[3].push([-G,-E,-1]);D[4].push([-1,-G,-E]);D[5].push([-E,-1,-G])}this.cube.push(A.mix(F,{_data:D,_theta:0.5,_phi:0.5}))},draw:function(C,E){if(this.tmid!==-1){return }var D=this;if(E||false){this.tmid=B.setInterval(function(){C.clearRect(0,0,C.canvas.width,C.canvas.height);
D.cube.forEach(function(F){F._phi+=F.phi;F._theta+=F.theta;D._drawPolygon(C,F)})},this.fps)}else{C.clearRect(0,0,C.canvas.width,C.canvas.height);D.cube.forEach(function(F){D._drawPolygon(C,F)})}},_drawPolygon:function(U,I){var c=Math.sin(I._phi),Q=Math.cos(I._phi),a=Math.sin(I._theta),P=Math.cos(I._theta),b=I._data,H=[-c,Q,0],G=[-P*Q,-P*c,a],F=[-a*Q,-a*c,-P],Z=[],O,N,L,Y,W,E,T,D,C,X,V,S=I.zoom,M=I.x,K=I.y,J=I.color,R=I.highLight,e=I.opacity;for(Y=0,D=b.length;Y<D;++Y){X=b[Y][0];T=[0,-(F[0]*X[0]+F[1]*X[1]+F[2]*X[2])];for(W=1,C=b[Y].length;W<C;++W){V=b[Y][W];L=F[0]*V[0]+F[1]*V[1]+F[2]*V[2];T.push([H[0]*V[0]+H[1]*V[1]+H[2]*V[2],G[0]*V[0]+G[1]*V[1]+G[2]*V[2],L]);T[0]+=L}Z.push(T)}Z.sort(this._sort);for(Y=0,D=Z.length;Y<D;++Y){E=Z[Y][1];if(E>=0.1){for(W=2,C=Z[Y].length;W<C;++W){X=Z[Y][W];V=X[2]+10;
O=S*X[0]/V;N=S*X[1]/V;if(W===2){U.beginPath();U.moveTo(M+O,K+-N);U.fillStyle=this._rgba(J,parseInt(E*R),e)}else{U.lineTo(M+O,K+-N)}}U.closePath();U.fill()}}},_sort:function(D,C){if(D[0]===C[0]){return 0}return D[0]<C[0]?1:-1},_rgba:function(C,E,D){var F=[Math.min(((C>>16)&255)+E,255),Math.min(((C>>8)&255)+E,255),Math.min((C&255)+E,255),D];return"rgba("+F.join(",")+")"}}})();