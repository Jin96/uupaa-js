(function(){var B=document,C=window,A=C.uu;A.module.datascheme=A.klass.kiss();A.module.datascheme.prototype={spacer:"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAAAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw%3D%3D",_gifpfx:"data:image/gif;base64,",construct:function(F,E,G,D){this._maxWidth=F||32;this._maxHeight=E||32;this._useCanvas=A.ua.ie?0:(G===void 0)?1:G;this._delay=D||0;this._bank={};this._findDataURIResource();this._bank={}},_findDataURIResource:function(){var D=this;A.attr('img[@src^="'+this._gifpfx+'"]').forEach(function(E){A.delay(function(){D._drawGIF(E)},this._delay)})},_drawGIF:function(F){var K=new A.module.datascheme.drawPixel(),D,H,I=this._gifpfx.length,E,G,J;if(F.src===this.spacer){J=K.detectDimension(F,1,1);this._drawSpacerGIF(F,J);return }E=F.src.substring(I,I+50);if(E in this._bank){G=this._bank[E];
J=K.detectDimension(F,G.w,G.h);this._useCanvas?K.drawCanvas(F,G,J):K.drawDOM(F,G,J)}else{D=A.module.datascheme.dataURI.decode(F.src.substring(I));H=new A.module.datascheme.gif();J=H.dim(D);if(!J.w||J.w>this._maxWidth||!J.h||J.h>this._maxHeight){return }G=H.decode(D);if(G[0].interlace){G[0].data=this._decodeGIFInterlace(G[0].data,G[0].w,G[0].h)}this._bank[E]=G[0];J=K.detectDimension(F,G[0].w,G[0].h);this._useCanvas?K.drawCanvas(F,G[0],J):K.drawDOM(F,G[0],J)}},_decodeGIFInterlace:function(E,O,G){var F=0,I,Q=0,P=0,N=0,L=0,M=[],K=[],J=[],H=[],D=[1,4,3,4,2,4,3,4];for(F=0;F<G;F+=8){M.push(E.splice(0,O))}for(F=4;F<G;F+=8){K.push(E.splice(0,O))}for(F=2;F<G;F+=4){J.push(E.splice(0,O))}for(F=1;F<G;F+=2){H.push(E.splice(0,O))}for(F=0,I=G;F<I;++F){switch(D[F%8]){case 1:Array.prototype.push.apply(E,M[Q++]);
break;case 2:Array.prototype.push.apply(E,K[P++]);break;case 3:Array.prototype.push.apply(E,J[N++]);break;case 4:Array.prototype.push.apply(E,H[L++]);break}}return E},_drawSpacerGIF:function(H,F){var G=H,E=B.createElement("span"),D=A.css.get(G);E.id=G.id;E.className=G.className;E.title=G.title;E.style.display="inline-block";E.style.overflow="hidden";E.style.top=D.top;E.style.left=D.left;E.style.width=F.style.w+"px";E.style.height=F.style.h+"px";A.css.unselectable(E);G.parentNode.replaceChild(E,G)}};A.module.datascheme.dataURI={decode:function(F){var G,E,D=1;if(F.substring(0,5)==="data:"){G=F.indexOf(",");if(G===-1){return[]}E=F.substring(0,G);D=/;base64$/.test(E)?1:0;F=F.substring(G+1)}if(D){return A.module.datascheme.base64.decode(window.decodeURIComponent(F))}return A.module.datascheme.hex.decode(F)
}};A.module.datascheme.hex={decode:function(D){var J=[],F=D,I=0,E=0,G=F.length,H="%".charCodeAt(0);if(!F.length){return[]}if(F.length>=3){if(F.charAt(F.length-1)==="%"||F.charAt(F.length-2)==="%"){return[]}}while(E<G){I=F.charCodeAt(E++);if(I===H){J.push(parseInt(F.charAt(E)+F.charAt(E+1),16));E+=2}else{J.push(I)}}return J}};A.module.datascheme.base64={_b64str:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",_b64hash:{"=":0},_makeHash:function(){var E=A.module.datascheme.base64,D=0,F=E._b64str.length;for(;D<F;++D){E._b64hash[E._b64str.charAt(D)]=D}},decode:function(E){if(typeof E!=="string"||!E.length){return[]}E=E.replace(/-/g,"+").replace(/_/g,"/").replace(/=/g,"");if(/[^A-Za-z0-9\+\/]/.test(E)){return[]}var K=[],F=A.module.datascheme.base64,I=0,H=F._b64hash,J=0,D=0,G;if(!("A" in F._b64hash)){F._makeHash()
}switch(E.length%4){case 2:E+="=";++I;case 3:E+="=";++I}G=E.length;while(D<G){J=(H[E.charAt(D++)]<<18)|(H[E.charAt(D++)]<<12)|(H[E.charAt(D++)]<<6)|H[E.charAt(D++)];K.push((J>>>16)&255,(J>>>8)&255,J&255)}K.length-=[0,1,2][I];return K}};A.module.datascheme.lzw={decode:function(V,K,T,L){L=(L===void 0)?6:L;var I=[],N=0,G=[],X=Math.pow(2,L),W=X+1,U=W+1,F=0,Q=0,E=L+1,J=E,H=0,D=0,S=0,P=0,R=0,M=Math.pow(2,E);function O(){var Z=8-J,Y;if(Z<0){Z=0}D+=((V[N]>>H)&(255>>Z))<<(E-J);Y=H+J;J-=(8-H);if(J<0){J=0}H=Y;if(H>8){H=0;++N}return J}for(R=0;R<4096;++R){if(!O()){if(D===W){break}else{if(D===X){E=L+1;M=Math.pow(2,E);U=W+1}else{if(D<X){if(S){G[U++]=[Q,F+1]}I[S]=D;Q=S;F=1;++S}else{if(D>W){G[U++]=[Q,F+1];for(P=0;P<G[D][1];++P){I[S+P]=I[G[D][0]+P]}Q=S;F=G[D][1];S+=G[D][1]}}}}if(U===M){++E;M=Math.pow(2,E)}D=0;
J=E}}return I}};A.module.datascheme.gif=A.klass.kiss();A.module.datascheme.gif.prototype={dim:function(D){return{w:(D[7]<<8)|D[6],h:(D[9]<<8)|D[8]}},decode:function(D){this._byteArray=D;this._format="";this._decodePos=0;this._head=this._defaultGIFHeader();this._imageBlock=[];this._lastTransparentColorFlag=0;this._lastTransparentColorIndex=0;var E=[],N=this,O=this._byteArray,K=0,I=0,M,H=0,R,Q,G,J,P,L,S=A.color.hash;switch(String.fromCharCode(O[0],O[1],O[2],O[3],O[4],O[5])){case"GIF87a":this._format="GIF87a";break;case"GIF89a":this._format="GIF89a";break;default:return[]}this._decodePos+=this._format.length;this._decodeHeader();M=this._byteArray.length;while(this._decodePos<M){switch(O[this._decodePos]){case 44:this._decodeImageBlock();break;case 33:switch(O[this._decodePos+1]){case 249:this._decodeGraphicBlock();
break;case 254:this._decodeCommentBlock();break;case 1:this._decodeTextBlock();break;case 255:this._decodeApplicationBlock();break;default:return[]}break;case 59:this._decodePos=M;break;default:return[]}}if(this._imageBlock.length){this._imageBlock.length=1}K=0,M=this._imageBlock.length;for(;K<M;++K){R=this._imageBlock[K];G=[];J=N._head.globalColorTableFlag?N._head.globalColorTable:R.localColorTable;P=A.module.datascheme.lzw.decode(R.imageData[0],R.imageWidth,R.imageHeight,R.LZWMinimumCodeSize);if(R.transparentColorFlag){L=R.transparentColorIndex}else{L=N._mustColor(P,J)}I=0,H=P.length;for(;I<H;++I){Q=P[I];G.push(S(J[Q][0],J[Q][1],J[Q][2],Q===L?0:1))}P=undefined;E.push({w:R.imageWidth,h:R.imageHeight,data:G,transparent:R.transparentColorFlag,interlace:R.interlaceFlag,backgroundColor:S(J[L][0],J[L][1],J[L][2],1)})
}return E},_mustColor:function(F,E){var J=0,I=Array(E.length),G,H,D=0;for(G=0,H=E.length;G<H;++G){I[G]=0}for(G=0,H=F.length;G<H;++G){D=F[G];++I[D];if(I[D]>J){J=D}}return J},_decodeHeader:function(){var F=this._head,D=this._byteArray,H=this._decodePos,E=0,G=0;F.logicalScreenWidth=(D[H+1]<<8)|D[H];H+=2;F.logicalScreenHeight=(D[H+1]<<8)|D[H];H+=2;F.globalColorTableFlag=!!(D[H]&128);F.colorResolution=(D[H]>>>4)&7;F.sortFlag=!!(D[H]&8);F.globalColorTableSize=1<<((D[H++]&7)+1);F.backgroundColorIndex=D[H++];F.pixelAspectRatio=!D[H]?0:(D[H]+15)/64;++H;if(F.globalColorTableFlag){G=F.globalColorTableSize;for(E=0;E<G;H+=3,++E){F.globalColorTable.push([D[H],D[H+1],D[H+2]])}}this._decodePos=H},_decodeImageBlock:function(){var J=this._defaultImageBlock(),D=this._byteArray,H=this._decodePos,F=0,G=0,E=0,I=[];
J.transparentColorFlag=this._lastTransparentColorFlag;J.transparentColorIndex=this._lastTransparentColorIndex;this._lastTransparentColorFlag=0;this._lastTransparentColorIndex=0;++H;J.imageLeftPosition=(D[H+1]<<8)|D[H];H+=2;J.imageTopPosition=(D[H+1]<<8)|D[H];H+=2;J.imageWidth=(D[H+1]<<8)|D[H];H+=2;J.imageHeight=(D[H+1]<<8)|D[H];H+=2;J.localColorTableFlag=!!(D[H]&128);J.interlaceFlag=!!(D[H]&64);J.sortFlag=!!(D[H]&32);J.localColorTableSize=1<<((D[H++]&7)+1);if(J.localColorTableFlag){G=J.localColorTableSize;for(F=0;F<G;H+=3,++F){J.localColorTable.push([D[H],D[H+1],D[H+2]])}}J.LZWMinimumCodeSize=D[H++];while((E=D[H++])){while(E--){I.push(D[H++])}}J.imageData.push(I);this._decodePos=H;this._imageBlock.push(J)},_decodeGraphicBlock:function(){var D=this._byteArray,E=this._decodePos;this._lastTransparentColorFlag=!!(D[E+3]&1);
this._lastTransparentColorIndex=D[E+6];this._decodePos+=8},_decodeCommentBlock:function(){var D=this._byteArray,F=this._decodePos,E=0;F+=2;while((E=D[F++])){F+=E}this._decodePos=F},_decodeTextBlock:function(){this._decodeCommentBlock()},_decodeApplicationBlock:function(){this._decodeCommentBlock()},_defaultGIFHeader:function(){return A.mix({},{logicalScreenWidth:0,logicalScreenHeight:0,globalColorTableFlag:0,colorResolution:0,sortFlag:0,globalColorTableSize:0,backgroundColorIndex:0,pixelAspectRatio:0,globalColorTable:[]})},_defaultImageBlock:function(){return A.mix({},{transparentColorFlag:0,transparentColorIndex:0,imageLeftPosition:0,imageTopPosition:0,imageWidth:0,imageHeight:0,localColorTableFlag:0,interlaceFlag:0,sortFlag:0,localColorTableSize:0,localColorTable:[],LZWMinimumCodeSize:0,imageData:[]})
}};A.module.datascheme.drawPixel=A.klass.kiss();A.module.datascheme.drawPixel.prototype={drawCanvas:function(J,H,G){var I=J,K,E=B.body.appendChild(B.createElement("span")),F=E.appendChild(B.createElement("canvas")),D=A.css.get(I);if(A.ua.ie){F=G_vmlCanvasManager.initElement(F)}F.width=G.style.w;F.height=G.style.h;E.id=I.id;E.className=I.className;E.title=I.title;E.style.display="inline-block";E.style.overflow="hidden";E.style.top=D.top;E.style.left=D.left;E.style.width=G.style.w+"px";E.style.height=G.style.h+"px";A.css.unselectable(E);A.node.replace(E,I);K=new A.module.canvas2d(F);K.scale(G.scale.w,G.scale.h);if(!H.transparent){K.setStyle({fill:H.backgroundColor});K.box(0,0,H.w,H.h)}K.dotBlt(0,0,H.w,H.h,H.data)},drawDOM:function(J,H,G){var I=J,F=B.body.appendChild(B.createElement("span")),E=A.css.get(I),D;
F.width=G.style.w;F.height=G.style.h;F.id=I.id;F.className=I.className;F.title=I.title;F.style.display="inline-block";F.style.overflow="hidden";F.style.position=(E.position==="absolute")?"absolute":"relative";F.style.top=E.top;F.style.left=E.left;F.style.width=G.style.w+"px";F.style.height=G.style.h+"px";A.css.unselectable(F);if(!H.transparent){D=F.appendChild(B.createElement("div"));D.style.position="absolute";D.style.top="0px";D.style.left="0px";D.style.width=(H.w*G.scale.w)+"px",D.style.height=(H.h*G.scale.h)+"px",D.style.backgroundColor=A.color.coffee(H.backgroundColor);A.css.unselectable(D)}I.parentNode.replaceChild(F,I);if(G.scale.w===1&&G.scale.h===1){this._dotBlt(F,0,0,H.w,H.h,H.data)}else{this._dotBltWithScale(F,0,0,H.w,H.h,H.data,G.scale.w,G.scale.h)}},_dotBlt:function(M,L,K,N,I,F){var H=0,G=0,E=0;
function D(O,R,P){var Q=M.appendChild(B.createElement("div"));Q.style.borderTopWidth="1px";Q.style.borderTopStyle="solid";Q.style.borderTopColor=A.color.coffee(P);Q.style.position="absolute";Q.style.width="1px";Q.style.height="1px";Q.style.left=O+"px";Q.style.top=R+"px"}try{for(;G<I;++G){for(H=0;H<N;++H){if(F[H+G*N].a){D(L+H,K+G,F[H+G*N]);++E}}}}catch(J){}},_dotBltWithScale:function(P,N,M,Q,K,G,D,R){var I=0,H=0,O=D,J=R,F=0;function E(S,V,T){var U=P.appendChild(B.createElement("div"));U.style.borderTopWidth=Math.max(Math.ceil(O),Math.ceil(J))+"px";U.style.borderTopStyle="solid";U.style.borderTopColor=A.color.coffee(T);U.style.position="absolute";U.style.width=Math.ceil(O)+"px";U.style.height=Math.ceil(J)+"px";U.style.left=S+"px";U.style.top=V+"px"}try{for(;H<K;++H){for(I=0;I<Q;++I){if(G[I+H*Q].a){E(N+I*O,M+H*J,G[I+H*Q]);
++F}}}}catch(L){}},detectDimension:function(K,J,F){var I=K,D=0,G=0,E=1,H=1;if(A.ua.ie){D=parseInt(this._getWidth(I));G=parseInt(this._getHeight(I))}else{D=I.width||A.css.get(I,"width");G=I.height||A.css.get(I,"height")}if(D===0&&G===0){D=J;G=F}else{if(D===0&&G!==0){H=parseInt((G/F)*10)/10;E=H;D=parseInt(J*E)}else{if(D!==0&&G===0){E=parseInt((D/J)*10)/10;H=E;G=parseInt(F*H)}else{E=parseInt((D/J)*10)/10;H=parseInt((G/F)*10)/10}}}return{style:{w:D,h:G},scale:{w:E,h:H}}},_getWidth:function(G){var F=G,E=F.outerHTML,D=E.match(/ width=([\d]+)/);if(D){return D[1]}if(F.currentStyle.width!=="auto"){return parseInt(F.currentStyle.width)}return 0},_getHeight:function(G){var F=G,E=F.outerHTML,D=E.match(/ height=([\d]+)/);if(D){return D[1]}if(F.currentStyle.height!=="auto"){return parseInt(F.currentStyle.height)
}return 0}}})();