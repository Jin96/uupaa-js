(function(){var B=document,C=window,A=C.uu;A.module.drag=function(){};A.module.drag.free=A.basicClass();A.module.drag.free.prototype={construct:function(E,D){this.elm=E;this.param=A.mix.param(D||{},{ghost:true,cursor:"move",opacity:A.css.get.opacity(this.elm),allow:"mousedown,mousemove,mouseup,mousewheel",msgpump:false,addressee:null,_x:0,_y:0,_dragging:false});this.param.allow=A.toHash(A.notax(this.param.allow,{fn:function(F){return F.toLowerCase()}}));A.ui.element.toAbsolute(this.elm);this.elm.style.cursor=this.param.cursor;this.param.ghost&&A.effect.fadein(this.elm,{begin:0,end:1});this.zindexer=new A.module.drag.zindexer();this.zindexer.set(this.elm.id);this.hr=A.event.handler(this);if("mousedown" in this.param.allow){A.event.set(this.elm,"mousedown",this.hr)}if("mousewheel" in this.param.allow){A.event.set(this.elm,"mousewheel",this.hr)
}},destruct:function(){try{this.zindexer.unset(this.elm.id);if("mousedown" in this.param.allow){A.event.unset(this.elm,"mousedown",this.hr)}if("mousewheel" in this.param.allow){A.event.unset(this.elm,"mousewheel",this.hr)}}catch(D){}},handleEvent:function(D){var E=A.event.toDOMLv0Type(D.type);if(!(E in this.param.allow)){return }A.event.stop(D);switch(E){case"mousedown":A.event.set(A.ua.ie?this.elm:B,"mousemove,mouseup",this.hr,true);this.mousedown(D);break;case"mousemove":this.mousemove(D);break;case"mouseup":A.event.unset(A.ua.ie?this.elm:B,"mousemove,mouseup",this.hr,true);this.mouseup(D);break;case"mousewheel":this.mousewheel(D);break}},mousedown:function(D){var E=A.event.mouse.pos(D);this.param._x=E.x-parseInt(this.elm.style.left);this.param._y=E.y-parseInt(this.elm.style.top);this.dragging=true;
this.zindexer.beginDrag(this.elm.id);this.param.ghost&&A.css.set.opacity(this.elm,0.3);this.msgpump&&A.msgpump&&A.msgpump.post(this.param.addressee,"mousedown",{sender:"uu.module.drag.free",element:this.elm})},mousemove:function(D){if(!this.dragging){return }var E=A.event.mouse.pos(D);this.elm.style.left=parseInt(E.x-this.param._x)+"px";this.elm.style.top=parseInt(E.y-this.param._y)+"px";this.msgpump&&A.msgpump&&A.msgpump.post(this.param.addressee,"mousemove",{sender:"uu.module.drag.free",element:this.elm})},mouseup:function(D){if(!this.dragging){return }this.dragging=false;this.param.ghost&&A.effect.fadein(this.elm,{speed:"quick",end:1});this.zindexer.endDrag(this.elm.id);this.msgpump&&A.msgpump&&A.msgpump.post(this.param.addressee,"mouseup",{sender:"uu.module.drag.free",element:this.elm})
},mousewheel:function(E){var F=A.css.get(this.elm),D=A.event.mouse.state(E).wheel*2;A.css.set(this.elm,{width:(parseInt(F.width)+(D*2))+"px",height:(parseInt(F.height)+(D*2))+"px",top:(parseInt(F.top)-D)+"px",left:(parseInt(F.left)-D)+"px"});this.msgpump&&A.msgpump&&A.msgpump.post(this.param.addressee,"mousewheel",{sender:"uu.module.drag.free",element:this.elm})}};A.module.drag.limited=A.basicClass();A.module.drag.limited.prototype={construct:function(E){var D=this;this.tgt=null;this.param=A.mix.param(E||{},{ghost:true,cursor:"move",allow:"mousedown,mousemove,mouseup",msgpump:false,addressee:null,dropAllowColor:"bisque",_x:0,_y:0});this.param.allow=A.toHash(A.notax(this.param.allow,{fn:function(F){return F.toLowerCase()}}));this.draggable=A.xpath.snap('//div[@class="draggable"]');this.droppable=A.xpath.snap('//div[@class="droppable"]');
this.zindexer=new A.module.drag.zindexer();D.hr=A.event.handler(D);A.forEach(this.draggable,function(F){F.style.cursor=D.param.cursor;A.event.set(F,"mousedown",D.hr)});A.forEach(this.droppable,function(F){F._uu_drag_bgcolor=A.css.get(F,"backgroundColor");F._uu_drag_rect=A.ui.element(F)})},destruct:function(){var D=this;A.forEach(this.draggable,function(E){A.event.unset(E,"mousedown",D.hr)})},handleEvent:function(D){var E=A.event.toDOMLv0Type(D.type);if(!(E in this.param.allow)){return }A.event.stop(D);switch(E){case"mousedown":A.event.set(A.ua.ie?A.event.target(D).real:B,"mousemove,mouseup",this.hr,true);this.mousedown(D);break;case"mousemove":this.mousemove(D);break;case"mouseup":A.event.unset(A.ua.ie?this.tgt:B,"mousemove,mouseup",this.hr,true);this.mouseup(D);break;case"mousewheel":this.mousewheel(D);
break}},mousedown:function(D){this.tgt=A.event.target(D).real;var E=A.event.mouse.pos(D),F=A.ui.element(this.tgt);A.ui.element.toAbsolute(this.tgt,{opacity:this.param.ghost?0.5:1});A.ui.element.toAbsolute(this.tgt,{opacity:this.param.ghost?0.5:1});this.zindexer.set(this.tgt.id);this.zindexer.beginDrag(this.tgt.id);this.param._x=E.x-F.x;this.param._y=E.y-F.y;this.msgpump&&A.msgpump&&A.msgpump.post(this.param.addressee,"mousedown",{sender:"uu.module.drag.limited",element:this.elm})},mousemove:function(D){var E=A.event.mouse.pos(D);A.css.set(this.tgt,{left:E.x-this.param._x+"px",top:E.y-this.param._y+"px"});this.inDroppableRect(E);this.msgpump&&A.msgpump&&A.msgpump.post(this.param.addressee,"mousemove",{sender:"uu.module.drag.limited",element:this.elm})},mouseup:function(D){A.css.set(this.tgt,{position:"static",left:0,top:0,opacity:1});
this.zindexer.endDrag(this.tgt.id);this.zindexer.unset(this.tgt.id);var E=this.inDroppableRect(A.event.mouse.pos(D));if(E){this.drop(E,this.tgt)}this.msgpump&&A.msgpump&&A.msgpump.post(this.param.addressee,"mouseup",{sender:"uu.module.drag.limited",element:this.elm})},mousewheel:function(D){},drop:function(E,D){if(!A.xpath('count(./div[@class="draggable"])',E)){if(E.hasChildNodes()){E.insertBefore(D,E.firstChild)}else{E.appendChild(D)}this.msgpump&&A.msgpump&&A.msgpump.post(this.param.addressee,"drop",{sender:"uu.module.drag.limited",element:this.elm})}},inDroppableRect:function(D){var F=null,E=this.param.dropAllowColor;A.forEach(this.droppable,function(G){if(A.ui.inRect(G._uu_drag_rect,D)){G.style.backgroundColor=E;F=G;return }G.style.backgroundColor=G._uu_drag_bgcolor});return F}};A.module.drag.zindexer=A.singletonClass();
A.module.drag.zindexer.prototype={construct:function(){this.obj={};this.boost_zIndex=1000;this.default_zIndex=20},set:function(D){if(D in this.obj){if(A.config.debug){throw Error("duplicate id: "+D)}return }this.obj[D]=A.id(D);this.obj[D].style.zIndex=++this.default_zIndex},unset:function(D){if(!(D in this.obj)){if(A.config.debug){throw Error("unknown id: "+D)}return }delete this.obj[D];--this.default_zIndex},beginDrag:function(E){if(!(E in this.obj)){if(A.config.debug){throw Error("unknown id: "+E)}return }var D=this.obj[E].style.zIndex;this.obj[E].style.zIndex=this.boost_zIndex+1;A.forEach(this.obj,function(F){if(F.style.zIndex>D){F.style.zIndex-=1}})},endDrag:function(E,D){if(!(E in this.obj)){if(A.config.debug){throw Error("unknown id: "+E)}return }this.obj[E].style.zIndex=this.default_zIndex
}}})();